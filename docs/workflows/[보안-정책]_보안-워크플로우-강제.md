# π” λ³΄μ• μ •μ±… μ›ν¬ν”λ΅μ° (Security Policy Workflow)

**λ²„μ „:** v1.0  
**μ‘μ„±μΌ:** 2025-10-23  
**λ€μƒ:** λ¨λ“  AI μ½”λ”© μ—μ΄μ „νΈ & κ°λ°μ

---

## π“‹ κ°μ”

μ΄ λ¬Έμ„λ” CandleSpinner ν”„λ΅μ νΈμ—μ„ **λ―Όκ°ν• μ •λ³΄(κ°μΈν‚¤, λ‹λ¨λ‹‰, μΈμ¦ν† ν°)**λ¥Ό λ‹¤λ£¨λ” λ¨λ“  AI μ—μ΄μ „νΈμ™€ κ°λ°μκ°€ **λ°λ“μ‹ μ¤€μν•΄μ•Ό ν•  λ³΄μ• μ •μ±…**μ„ μ •μν•©λ‹λ‹¤.

---

## π¨ μ λ€ κΈμ§€ μ‚¬ν•­ (CRITICAL - μ„λ° μ‹ μ¦‰μ‹ μ¤‘λ‹¨)

### β 1. κ°μΈν‚¤ μ λ€ ν•λ“μ½”λ”© κΈμ§€
```typescript
// β μ λ€ κΈμ§€ (μ„λ° μ‹ μ¦‰μ‹ μ»¤λ°‹ κ±°λ¶€)
const privateKey = "4e6568d1990bff34...";
[vars]
GAME_WALLET_PRIVATE_KEY = "4e6568d1990bff34...";
```

**μ„λ° μ‹ μ΅°μΉ:**
- μ¦‰μ‹ μ»¤λ°‹ κ±°λ¶€
- ν•΄λ‹Ή μ»¤λ°‹ νμ¤ν† λ¦¬ μ κ±° (git-filter-branch)
- μƒ κ°μΈν‚¤ μƒμ„± λ° ν™κ²½λ³€μ κµμ²΄

---

### β 2. λ‹λ¨λ‹‰ μ λ€ νμΌμ— κΈ°λ΅ κΈμ§€
```bash
# β μ λ€ κΈμ§€
echo "tornado run casual carbon..." > mnemonic.txt

# β μ λ€ κΈμ§€
node script.mjs "tornado run casual carbon..."  # ν„°λ―Έλ„μ— νμ¤ν† λ¦¬ λ‚¨μ
```

**μ„λ° μ‹ μ΅°μΉ:**
- λ΅μ»¬ νμ¤ν† λ¦¬ μ¦‰μ‹ μ‚­μ 
- `.gitignore` μ¬μ κ²€
- ν•΄λ‹Ή νμΌ μ‚­μ  ν›„ git rm --cached μ²λ¦¬

---

### β 3. μ±„ν…/λ¬Έμ„μ— λ―Όκ°ν• μ •λ³΄ μ λ€ μ…λ ¥ κΈμ§€
```
β κΈμ§€: "μ  κ°μΈν‚¤λ” 4e6568d1...μ…λ‹λ‹¤"
β κΈμ§€: "λ‹λ¨λ‹‰μ€ tornado run casual carbon..."
β… ν—μ©: "wallet-tools/mnemonic-to-key.mjs μ¤ν¬λ¦½νΈλ΅ μƒμ„±"
```

**μ„λ° μ‹ μ΅°μΉ:**
- μ¦‰μ‹ λ¬Έμ„μ—μ„ λ§μ¤ν‚ΉμΌλ΅ κµμ²΄
- μ±„ν… κΈ°λ΅ κ²€ν†  λ° μ •μ 
- AIμ— κ²½κ³  λ° μ¬κµμ΅

---

## β… μ¬λ°”λ¥Έ μ μ°¨ (MANDATORY)

### 1οΈβƒ£ κ°μΈν‚¤ μƒμ„± (λ΅μ»¬ μ „μ©)

**λ‹¨κ³„ 1: μ•μ „ν• λ…λ Ή μ‹¤ν–‰**
```bash
# PowerShellμ—μ„λ§ μ‹¤ν–‰ (Git Bash κΈμ§€)
node wallet-tools/mnemonic-to-key.mjs "your-24-word-mnemonic"

# μ¶λ ¥ μμ‹:
# privateKey: 4e6568d1990bff34c3fc...ef7978fc
# publicKey: 3a59677f67586df6a530...
# walletAddress: UQBFPDdSlPgqPrn2Xwh...
```

**λ‹¨κ³„ 2: λ³µμ‚¬ & μ¦‰μ‹ μ‚­μ **
```bash
# 1. μ¶λ ¥λ privateKeyλ§ λ³µμ‚¬
# 2. Cloudflare λ€μ‹λ³΄λ“μ— μ¦‰μ‹ μ…λ ¥
# 3. νμΌμ΄λ‚ λ©”λ¨μ— μ €μ¥ κΈμ§€
```

**λ‹¨κ³„ 3: νμ¤ν† λ¦¬ μ •λ¦¬**
```powershell
# PowerShellμ—μ„ μ¦‰μ‹ μ‹¤ν–‰
Clear-History
Remove-Item (Get-PSReadlineOption).HistorySavePath -Force
```

---

### 2οΈβƒ£ Cloudflare ν™κ²½λ³€μ μ„¤μ • (μ•μ „ν• μ„μΉ)

**URL:** https://dash.cloudflare.com/Pages/candlespinner/Settings/Environment-variables

**μ μ°¨:**
1. **Production ν™κ²½ μ„ νƒ**
2. **λ³€μλ…:** `GAME_WALLET_PRIVATE_KEY`
3. **κ°’:** μ„μ privateKey (λ³µμ‚¬-λ¶™μ—¬λ„£κΈ°)
4. **Save** ν΄λ¦­
5. **λ°°ν¬ ν›„ 5λ¶„ λ€κΈ°** (μ μ© λ€κΈ°)

**κ²€μ¦:**
```bash
curl https://aiandyou.me/api/debug-private-key
# μ‘λ‹µ: addressMatches: true
```

---

### 3οΈβƒ£ μ½”λ“μ—μ„μ μ‚¬μ© (ν™κ²½λ³€μλ§)

**β… μ¬λ°”λ¥Έ λ°©λ²•**
```typescript
// functions/api/initiate-withdrawal.ts
const gameWalletPrivateKey = env.GAME_WALLET_PRIVATE_KEY;
const keyPair = keyPairFromSecretKey(Buffer.from(gameWalletPrivateKey, 'hex'));
```

**β μ λ€ κΈμ§€**
```typescript
// μ λ€ κΈμ§€
const gameWalletPrivateKey = "4e6568d1990...";
const gameWalletPrivateKey = process.env.MNEMONIC; // mnemonic μ €μ¥ κΈμ§€
```

---

## π”„ AI μ—μ΄μ „νΈ ν•„μ μ‹¤ν–‰ κ·μΉ™

### [Rule 1] μ½”λ“ λ¦¬λ·° μ‹ λ―Όκ°ν• μ •λ³΄ κ°μ‹

**λ¨λ“  μ»¤λ°‹ μ „, AIλ” λ‹¤μμ„ ν™•μΈν•΄μ•Ό ν•©λ‹λ‹¤:**

```bash
# Step 1: νμΌμ— "4e6568" (κ°μΈν‚¤ ν”„λ¦¬ν”½μ¤) μλ”μ§€ ν™•μΈ
git diff --name-only --staged | while read file; do
  if grep -q "4e6568\|tornado run casual" "$file"; then
    echo "β κ²½κ³ : λ―Όκ°ν• μ •λ³΄ λ°κ²¬! μ»¤λ°‹ κ±°λ¶€"
    exit 1
  fi
done

# Step 2: wrangler.toml κ²€μ¦
if grep -q "GAME_WALLET_PRIVATE_KEY = \"4e6568" wrangler.toml; then
  echo "β κ²½κ³ : wrangler.tomlμ— κ°μΈν‚¤ μμ! μ»¤λ°‹ κ±°λ¶€"
  exit 1
fi

# Step 3: νμ¤ν† λ¦¬ νμΌ ν™•μΈ
if grep -q "mnemonic-to-key.mjs" ~/.bash_history 2>/dev/null; then
  echo "β οΈ κ²½κ³ : ν„°λ―Έλ„ νμ¤ν† λ¦¬μ— λ…λ Ή λ‚¨μ•„μμ. μ¦‰μ‹ μ •λ¦¬"
fi
```

**AI μ‘λ‹µ:**
```
β μ»¤λ°‹ κ±°λ¶€
μ΄μ : wrangler.tomlμ— κ°μΈν‚¤κ°€ λ°κ²¬λμ—μµλ‹λ‹¤.
μ΅°μΉ: GAME_WALLET_PRIVATE_KEY = "4e6568d1..."λ¥Ό μ κ±°ν•κ³  μ£Όμ„μΌλ΅ λ³€κ²½ν•μ„Έμ”.

μ •μ • ν›„ μ¬μ»¤λ°‹ ν•μ„Έμ”.
```

---

### [Rule 2] μ±„ν…/λ¬Έμ„ μ‘μ„± μ‹ λ§μ¤ν‚Ή

**AIκ°€ λ―Όκ°ν• μ •λ³΄λ¥Ό μ–ΈκΈ‰ν•΄μ•Ό ν•  λ•:**

```
β… μ¬λ°”λ¥Έ μμ‹:
"μƒμ„±λ κ°μΈν‚¤λ” 128μ hex ν•μ‹μ…λ‹λ‹¤: 4e6568...ef7978fc"
"λ‹λ¨λ‹‰μ€ 24κ°μ BIP39 λ‹¨μ–΄μ…λ‹λ‹¤"

β μ„ν—ν• μμ‹:
"μƒμ„±λ κ°μΈν‚¤: [full-128-char-hex-key]"
"λ‹λ¨λ‹‰: [complete-24-word-phrase]"
```

---

### [Rule 3] λ³΄μ• μ •μ±… μ„λ° κ°μ§€ λ° λ³΄κ³ 

**AIκ°€ κ°μ§€ν•  μ‚¬ν•­:**

1. **ν•λ“μ½”λ”©λ κ°μΈν‚¤ λ°κ²¬**
   - μ¦‰μ‹ μ¤‘λ‹¨
   - μ‚¬μ©μμ—κ² κ²½κ³ 
   - μμ • λ°©λ²• μ μ‹

2. **ν„°λ―Έλ„ νμ¤ν† λ¦¬μ— λ―Όκ°ν• μ •λ³΄**
   - `Clear-History` λ…λ Ή μ μ‹
   - μ •λ¦¬ μ§€μΉ¨ μ κ³µ

3. **λ¬Έμ„μ— μ „μ²΄ κ°μΈν‚¤/λ‹λ¨λ‹‰**
   - μ¦‰μ‹ λ§μ¤ν‚Ή
   - μμ • μ‚¬ν•­ μ„¤λ…

---

## π“ AIκ°€ λ§¤ μ„Έμ…λ§λ‹¤ ν™•μΈν•  μ²΄ν¬λ¦¬μ¤νΈ

**μ„Έμ… μ‹μ‘ μ‹, λ‹¤μμ„ λ¨Όμ € ν™•μΈν•μ„Έμ”:**

```markdown
## π” λ³΄μ• μ²΄ν¬λ¦¬μ¤νΈ

- [ ] wrangler.tomlμ— κ°μΈν‚¤ μ—†μ (μ£Όμ„λ§ μλ”κ°€?)
- [ ] .gitignoreμ— .env.local ν¬ν•¨λμ–΄ μλ”κ°€?
- [ ] Cloudflare ν™κ²½λ³€μμ— GAME_WALLET_PRIVATE_KEY μ„¤μ •λ¨
- [ ] λ΅μ»¬ ν„°λ―Έλ„ νμ¤ν† λ¦¬ λΉ„μ›μ΅λ”κ°€?
- [ ] docs/solutions/ λ³΄μ• λ¬Έμ„ μλ”κ°€?

β ν•λ‚λΌλ„ μ„λ°ν•λ©΄, μ¦‰μ‹ μμ • ν›„ μ§„ν–‰
```

---

## π¨ λ³΄μ• μ‚¬κ±΄ λ°μƒ μ‹ μ‘κΈ‰ μ²μΉ

### Case 1: κ°μΈν‚¤κ°€ GitHubμ— μ»¤λ°‹λ κ²½μ°

```bash
# Step 1: μ¦‰μ‹ μ¤‘λ‹¨ (λ°°ν¬ κΈμ§€)
# Step 2: git-filter-branchλ΅ νμ¤ν† λ¦¬ μ κ±°
git filter-branch --tree-filter 'rm -f wrangler.toml' HEAD

# Step 3: κ°•μ  ν‘Έμ‹ (μ£Όμ: ν‘μ—… μ¤‘μ΄λ©΄ ν™•μΈ)
git push origin -f main

# Step 4: μƒ κ°μΈν‚¤ μƒμ„± λ° ν™κ²½λ³€μ λ³€κ²½
# Step 5: Tonscanμ—μ„ μ§€κ°‘ ν™λ™ λ¨λ‹ν„°λ§
```

### Case 2: λ‹λ¨λ‹‰μ΄ μ±„ν…μ— λ…Έμ¶λ κ²½μ°

```
1. μ΄ κ°€μ΄λ“ μµμƒλ‹¨μ "AI ν•™μµ λ°μ΄ν„° λ³΄μ• ν‰κ°€" μ½κΈ°
2. μ±„ν… κΈ°λ΅ μµμ†ν™” (ν•„μ”μ‹ μ‚­μ  μ”μ²­)
3. ν–¥ν›„ μ •μ±…: μ λ€ ν„°λ―Έλ„μ—μ„ μ¶λ ¥ κΈμ§€
4. μƒ μ§€κ°‘ μƒμ„± κ¶μ¥ (ν”„λ΅λ•μ…μ κ²½μ°)
```

---

## π“ μ •κΈ° λ³΄μ• κ°μ‚¬

**λ§¤μ›” 1ν (κ¶μ¥):**

```bash
# 1. Git νμ¤ν† λ¦¬μ—μ„ λ―Όκ°ν• μ •λ³΄ μ¤μΊ”
git log --all --grep="4e6568\|tornado run"

# 2. wrangler.toml κ²€μ¦
grep -i "private.*key\|mnemonic" wrangler.toml

# 3. λ΅μ»¬ ν™κ²½ νμΌ ν™•μΈ
ls -la .env* | grep -v ".gitignore"

# 4. Tonscanμ—μ„ μ§€κ°‘ ν™λ™ ν™•μΈ
# https://tonscan.org/address/UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd
```

---

## π“ AI μ—μ΄μ „νΈ κµμ΅ μ²΄ν¬λ¦¬μ¤νΈ

**μ‹ μ… AI μ—μ΄μ „νΈ μ¨λ³΄λ”©:**

- [ ] μ΄ λ¬Έμ„ μ „μ²΄ μ½μ
- [ ] μ λ€ κΈμ§€ μ‚¬ν•­ 3κ° μ™μ§€
- [ ] μ¬λ°”λ¥Έ μ μ°¨ 3κ°€μ§€ μ΄ν•΄
- [ ] ν…μ¤νΈ: wrangler.tomlμ—μ„ κ°μΈν‚¤ κ°μ§€ λ¥λ ¥ ν™•μΈ
- [ ] ν…μ¤νΈ: λ§μ¤ν‚Ή λ¥λ ¥ ν™•μΈ (4e6568...ef7978fc)

---

## π“ μ°Έκ³  λ¬Έμ„

- `docs/solutions/[λ³΄μ•κ°€μ΄λ“]_20251023_κ°μΈν‚¤-ν™κ²½λ³€μ-κ΄€λ¦¬.md` - μƒμ„Έ κ°€μ΄λ“
- `docs/solutions/[λ³΄μ•-κΈ΄κΈ‰]_20251023_ν„°λ―Έλ„-μ±„ν…-κΈ°λ΅-μ‚­μ -κ°€μ΄λ“.md` - νμ¤ν† λ¦¬ μ •λ¦¬
- `docs/solutions/Cloudflare-Pages-ν™κ²½λ³€μ-μ„¤μ •_20251023_000000.md` - ν™κ²½λ³€μ μ„¤μ •

---

**β οΈ λ§μ§€λ§‰ μ£Όμ:**

μ΄ μ •μ±…μ„ μ„λ°ν•λ” μ»¤λ°‹μ€ **μ¦‰μ‹ Revert**λ©λ‹λ‹¤.  
κ°μΈν‚¤/λ‹λ¨λ‹‰ λ…Έμ¶ μ‹ **ν”„λ΅μ νΈ μ „μ²΄ μ°¨λ‹¨**λ  μ μμµλ‹λ‹¤.

**λ³΄μ•μ€ λ¨λ‘μ μ±…μ„μ…λ‹λ‹¤. π”**

