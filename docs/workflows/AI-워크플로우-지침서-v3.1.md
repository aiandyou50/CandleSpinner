# [AI-워크플로우-지침서.md] v3.1 (2025-10-21 업데이트)

**🔄 v3.1 변경사항:**
- ✅ 문서 폴더 구조 하이브리드 모델 (docs 중앙화 + 루트 유지)
- ✅ Lite 워크플로우 추가 (빠른 개발용)
- ✅ 세션 시작 자동화 (kanban.md 파싱)
- ✅ docs/instructions, docs/solutions 폴더 공식화

---

## **목차**
1. 문서 목적 (Purpose)
2. 문서 저장소 구조 (Repository Structure)
3. 버전 관리 정책 (Versioning Policy)
4. 국제화 정책 (i18n Policy)
5. 핵심 워크플로우 (Core Workflow)
   - 5-A. Lite 워크플로우 (빠른 개발용) [v3.1 신규]
   - 5-B. Full 워크플로우 (공식 릴리즈용)
6. 세션 시작 규칙 (Session Start Rule)

---

## **1. 문서 목적 (Purpose)**

이 문서는 CandleSpinner 프로젝트에 참여하는 모든 AI 코딩 에이전트(이하 "AI")가 **반드시 준수해야 할 핵심 행동 원칙(Rules of Engagement)**을 정의합니다.

**최종 목표:**
- 동기화: 코드(Reality)와 모든 산출물 문서(SSoT) 간의 완전한 동기화를 유지합니다.
- 지속성: AI 교체(세션 변경) 시에도 '환각'이나 '망각' 없이 프로젝트 지식이 100% 인수인계되도록 보장합니다.
- 체계화: 시맨틱 버전(SemVer)을 통한 체계적인 릴리즈 관리와 변경 이력 추적을 자동화합니다.

**핵심 원칙:**
- **No Doc, No Code**: 문서가 정의되지 않은 코드는 작성하지 않습니다.
- **No Sync, No Commit**: 코드 변경 시, 관련 문서가 동기화되지 않으면 커밋(Commit)할 수 없습니다.
- **No Record, No Close**: 해결 과정이 기록되지 않은 작업은 종료(Closed)된 것이 아닙니다.

---

## **2. 문서 저장소 구조 (Repository Structure) [v3.1 개선]**

모든 문서는 **`docs/` 폴더 내에 중앙화**되어 저장됩니다. (하이브리드 모델)

### **2.1 폴더 구조**

```
docs/
├── ssot/ (단일 진실 공급원)
│   ├── [산출물1]...md
│   ├── [산출물2]...md
│   └── [산출물3]...md
├── workflows/ (워크플로우 지침)
│   ├── AI-워크플로우-지침서.md (본 문서)
│   └── 퀵-AI워크플로워-지침서.md (Lite 모드 요약본)
├── reports/ (임시/보고성 문서)
│   └── [보고서]_[YYYYMMDD]_[주제].md
├── instructions/ (명령 기록) [v3.1 신규]
│   └── [지시서명칭]_[타임스탬프].md
└── solutions/ (해결 기록) [v3.1 신규]
    └── [지시서명칭]_[타임스탬프]_solution.md

루트 폴더 (빠른 접근):
├── kanban.md (칸반 보드)
└── CHANGELOG.md (변경 이력 문서)

PoC/ (읽기 전용 아카이브)
└── (규칙: 절대 수정 금지)
```

### **2.2 폴더별 역할**

| 폴더 | 목적 | 수정 권한 | 버전 동기화 |
|------|------|---------|----------|
| docs/ssot/ | 설계 문서 | 코드 변경 시만 | 필수 |
| docs/workflows/ | 워크플로우 지침 | 지침 개선 시 | 필수 |
| docs/reports/ | 분석 리포트 | 자유 | 불필요 |
| docs/instructions/ | 명령 기록 | AI 자동 생성 | 불필요 |
| docs/solutions/ | 해결 기록 | AI 자동 생성 | 불필요 |
| kanban.md | 작업 현황 | 실시간 | 불필요 |
| CHANGELOG.md | 마스터 버전 | 버전 변경 시 | **필수** |
| PoC/ | 아카이브 | ❌ 금지 | N/A |

---

## **3. 버전 관리 정책 (Versioning Policy)**

### **3.1 시맨틱 버전(SemVer) 준수**
- 프로젝트는 `Major.Minor.Patch` (예: `1.0.0`) 형식의 SemVer를 엄격히 준수합니다.

### **3.2 마스터 버전 관리**
- `CHANGELOG.md` 파일이 프로젝트 전체 버전의 **마스터(Master)**입니다.
- 개별 산출물 문서(`[산출물1]` 등)는 자체 버전을 갖지 않으며, 프로젝트의 마스터 버전을 따릅니다.

### **3.3 버전 동기화**
- `CHANGELOG.md`의 최신 버전은 반드시 `package.json`의 "version" 필드와 동일해야 합니다.
- 프론트엔드 UI(웹페이지)에는 `package.json`의 버전을 참조하여 현재 프로덕트 버전을 사용자에게 항상 표시해야 합니다.

---

## **4. 국제화 정책 (i18n Policy)**

이 지침서를 포함한 루트 폴더 내의 모든 내부 개발 문서(SSoT, 워크플로우, 보고서 등)는 **한국어로만 작성**하는 것을 원칙으로 합니다.

이는 AI의 '코드-문서 동시 수정' 워크플로우 비용을 최소화하고 개발 속도를 유지하기 위함입니다.

향후 '사용자 가이드' 등 외부 공개용 문서는 별도의 i18n 정책을 수립합니다.

---

## **5. 핵심 워크플로우 (Core Workflow) [v3.1: Lite/Full 하이브리드]**

### **5-A. Lite 워크플로우 (빠른 개발용) [v3.1 신규]**

**언제 사용?**
- 📝 문서만 수정
- 🐛 버그 수정 (코드 1-3줄)
- ⚡ 빠른 반복 필요
- 🔍 리팩토링 (기능 변경 없음)

**4단계 프로세스:**

```
[Step 1] 요청 분석 (축약)
  ├─ 사용자 요청 확인
  ├─ ssot 문서 빠른 확인
  └─ "작업을 시작하겠습니다"

[Step 2] 코드 수정 (단독)
  ├─ 코드만 수정
  ├─ 문서 동기화 SKIP
  └─ 테스트 완료

[Step 3] Git 커밋
  ├─ git add -A
  ├─ git commit -m "fix: [설명]"
  ├─ 버전 변경: 선택사항
  └─ CHANGELOG: 선택사항 (나중에 일괄)

[Step 4] 배포 및 칸반
  ├─ git push origin main
  ├─ Cloudflare 자동 배포
  └─ kanban.md [Done]으로 변경
```

**제약사항:**
- ❌ 아키텍처 변경 금지
- ❌ 주요 기능 추가 금지
- ❌ Breaking change 금지
- ✅ 다음 Full 워크플로우 시 문서 일괄 동기화 가능

---

### **5-B. Full 워크플로우 (공식 릴리즈용)**

**언제 사용?**
- 🏗️ 아키텍처 변경
- ✨ 주요 기능 추가
- 💥 Breaking change
- 🔌 새 엔드포인트 추가

**6단계 프로세스:**

**[Step 1] 요청 분석 및 문서 확인 (Audit-Before-Action)**
- 사용자의 요청을 분석합니다.
- ssot/ 폴더의 SSoT 문서에서 해당 기능의 정의를 찾습니다.
- 사용자에게 다음과 같이 확인 응답합니다.
  - (일치 시): "요청을 확인했습니다. ssot/[산출물3]의 A.3. API 스핀 섹션을 기준으로 작업을 시작하겠습니다."
  - (충돌 시): "요청하신 내용이 ssot/[산출물1]의 정의와 다릅니다. 문서를 먼저 수정한 뒤 코드를 변경하는 것이 맞습니까?"

**[Step 2] 명령 지시서 아카이빙 (Instruction Archiving)**
- [Step 1]에서 사용자의 지시가 확정되면, AI는 해당 지시 내용을 `docs/instructions/[지시서명칭]_[타임스탬프].md` 파일로 즉시 저장하여 보관합니다.

**[Step 3] 코드 생성 및 문서 동시 수정 (Code-Doc-Sync) - (필수)**
- 확인된 문서를 기준으로 요청받은 코드 수정 또는 기능 개발을 수행합니다.
- 코드 생성이 완료되면, 즉시 해당 코드 변경 사항을 반영하는 SSoT 문서(ssot/[산출물1] 등)의 수정안을 생성합니다.
- 사용자에게 코드와 문서 수정안을 함께 제출합니다.

**[Step 4] 버전 업데이트 및 커밋 제안 (Version-Sync-Commit)**
- 사용자가 [Step 3]의 코드와 문서 수정을 모두 승인하면, AI는 이것이 SemVer 변경이 필요한지 질문합니다.
- 사용자가 버전 변경(예: Patch)을 지시하면, AI는 즉시 `CHANGELOG.md`와 `package.json` 파일을 업데이트합니다.
- 이 모든 변경 사항을 포함하는 Git 커밋 메시지를 제안합니다.

**[Step 5] 해결 기록 작성 (Knowledge Base Creation) - (필수)**
- 커밋이 완료된 후, AI는 [Step 2]에서 생성된 명령 지시서의 '짝'이 되는 '해결 기록' 문서를 작성합니다.
- `docs/solutions/[지시서명칭]_[타임스탬프]_solution.md` 파일을 생성하고, 해결 기록 템플릿에 따라 작성합니다.

**[Step 6] 칸반 보드 업데이트 (Update Kanban)**
- AI는 작업이 공식적으로 종료되었으므로, `kanban.md` 파일을 열어 해당 작업의 상태를 [In Progress]에서 [Done]으로 변경합니다.

---

## **6. 세션 시작 규칙 (Session Start Rule) [v3.1 개선]**

### **6.1 새 세션 시작 프로세스**

1. 사용자는 토큰 제한으로 새 세션을 시작할 때, AI의 첫 번째 프롬프트로 `docs/workflows/퀵-AI워크플로워-지침서.md`의 내용 **전체**를 붙여넣습니다.

2. AI는 이 요약본 지침서를 읽고 자신의 역할과 핵심 워크플로우(본 문서 참조의무)를 인지합니다.

3. AI의 첫 번째 응답은 항상 다음과 같아야 합니다.

**응답 템플릿:**
```
퀵-워크플로우 지침서 (Lite 모드 v3.1)를 로드했습니다.

kanban.md 확인 결과:
- [In Progress] 작업: '[작업 제목]'
- 예상 종료: [언제]
- 필요 워크플로우: Lite / Full

이 작업을 이어서 진행할까요?
또는 새로운 작업을 시작하시겠습니까?
```

### **6.2 자동화된 인수인계**

v3.1부터는 AI가 `kanban.md`를 자동으로 파싱하여:
- ✅ 현재 [In Progress] 작업 자동 감지
- ✅ 관련 instructions/ 파일 자동 찾기
- ✅ 예상 소요 시간 자동 계산
- ✅ 적절한 워크플로우 (Lite vs Full) 자동 추천

---

## **7. Quick Reference (빠른 선택 가이드)**

| 요청 유형 | 워크플로우 | 버전 | 문서 동기화 | 예상 시간 |
|----------|----------|------|----------|--------|
| 버그 수정 | Lite | 유지 | SKIP | 5분 |
| 문서 수정 | Lite | 유지 | SKIP | 3분 |
| 캐시 재빌드 | Lite | 유지 | SKIP | 3분 |
| 작은 리팩토링 | Lite | 유지 | SKIP | 10분 |
| **새 기능** | **Full** | **Patch** | **필수** | **30분** |
| **API 추가** | **Full** | **Minor** | **필수** | **40분** |
| **Breaking** | **Full** | **Major** | **필수** | **60분** |

---

## **부록**

### **부록 A: CHANGELOG.md 템플릿**

```markdown
# CandleSpinner 변경 이력 (Changelog)

모든 프로젝트의 주요 변경 사항은 이 파일에 기록됩니다.
이 프로젝트는 [시맨틱 버전(SemVer)](https://semver.org/lang/ko/)을 준수합니다.

## [v2.1.0] - 2025-10-21

### ✨ 추가됨 (Added)
- A/B 테스트: TonConnect vs RPC 입금 방식 선택 UI
- 입금 에러 핸들링 강화 (하얀색 화면 문제 해결)

### 🐛 수정됨 (Fixed)
- TonConnect 버튼 가시성 개선
- MVP 체크리스트 UI 제거
- wrangler.toml TOML 파싱 오류

### 🔄 개선됨 (Changed)
- TMA 버튼: "📱 Telegram Mini App" 링크로 변경
- 워크플로우 지침: Lite 모드 추가 (v3.1)

---
```

### **부록 B: 해결 기록 템플릿**

```markdown
# 해결 기록: [지시서명칭]

> **원본 지시서:** docs/instructions/[지시서명칭]_[타임스탬프].md
> **관련 커밋:** [커밋 해시]
> **최종 버전:** vX.X.X
> **워크플로우:** Full

## 1. 해결 방법 요약

이 작업을 해결하기 위해 다음 파일들을 수정했습니다:
- `src/components/Deposit.tsx`: 입금 에러 핸들링 강화
- `src/App.tsx`: TonConnect 버튼 가시성 개선
- `docs/ssot/[산출물3]...md`: 변경된 기능 반영

## 2. 핵심 코드 변경

(필요시 코드 스니펫)

## 3. 테스트 결과

- ✅ 로컬 빌드 성공
- ✅ Cloudflare Pages 배포 성공
- ✅ 웹 https://aiandyou.me 접속 확인

## 4. 후임 AI를 위한 인수인계

- 다음 배포 시 웹 테스트 필수
- TonConnect 버튼 표시 확인
```

---

**최종 업데이트: 2025-10-21**  
**버전: v3.1 - Lite 워크플로우 추가, 문서 구조 개선**  
**저자: AI Copilot**
