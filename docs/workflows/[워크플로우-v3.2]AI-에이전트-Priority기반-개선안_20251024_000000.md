# [워크플로우 v3.2] AI 에이전트 개선된 작업 흐름 (Priority 기반)

**버전**: v3.2 (2025-10-24)  
**상태**: ✅ 제안 (사용자 검토 대기)  
**목표**: 문서 인플레이션 해결 + AI 처리량 3배 증가 + 드리프트 위험 60% 감소

---

## 📊 개선 개요

### 현재 문제점
- ❌ 6단계 Full 워크플로우 모두 실행 불가능 (토큰 제약)
- ❌ 우선순위 구분 없음 (버그 수정 = 아키텍처 변경)
- ❌ 문서 동기화 자주 건너뜀 → 드리프트 누적
- ❌ 50+ 문서 관리 불가능

### 개선안의 핵심
**3가지 우선순위 기반 워크플로우:**
- **Priority A (Full)**: 아키텍처 변경 (전체 Step 1-6 실행)
- **Priority B (Mid)**: 기능/버그 (Step 3 + 간단 Step 4 + 6)
- **Priority C (Light)**: 문서/리팩토링 (Step 6만)

---

## 🎯 3가지 우선순위 기반 워크플로우

### Priority A: 아키텍처/API 변경 (Full 워크플로우)

**적용 대상:**
```
✅ API 엔드포인트 추가/변경
✅ 새 RPC 통합 (예: Ankr JSON-RPC)
✅ Breaking change (호환성 없는 변경)
✅ Phase 진행 상황 변경 (Phase 2→3)
✅ 핵심 아키텍처 파일 수정 (rpc-utils.ts 등)
```

**예시:**
- v2.1 RPC 아키텍처 추가
- 새로운 API 엔드포인트 생성
- 토큰 표준 변경

**실행 단계:**

```markdown
### Step 1: 문서 확인 (필수)
- [ ] docs/ssot/README.md 섹션 6 (API 명세) 읽음
- [ ] 변경 사항이 기존 설계와 충돌하지 않는지 확인
- [ ] 필요시 ssot 문서 먼저 수정

### Step 2: 명령 아카이빙 (필수)
- [ ] instructions/[명령명]_[타임스탬프].md 파일 생성
- [ ] 사용자 요청 내용 기록

### Step 3: 코드 + 문서 동시 수정 (필수)
- [ ] 코드 구현
- [ ] 즉시 docs/ssot/README.md 섹션 6-7 (API/구현) 업데이트
- [ ] functions/api/README.md 업데이트 (NEW: 상세 API 문서)

### Step 4: 버전 업데이트 (필수)
- [ ] CHANGELOG.md 상세 기록 (5줄 이상)
- [ ] package.json 버전 업데이트
- [ ] 아키텍처 변경 명시

### Step 5: 해결 기록 작성 (필수)
- [ ] solutions/[명령명]_[타임스탬프]_solution.md 생성
- [ ] 구현 방법, 코드 변경, 참고사항 기록

### Step 6: 칸반 업데이트 (필수)
- [ ] kanban.md에서 [In Progress] → [Done] 변경

**예상 시간**: 2-4시간
**빈도**: 1-2주마다
**최근 예시**: v2.1 RPC 아키텍처 (commit f98fbba)
```

---

### Priority B: 기능 추가/버그 수정 (Mid 워크플로우)

**적용 대상:**
```
✅ 새 기능 추가 (기존 API 범위 내)
✅ 버그 수정
✅ 성능 최적화
✅ 코드 리팩토링 (기능 동일)
✅ 라이브러리 버전 업그레이드
```

**예시:**
- 로그인 버그 수정
- 게임 로직 개선
- 변수명 리팩토링

**실행 단계:**

```markdown
### Step 1: [SKIP] 문서 확인
- 이미 문서화된 범위 내이므로 생략

### Step 2: [SKIP] 명령 아카이빙
- 임시 요청이므로 생략

### Step 3: 코드 수정 (필수)
- [ ] 버그/기능 수정 실행
- [ ] 테스트 완료

### Step 4: CHANGELOG 간단 기록 (필수 - 1-2줄)
- [ ] CHANGELOG.md에 "[tag] 간단한 설명" 추가
- [ ] 예: "[fix] 사용자 입금 validation 오류 수정"
- [ ] 버전 업데이트: PATCH 레벨만 (+0.0.1)
- [ ] package.json 동기화

### Step 5: [SKIP] 해결 기록
- 중요도 낮으므로 생략

### Step 6: 칸반 업데이트 (필수)
- [ ] kanban.md 업데이트 → [Done]

**예상 시간**: 30분 - 1시간
**빈도**: 수시
**자동 체크**: 코드 수정 파일로 Priority 판단
```

---

### Priority C: 문서 수정/리팩토링 (Light 워크플로우)

**적용 대상:**
```
✅ 문서 오타 수정
✅ 코드 주석 개선
✅ 변수명 리팩토링 (기능 동일)
✅ 포맷팅 정리
✅ 불필요한 파일 삭제
```

**예시:**
- README.md 오타 수정
- 함수명 리팩토링
- 불필요한 주석 제거

**실행 단계:**

```markdown
### Step 1-5: [모두 SKIP]
- 빠른 처리를 위해 모두 생략

### Step 6: 칸반 업데이트 (필수만)
- [ ] kanban.md 업데이트 → [Done]

**예상 시간**: 5-15분
**빈도**: 수시
**직접 실행**: 사용자나 AI가 즉시 처리 가능
```

---

## 🤖 AI의 자동 우선순위 판단 알고리즘

**사용자 요청을 받으면 AI가 1분 내에 Priority를 결정:**

```javascript
// AI의 판단 플로우 (의사코드)
function decidePriority(userRequest, changedFile) {
  
  // 1단계: 파일 중요도 확인
  const criticalFiles = [
    'functions/api/rpc-utils.ts',      // RPC 유틸
    'functions/api/initiate-withdrawal.ts',  // 출금 핵심
    'docs/ssot/*.md'                    // SSOT 문서
  ];
  
  if (criticalFiles.some(pattern => matches(changedFile, pattern))) {
    return 'Priority A (아키텍처 변경)';
  }
  
  // 2단계: 변경 유형 분석
  if (userRequest.includes('API|endpoint|architecture|breaking')) {
    return 'Priority A (아키텍처)';
  }
  
  if (userRequest.includes('bug|fix|feature|improve')) {
    return 'Priority B (기능/버그)';
  }
  
  if (userRequest.includes('typo|comment|refactor|format')) {
    return 'Priority C (문서/리팩토링)';
  }
  
  // 3단계: 파일 변경 통계
  if (changedFiles.count > 3 || changedLines > 50) {
    return 'Priority B+ (중요 변경)';  // B 상향
  }
  
  return 'Priority C (기본값)';
}

// 실행 예시
decidePriority(
  "v2.1 RPC 아키텍처 Ankr 직접 연동",
  ["functions/api/rpc-utils.ts", "functions/api/initiate-withdrawal.ts"]
)
// 결과: Priority A (Full 워크플로우 실행)

decidePriority(
  "입금 버튼에서 validation 오류 나요",
  ["src/components/Deposit.tsx"]
)
// 결과: Priority B (Mid 워크플로우 실행)

decidePriority(
  "주석에 오타 있어요",
  ["functions/api/debug-withdrawal.ts"]
)
// 결과: Priority C (Light 워크플로우 실행)
```

---

## 📋 각 Priority별 실행 체크리스트

### Priority A 체크리스트
```markdown
#### [Priority A] 아키텍처 변경 - Full 워크플로우

**사전 준비 (5분)**
- [ ] 사용자 요청 명확화 ("어느 API를?", "어떤 변경?")
- [ ] SSOT 문서 관련 섹션 읽음 (3-5분)

**Step 1: 문서 확인 (10분)**
- [ ] docs/ssot/README.md 해당 섹션 읽음
- [ ] 현재 코드와 대비 (다른 점 확인)
- [ ] 사용자에게 확인: "이 변경이 맞나요?"

**Step 2: 명령 아카이빙 (2분)**
- [ ] instructions/[요청명]_[타임].md 생성
- [ ] 요청 내용 저장

**Step 3: 코드 + 문서 동시 (60-120분)**
- [ ] 코드 구현
- [ ] docs/ssot/README.md 섹션 업데이트
- [ ] functions/api/README.md 업데이트 (있으면)
- [ ] 테스트 완료

**Step 4: 버전 & 커밋 (10분)**
- [ ] CHANGELOG.md 상세 기록 (5줄 이상)
- [ ] package.json 버전 변경
- [ ] git commit -m "feat: [설명]"

**Step 5: 해결 기록 (10분)**
- [ ] solutions/[요청명]_[타임]_solution.md 생성
- [ ] 구현 과정 기록

**Step 6: 칸반 (1분)**
- [ ] kanban.md [In Progress] → [Done]

**총 소요 시간**: 100-180분 (2-3시간)
```

### Priority B 체크리스트
```markdown
#### [Priority B] 기능/버그 - Mid 워크플로우

**사전 준비 (1분)**
- [ ] 요청 명확화

**Step 3: 코드 수정 (30-60분)**
- [ ] 버그/기능 수정
- [ ] 테스트

**Step 4: CHANGELOG 기록 (2분)**
- [ ] CHANGELOG.md에 1-2줄 추가
- [ ] 예: "[fix] 사용자 입금 validation"
- [ ] package.json PATCH 버전 (+0.0.1)

**Step 6: 칸반 (1분)**
- [ ] kanban.md [In Progress] → [Done]

**총 소요 시간**: 34-64분 (30분-1시간)
```

### Priority C 체크리스트
```markdown
#### [Priority C] 문서/리팩토링 - Light 워크플로우

**Step 6: 칸반만 (1분)**
- [ ] kanban.md [In Progress] → [Done]

**총 소요 시간**: 5-15분 (즉시 처리)
```

---

## 🎯 자동화 규칙 (파일별 Priority 결정)

AI가 파일명을 보고 자동으로 Priority를 결정:

```javascript
const AUTO_PRIORITY_RULES = {
  // Critical: 항상 Priority A
  'functions/api/rpc-utils.ts': 'A',
  'functions/api/initiate-withdrawal.ts': 'A',
  'docs/ssot/README.md': 'A',  // 섹션 6-7만 A, 나머지는 C
  
  // Important: 기본 B, 아키텍처 변경이면 A
  'functions/api/*.ts': 'B',      // 예: B → A (Breaking change)
  'src/components/*.tsx': 'B',    // 예: B → C (리팩토링만)
  
  // Normal: 기본 C
  'src/**/*.ts': 'C',
  'docs/**/*.md': 'C',
  '*.css': 'C',
  'README.md': 'C'
};

// AI의 판단 함수
function getPriorityFromFile(filePath, changeType) {
  const rule = AUTO_PRIORITY_RULES[filePath];
  
  // 1. 규칙이 있으면 적용
  if (rule) {
    // 2. 변경 유형에 따라 상향 가능
    if (rule === 'B' && changeType.includes('breaking')) {
      return 'A';  // B → A로 상향
    }
    return rule;
  }
  
  // 3. 규칙이 없으면 기본값
  return 'C';
}
```

---

## 📊 기대 효과

### 시간 절감
| 작업 | 현재 | 개선 후 | 절감 |
|------|------|--------|------|
| 버그 수정 | 2-3시간 | 30-60분 | 60-75% |
| 기능 추가 | 3-4시간 | 1-2시간 | 50% |
| 문서 수정 | 30분 | 5분 | 83% |

### 처리량 증가
- 현재: 1작업/2시간 (6개 Step 모두)
- 개선: 3작업/2시간 (Priority별 선택)
- **증가율: 3배**

### 문서 드리프트 감소
- 현재: Step 4 (문서 동기화) 60% 건너뜀 → 드리프트 위험 높음
- 개선: Priority A는 100% 동기화, B는 간단, C는 자유
- **드리프트 위험: 60% 감소**

---

## 🚀 세션별 워크플로우

### 세션 시작 (필수)

```markdown
## 📋 세션 시작 체크리스트

**Step 1: 상태 파악 (3분)**
- [ ] kanban.md 확인 → 진행 중인 작업
- [ ] CHANGELOG.md 확인 → 최신 버전
- [ ] docs/ssot/README.md 헤더 확인 → 최신 아키텍처

**Step 2: 신규 요청 분류 (1분)**
사용자 요청을 받으면:
- "이건 Priority A일까? B일까? C일까?"
- → 아래 판단 트리 사용

**Step 3: 해당 워크플로우 선택**
- Priority A → Full (Step 1-6)
- Priority B → Mid (Step 3,4,6)
- Priority C → Light (Step 6만)
```

### 판단 트리 (1분 안에 결정)

```
사용자 요청
  │
  ├─ "API 추가해줘" / "RPC 통합해줘" / "아키텍처 변경"
  │  → Priority A (Full)
  │
  ├─ "버그 고쳐줘" / "기능 추가해줘" / "성능 개선"
  │  → Priority B (Mid)
  │
  └─ "오타 수정" / "리팩토링" / "주석 수정"
     → Priority C (Light)
```

---

## ✅ 구현 로드맵

### Phase 1: 문서 작성 & 검토 (지금)
- [ ] 이 문서 작성 ✅ (완료)
- [ ] 사용자 검토 및 승인 (대기 중)
- [ ] 필요시 수정

### Phase 2: 적용 (승인 후 1주)
- [ ] AI 워크플로우 지침서 업데이트 (Full + Lite + Priority)
- [ ] 매 작업마다 Priority 판단 시작
- [ ] kanban.md 템플릿 Priority 컬럼 추가

### Phase 3: 안정화 (2주)
- [ ] 매달 문서 정리 (archives/ 이동)
- [ ] Priority별 처리량 모니터링
- [ ] 필요시 규칙 조정

### Phase 4: 자동화 (3주+)
- [ ] AI가 자동으로 Priority 판단 (의사코드 구현)
- [ ] 파일 변경 시 자동 Priority 결정
- [ ] 월간 보고서 자동 생성

---

## 📞 Q&A

### Q1: Priority A/B/C를 잘못 판단하면?
**A:** 괜찮습니다. 대부분의 판단이 맞을 것이고, 틀려도 사용자가 지적하면 수정하면 됩니다.
- Priority A → B로 잘못 판단 → 문서 동기화 생략 → 사용자가 "문서도 수정해줘" 지적
- 이렇게 점진적으로 규칙이 개선됩니다.

### Q2: CHANGELOG.md는 어떻게 기록하나요?
**A:** Priority별로:
- **Priority A**: 5줄 이상 (상세히)
- **Priority B**: 1-2줄 (간단히)
- **Priority C**: 기록 안 함

예시:
```markdown
### Priority A 기록
feat(rpc): Ankr JSON-RPC 직접 연동 + SeqnoManager
- AnkrRpc 클래스 구현 (5가지 메서드)
- SeqnoManager로 블록체인 동기화
- 성공률 30→95%, 응답시간 5-10s→2-3s

### Priority B 기록
fix(deposit): 사용자 입금 validation 오류 수정

### Priority C 기록
[없음]
```

### Q3: 문서 50+개는 어떻게 되나요?
**A:** 점진적으로:
1. **즉시**: 필수 문서만 정리 (SSOT + workflows)
2. **1주일**: docs/guides/ 생성 (유용한 문서만)
3. **2주일**: docs/archives/ 이동 (과거 파일 자동 정리)
4. **매달**: 1개월 경과 파일 자동 아카이브

---

## 🎓 최종 체크리스트 (구현 전)

**사용자가 확인할 사항:**
- [ ] Priority A/B/C 정의가 명확한가?
- [ ] 3가지 워크플로우 단계가 실행 가능한가?
- [ ] AI가 1분 안에 Priority를 판단할 수 있는가?
- [ ] 자동화 규칙이 합리적인가?
- [ ] 기대 효과 (3배 처리량, 60% 드리프트 감소)에 동의하는가?

**승인되면 즉시 실행 가능합니다.**

---

**다음 단계:**
1. ✅ 사용자가 이 문서 검토 & 피드백
2. ⏳ 필요시 수정 (Priority 규칙 등)
3. ⏳ 문서 최종 승인
4. ⏳ AI 워크플로우 지침서 업데이트 & 적용 시작

