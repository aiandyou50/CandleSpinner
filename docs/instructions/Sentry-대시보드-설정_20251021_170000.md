# Sentry 대시보드 설정 가이드
## 목표: 프로덕션 에러 모니터링 및 대시보드 구성
### 작성 날짜: 2025-10-21

---

## 📋 Sentry 대시보드 설정 단계

### 1단계: Sentry 프로젝트 생성

```bash
# Sentry.io 방문
https://sentry.io/

# 1. 계정 생성/로그인
# 2. 새 프로젝트 생성
#    - Platform: React
#    - Alert Rule: On every new issue
```

**결과**: Sentry DSN 획득
```
https://your_key@your_org.ingest.sentry.io/project_id
```

---

### 2단계: DSN 설정

**`.env.production.local` 파일 생성**:
```bash
VITE_SENTRY_DSN=https://your_key@your_org.ingest.sentry.io/project_id
```

**.gitignore 확인**:
```bash
# 이미 추가됨
.env.production.local
.env.*.local
```

---

### 3단계: 대시보드 커스터마이징

#### A. 알림 규칙 (Alert Rules)

**설정 경로**: Settings → Alerts → Create Alert Rule

**권장 규칙 1: 신규 에러**
```
Condition: A new issue is created
Action: Send to: Slack #errors
```

**권장 규칙 2: 에러 빈도**
```
Condition: Events > 10 in 5 minutes
Action: Send to: Slack #critical
```

**권장 규칙 3: 특정 에러**
```
Condition: error.type contains "TonConnect"
Action: Send to: Slack #blockchain-errors
```

#### B. 이슈 그룹핑

**설정 경로**: Settings → Grouping

**권장 설정**:
```
- Fingerprint: Default
- Group by: Exception + Message
```

이렇게 하면 같은 종류의 에러가 그룹화됩니다.

#### C. 대시보드 커스터마이징

**설정 경로**: Projects → Dashboard

**추천 위젯**:
1. **Issues** (최근 에러 목록)
2. **Events by Release** (버전별 에러)
3. **User Feedback** (사용자 보고)
4. **Crash-free Users** (안정성 지표)

---

### 4단계: Slack 연동

#### A. Slack App 생성
```
1. https://api.slack.com/apps 접속
2. "Create New App" → "From scratch"
3. App name: "Sentry Alerts"
4. 워크스페이스 선택
```

#### B. Permissions 설정
```
OAuth Scopes (Bot Token Scopes) 추가:
- chat:write
- incoming-webhook
```

#### C. Sentry에서 연동
```
Settings → Integrations → Slack

1. "Connect Slack"
2. 채널 선택: #errors, #critical 등
3. "Authorize"
```

---

### 5단계: 알림 임계값 설정

**설정 경로**: Settings → Alert Rules → Configure Threshold

**권장 임계값**:
```
NEW_ISSUE:
  - Every new issue → Slack

ERROR_SPIKE:
  - Events > 50 in 1 hour → Slack #critical
  - Events > 100 in 1 hour → SMS/Email

CRASH_FREE_SESSIONS:
  - < 99% → Slack #critical
  - < 95% → Email alert
```

---

## 🎯 주요 기능 설명

### Dashboard Widgets

**1. Issues**
- 최근 에러 목록
- 해결 상태 추적
- 에러 빈도 표시

**2. Release Performance**
- 버전별 에러율
- Crash-free percentage
- 버전 비교 분석

**3. User Feedback**
- 사용자가 보고한 문제
- 피드백 텍스트
- 연관 에러 표시

**4. Geography**
- 에러 발생 지역
- IP 기반 분석
- 지역별 통계

### Search & Filtering

**에러 검색 예**:
```
# TonConnect 관련 에러
error.type:TonConnectError

# 특정 버전
release:2.1.0

# 특정 사용자
user.id:user123

# 시간 범위
age:-24h
```

---

## 📊 모니터링 항목

### 필수 모니터링
- [ ] Error Rate (에러율)
- [ ] User Impact (영향받는 사용자)
- [ ] Crash-free Rate (안정성)
- [ ] Performance (응답 시간)

### 정기 검토
- [ ] 주간 에러 리포트
- [ ] 월간 트렌드 분석
- [ ] 버전별 성능 비교

---

## 🔧 Advanced 설정

### Source Maps
```
Settings → Source Maps

1. "Upload Release" 클릭
2. 빌드 시 source maps 업로드
3. 스택 트레이스에서 원본 코드 표시
```

### Performance Monitoring
```
Settings → Performance

1. "Enable Performance Monitoring"
2. Sample Rate: 10% (프로덕션에서 부하 고려)
3. Threshold: 3000ms (느린 거래)
```

---

## 📞 문제 해결

### DSN 테스트

```typescript
// src/main.tsx에 테스트 코드 추가
if (import.meta.env.VITE_DEBUG_MODE) {
  // 테스트 에러 발생 (프로덕션에서는 실행 안 됨)
  window.addEventListener('load', () => {
    setTimeout(() => {
      Sentry.captureException(new Error('Sentry Test Event'));
    }, 3000);
  });
}
```

### 알림이 안 올 때
- [ ] DSN 정확한지 확인
- [ ] Slack 채널 권한 확인
- [ ] 알림 규칙 활성화 확인
- [ ] 샘플 에러 발생시켜 테스트

---

## ✅ 체크리스트

- [ ] Sentry 프로젝트 생성
- [ ] DSN 획득 및 설정
- [ ] ErrorBoundary 배포
- [ ] Slack 연동
- [ ] 알림 규칙 3개 이상 생성
- [ ] 대시보드 커스터마이징
- [ ] 테스트 에러 발송
- [ ] 알림 수신 확인

---

## 🚀 프로덕션 배포 전

```bash
# 1. DSN 설정
VITE_SENTRY_DSN=https://your_real_dsn

# 2. 빌드
npm run build

# 3. 테스트 배포
# Cloudflare Pages에 배포

# 4. Sentry에서 에러 수신 확인
# https://your_org.sentry.io/projects/candlespinner/

# 5. 알림 수신 확인
# Slack #errors 채널 확인
```

---

## 📝 참고 자료

- [Sentry React 통합 가이드](https://docs.sentry.io/platforms/javascript/guides/react/)
- [Sentry 알림 규칙](https://docs.sentry.io/alerts/)
- [Slack 통합](https://docs.sentry.io/integrations/slack/)

---

**Status**: 📋 설정 가이드 작성 완료  
**다음 작업**: 실제 Sentry 계정에서 설정 (배포 전)
