# 명령 지시서: Phase 3 코드 리팩토링 및 중복 제거

**작업 ID**: Phase 3-1  
**타임스탐프**: 2025-10-21 18:30:00  
**요청자**: User  
**담당**: AI Agent

---

## 📋 요청 사항

프로젝트의 기술 부채를 해결하고 **코드 품질을 개선**합니다.

### 목표
- 중복 코드 제거 및 함수 추출
- 커스텀 hooks 생성
- 상수 정의 정리 및 타입 안정성 강화
- 코드 일관성 및 가독성 개선

---

## 🎯 상세 작업 항목

### 1. 중복 코드 분석 및 제거
**대상 파일**: `src/components/*.tsx`, `src/hooks/*.ts`

**작업 내용**:
- [ ] 상태 관리 로직 중복 제거 (useState, useCallback)
- [ ] Telegram WebApp API 호출 중복 제거
- [ ] 에러 처리 패턴 통일
- [ ] 스타일 객체 정리 (인라인 스타일 → CSS 모듈 검토)

### 2. 커스텀 hooks 추출
**생성할 hooks**:
- [ ] `useTelegramWebApp()` - TMA 초기화 및 관리
- [ ] `useTonConnect()` - TonConnect 상태 추상화
- [ ] `useDepositState()` - Deposit 컴포넌트 상태 로직 분리
- [ ] `useGameState()` - Game 컴포넌트 상태 로직 분리

**위치**: `src/hooks/[hookName].ts`

### 3. constants.ts 정리
**작업 내용**:
- [ ] 연관된 상수 그룹화 (블록체인, UI, API 등)
- [ ] JSDoc 주석 추가 (설명 및 사용 예시)
- [ ] 타입 정의 분리 (constants.ts → types.ts 일부 이동)
- [ ] 환경변수 검증 함수 개선

**검증**:
```bash
npm run typecheck  # 타입 오류 0
```

### 4. 타입 안정성 강화
**작업 내용**:
- [ ] `src/types.ts` 확대 (컴포넌트 props, API 응답 등)
- [ ] 제너릭 타입 활용 (ApiResponse<T>, LoadingState<T> 등)
- [ ] React.FC 제너릭화 (Props 타입 명시)
- [ ] Null coalescing vs Optional chaining 일관성

### 5. 에러 처리 통일
**작업 내용**:
- [ ] 커스텀 에러 클래스 생성 (AppError, ValidationError 등)
- [ ] 에러 메시지 상수화
- [ ] ErrorBoundary 개선 (에러 분류별 처리)
- [ ] 콘솔 에러 vs Sentry 로그 분류

### 6. 코드 스타일 일관성
**작업 내용**:
- [ ] ESLint 설정 검토 및 자동 fix
- [ ] 함수 선언 방식 통일 (화살표 vs 선언식)
- [ ] Import 정렬 (경로별)
- [ ] 주석 스타일 통일

---

## 📝 구현 계획

| Phase | 작업 | 파일 | 상태 |
|-------|------|------|------|
| 3-1 | 중복 코드 분석 | `src/**/*.tsx` | ⏳ |
| 3-2 | 커스텀 hooks 추출 | `src/hooks/` | ⏳ |
| 3-3 | constants.ts 정리 | `src/constants.ts` | ⏳ |
| 3-4 | 타입 강화 | `src/types.ts` | ⏳ |
| 3-5 | 에러 처리 통일 | `src/utils/errors.ts` | ⏳ |
| 3-6 | 스타일 일관성 | 전체 | ⏳ |
| 3-7 | 코드 리뷰 | - | ⏳ |

---

## 🔍 코드 분석 대상

### 현재 구조 (src/)
```
src/
├── components/
│   ├── App.tsx          (모드 선택 로직)
│   ├── Game.tsx         (게임 상태 관리)
│   ├── Deposit.tsx      (입금 방식 선택)
│   └── ErrorBoundary.tsx (에러 처리)
├── hooks/               (미설정 - 생성 필요)
├── constants.ts         (설정값들)
├── types.ts             (타입 정의)
├── main.tsx             (엔트리)
└── index.css            (전역 스타일)
```

### 리팩토링 우선순위
1. **높음**: 상수 정리, 타입 강화, 에러 처리
2. **중간**: 커스텀 hooks, 중복 제거
3. **낮음**: 스타일 일관성, 주석 정리

---

## ✅ 완료 기준

- [ ] 중복 코드 20% 이상 제거
- [ ] 새 커스텀 hooks 4개 이상 생성
- [ ] TypeScript 타입 검사: 0 errors
- [ ] npm test 통과 (12/12)
- [ ] npm run build 성공
- [ ] ESLint 자동 fix 완료
- [ ] 코드 리뷰 문서 작성
- [ ] Git 커밋 완료 (version bump: v2.2.0)

---

## 📌 선택 사항 (향후)

- [ ] Jest 커버리지 분석
- [ ] 성능 프로파일링 (Chrome DevTools)
- [ ] 번들 분석 개선 (tree-shaking 검증)

---

**Status**: 📋 지시서 생성 완료  
**다음 단계**: Step 3 - 코드 리팩토링 시작

---

### 📚 참고 자료

- [React Hooks Best Practices](https://react.dev/reference/react/hooks)
- [TypeScript Handbook - Advanced Types](https://www.typescriptlang.org/docs/handbook/2/types-from-types.html)
- [Error Handling Patterns](https://www.typescriptlang.org/docs/handbook/2/narrowing.html)
