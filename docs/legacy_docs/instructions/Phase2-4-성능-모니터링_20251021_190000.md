# 명령 지시서: Phase 2-4 성능 모니터링 (Sentry Web Vitals)

**작업 ID**: Phase 2-4  
**타임스탐프**: 2025-10-21 19:00:00  
**요청자**: User  
**담당**: AI Agent

---

## 📋 요청 사항

프로덕션 배포 후 **실제 사용자 성능 추적** 및 **모니터링 대시보드** 구성합니다.

### 목표
- Sentry Web Vitals 추적 활성화
- 성능 메트릭 수집 (Core Web Vitals)
- 성능 대시보드 커스터마이징
- 알림 규칙 설정

---

## 🎯 상세 작업 항목

### 1. Sentry Performance Monitoring 설정
**파일**: `src/main.tsx`

**작업 내용**:
- [ ] `integrations.BrowserTracing()` 추가
- [ ] `tracePropagationTargets` 설정
- [ ] `tracesSampleRate` 설정 (프로덕션: 10%, 개발: 100%)
- [ ] `initialScope` 설정 (사용자 ID, 게임 환경 등)

**코드 예시**:
```typescript
Sentry.init({
  dsn: SENTRY_DSN,
  integrations: [
    new Sentry.BrowserTracing({
      tracePropagationTargets: [
        'localhost',
        /^\//,
        /^https:\/\/aiandyou\.me/,
      ],
    }),
  ],
  tracesSampleRate: DEBUG_MODE ? 1.0 : 0.1,
});
```

### 2. Web Vitals 수집
**패키지**: `web-vitals` 또는 `@sentry/integrations`

**작업 내용**:
- [ ] LCP (Largest Contentful Paint) 추적
- [ ] FID (First Input Delay) / INP (Interaction to Next Paint) 추적
- [ ] CLS (Cumulative Layout Shift) 추적
- [ ] FCP (First Contentful Paint) 추적
- [ ] TTFB (Time to First Byte) 추적

**Sentry의 Web Vitals 통합 활용**:
```typescript
import * as Sentry from '@sentry/react';

const vitals = await Sentry.captureWebVitals();
// Sentry 대시보드에서 자동 추적
```

### 3. 성능 트랜잭션 정의
**트랜잭션 종류**:
- `spin-game` - 스핀 버튼 클릭 ~ 결과 표시
- `deposit-process` - 입금 버튼 클릭 ~ 완료
- `wallet-connect` - 지갑 연결 요청 ~ 완료
- `page-load` - 페이지 로드 시간 (자동)
- `component-render` - 컴포넌트 렌더링 시간

**설정 예시**:
```typescript
const transaction = Sentry.startTransaction({
  op: 'spin',
  name: 'spin-game',
});

// ... 게임 로직 ...

transaction.finish();
```

### 4. 성능 알림 규칙
**설정 위치**: Sentry Settings → Alerts → Performance

**권장 알림**:
1. **LCP 저하**
   ```
   Condition: LCP > 4000ms
   Action: Email + Slack #performance
   ```

2. **FID 저하**
   ```
   Condition: FID > 300ms
   Action: Email + Slack #performance
   ```

3. **CLS 악화**
   ```
   Condition: CLS > 0.1
   Action: Slack #performance
   ```

4. **트랜잭션 실패율**
   ```
   Condition: Failed transactions > 10%
   Action: Slack #critical
   ```

### 5. 성능 대시보드 구성
**위젯 추가**:
- [ ] Web Vitals 트렌드 (7일, 30일)
- [ ] 페이지별 성능 분포
- [ ] 브라우저별 성능 비교
- [ ] 모바일 vs 데스크톱 성능
- [ ] 느린 트랜잭션 TOP 10

### 6. 성능 벤치마크 설정
**기본 목표**:
```
LCP: < 2500ms (Good)
FID: < 100ms (Good)
CLS: < 0.1 (Good)
FCP: < 1800ms (Good)
TTFB: < 600ms (Good)
```

**게임 관련**:
```
Spin Game Duration: 1000-3000ms (권장)
Deposit Process: 3000-5000ms (허용)
Wallet Connection: 2000-8000ms (허용)
```

---

## 📝 구현 계획

| 단계 | 파일 | 작업 | 상태 |
|------|------|------|------|
| 1 | `src/main.tsx` | Sentry Performance 초기화 | ⏳ |
| 2 | `src/hooks/` | 성능 트랜잭션 커스텀 hook | ⏳ |
| 3 | `src/components/` | 주요 컴포넌트에 트랜잭션 적용 | ⏳ |
| 4 | Sentry Dashboard | 알림 규칙 3개 설정 | ⏳ |
| 5 | Sentry Dashboard | 성능 대시보드 커스터마이징 | ⏳ |
| 6 | 문서 | 성능 모니터링 가이드 작성 | ⏳ |

---

## 🔍 성능 추적 대상

### 1. 페이지 레벨
- 초기 로딩 시간
- 상호작용 시간 (TTI)
- 시각적 완성 (FCP, LCP)

### 2. 기능 레벨
| 기능 | 트랜잭션 | 목표 시간 |
|------|---------|----------|
| 게임 스핀 | `spin-game` | 1-3초 |
| 입금 처리 | `deposit-process` | 3-5초 |
| 지갑 연결 | `wallet-connect` | 2-8초 |
| API 호출 | `api-request` | < 1초 |

### 3. 환경별 추적
- 개발자 환경 vs 프로덕션
- 웹 vs Telegram Mini App
- 모바일 vs 데스크톱

---

## ✅ 완료 기준

- [ ] Sentry Performance Monitoring 활성화
- [ ] Web Vitals 수집 시작 (LCP, FID, CLS, FCP)
- [ ] 성능 트랜잭션 4개 이상 정의
- [ ] 성능 알림 규칙 3개 이상 설정
- [ ] 성능 대시보드 커스터마이징 완료
- [ ] 성능 벤치마크 문서 작성
- [ ] TypeScript 검사: 0 errors
- [ ] npm test 통과 (12/12)
- [ ] npm run build 성공
- [ ] Git 커밋 완료 (version bump: v2.3.0)

---

## 📌 배포 전 체크리스트

- [ ] DSN (Production) 설정
- [ ] Sample Rate 조정 (프로덕션: 10%)
- [ ] Slack 연동 확인
- [ ] 성능 목표 설정
- [ ] 팀원 알림 구성

---

**Status**: 📋 지시서 생성 완료  
**다음 단계**: Step 3 - 성능 모니터링 구현

---

### 📚 참고 자료

- [Sentry Performance Monitoring](https://docs.sentry.io/product/performance/)
- [Web Vitals](https://web.dev/vitals/)
- [Sentry Transactions](https://docs.sentry.io/product/performance/transaction-summary/)
