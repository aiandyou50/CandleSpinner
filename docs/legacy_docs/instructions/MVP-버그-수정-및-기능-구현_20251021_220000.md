# MVP 버그 수정 및 기능 구현 지시서

**발급 일시**: 2025-10-21 22:00  
**버전**: v2.5.0  
**상태**: 🚨 **긴급 수정 진행**  

---

## 📋 발견된 문제점

### 🔴 Problem 1: 게임 타이틀 이모지 미렌더링
```
현상: "🚀 Candle Spinner"에서 🚀이모지가 출력 안됨
원인: 폰트/UTF-8 인코딩 설정 부족
영향: UI 표시 문제 (기능에는 영향 X)
```

### 🔴 Problem 2: TonConnect 입금 기능 미작동
```
현상: "TonConnect: 지갑에서 트랜잭션을 확인해주세요" 메시지 출력 후
     - 지갑에서 승인창 미표시
     - 실제 트랜잭션 생성 안됨
원인: Deposit.tsx handleDepositTonConnect에서 sendTransaction 호출 미확인
     - 디버그 로그 없음
     - 에러 캐치가 불완전
영향: 사용자 입금 불가능 (CRITICAL)
```

### 🔴 Problem 3: RPC 입금 테스트 모드 오작동
```
현상: "✅ 입금 성공! 100 CSPIN 추가됨" 메시지 출력 후
     - 실제 트랜잭션 없음
     - 토큰 전송 없음
     - 허위 성공 처리됨
원인: 테스트 모드가 실제 백엔드 API 연동 없이 동작
영향: 게임 로직 검증 불가능 (CRITICAL)
```

### 🔴 Problem 4: TMA WebAppMethodUnsupported 에러
```
에러: "Uncaught (in promise) Error: WebAppMethodUnsupported"
위치: Deposit.tsx showAlert() 호출 시
원인: Telegram WebApp API (showAlert, showPopup 등)가 웹 환경에서 지원 안됨
해결: isTMA 체크 후 console.log로 대체, 또는 일반 alert 사용
```

### 🔴 Problem 5: MVP 핵심 기능 미구현
```
현황: 다음 API 엔드포인트가 functions/api/ 디렉터리에 존재하지 않음:
  ❌ /api/spin - 스핀 실행 및 결과 반환
  ❌ /api/double-up - 미니게임(더블업) 실행
  ❌ /api/collect-winnings - 상금 수령
  ❌ /api/deposit - CSPIN 입금 처리
  ❌ /api/withdrawal - CSPIN 인출 처리
  ❌ /api/rpc - RPC 프록시 (optional)

영향: 게임 핵심 기능 동작 불가능 (CRITICAL!)
```

---

## 📊 우선순위

| # | 작업 | 우선순위 | 소요시간 |
|---|------|---------|---------|
| 1 | MVP 기능 체크리스트 | 🔴🔴🔴 | 5분 |
| 2 | functions/api/ 디렉터리 스캔 | 🔴🔴🔴 | 5분 |
| 3 | TonConnect 기능 디버깅 | 🔴🔴 | 30분 |
| 4 | TMA 에러 수정 | 🔴 | 10분 |
| 5 | 게임 이모지 수정 | 🟡 | 5분 |

---

## ✅ 예상 해결 방안

### 방안 1: TonConnect 입금 기능 복구
```
1. Deposit.tsx handleDepositTonConnect에 디버그 로그 추가
2. sendTransaction 호출 확인
3. 에러 캐시 개선
4. 트랜잭션 상태 확인 로직 추가
```

### 방안 2: RPC 테스트 모드 분리
```
1. 테스트 모드와 실제 모드 분리
2. 테스트 모드: 로컬 상태 업데이트만 (실제 API 호출 X)
3. 실제 모드: 백엔드 API 호출
4. 환경 변수로 모드 선택
```

### 방안 3: TMA 호환성 개선
```
1. 모든 WebApp API 호출 전 isTMA + 메서드 체크
2. 지원 안 하는 메서드: console.log 또는 일반 alert 사용
3. showAlert, showPopup 대신 일반 alert() 사용
4. Error 핸들러 추가
```

### 방안 4: MVP 기능 구현
```
이 지시서 완료 후 별도 Phase로 진행
- Phase 3-4: 백엔드 API 스텁(stub) 구현
- Phase 3-5: 프론트엔드-백엔드 연동
```

---

## 🎯 다음 단계

1. **Step 1**: functions/api/ 디렉터리 현황 파악
2. **Step 2**: 각 문제별 근본 원인 분석
3. **Step 3**: 우선순위순 수정 적용
4. **Step 4**: 테스트 및 배포

---

**상태**: 📝 지시서 생성 완료  
**다음**: Step 2 - functions/api/ 디렉터리 스캔
