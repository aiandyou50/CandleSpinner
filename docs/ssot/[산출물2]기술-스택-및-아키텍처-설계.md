[산출물 2] 기술 스택 및 아키텍처 설계 (v1.5 - A/B 이중 입금 방식)
 * 프로젝트명: CandleSpinner
 * 버전: 1.5 (A/B 이중 입금 방식 추가)
 * 작성일: 2025년 10월 21일
 * 목표: 확장 가능하고, 개발 생산성이 높으며, 서버리스 환경에 최적화된 기술 스택을 정의한다.
1. 시스템 아키텍처 다이어그램 (System Architecture Diagram)
┌──────────────────┐      ┌──────────────────────────────┐      ┌────────────────────────┐
│   User's Device  │      │   Cloudflare Pages Network   │      │      TON Blockchain    │
│ (Web Browser)    ├──────▶ (Full Stack Platform)       ├──────▶ (Smart Contracts &   │
└──────────────────┘      │  - Frontend (React UI)     │      │   User's TON Wallet)   │
         ▲                │  - Backend (Functions)     │      └────────────────────────┘
         │                └───────────┬────────────────┘
         │                            │
         │                            │
         └────────────────────────────┘
(User Interaction)      (Off-chain Logic & API)         (On-chain Transactions)

 * User's Device: 사용자가 모바일 또는 PC 브라우저를 통해 게임에 접속합니다.
 * Cloudflare Network:
   * Cloudflare Pages (Full Stack Platform): 깃허브 레포지토리와 연결된 단일 플랫폼입니다. 사용자의 React 프론트엔드(정적 에셋)와 백엔드 서버리스 함수(Workers 로직)를 함께 빌드하고 전 세계 엣지 네트워크에 배포합니다.
 * TON Blockchain: 실제 자산(CSPIN 토큰)의 입금 및 인출을 처리하는 탈중앙화 네트워크입니다.
2. 프론트엔드 (Frontend)
사용자 인터페이스와 경험을 담당하는 영역입니다. (Cloudflare Pages가 정적 에셋으로 빌드하여 제공)
 * 개발 프레임워크: React (with Vite)
   * 선택 이유: 가장 큰 개발자 생태계를 보유하고 있어 라이브러리 및 레퍼런스 확보가 용이합니다. Vite를 빌드 도구로 사용하여 매우 빠른 개발 서버 속도와 최적화된 빌드 결과를 보장합니다.
 * 그래픽 및 애니메이션: PixiJS
   * 선택 이유: WebGL 기반의 고성능 2D 렌더링 라이브러리로, 슬롯머신의 부드러운 릴(Reel) 회전 및 화려한 당첨 효과를 구현하는 데 최적화되어 있습니다.
 * UI 컴포넌트 및 스타일링: Tailwind CSS & shadcn/ui
   * 선택 이유: 유틸리티 우선(Utility-first) 접근 방식으로 신속하게 UI를 구축할 수 있습니다. shadcn/ui를 통해 미리 디자인된 고품질 컴포넌트(버튼, 입력 필드 등)를 손쉽게 커스터마이징하여 네온사인 컨셉을 구현합니다.
 * 상태 관리: Zustand
   * 선택 이유: 매우 가볍고 간단한 API를 제공하여 React의 상태 관리를 쉽게 만들어 줍니다. 사용자의 게임 크레딧, 베팅 금액 등 전역적으로 관리되어야 할 상태를 효율적으로 처리합니다.
 * 다국어 지원(i18n): i18next
   * 선택 이유: React 환경에서 가장 널리 사용되는 국제화 라이브러리로, 정의서에 명시된 7개 언어를 체계적으로 관리하고 동적으로 변경하는 기능을 제공합니다.
3. 백엔드 (Serverless Functions on Pages)
오프체인 게임 로직을 처리하는 서버 영역입니다. 이 로직은 Cloudflare의 Workers 기술을 기반으로 하며, 프론트엔드와 동일한 Cloudflare Pages 플랫폼을 통해 배포됩니다.
 * 플랫폼: Cloudflare Pages (Functions)
   * 선택 이유: 별도의 백엔드 서버나 Workers 플랫폼 설정 없이, React 앱과 동일한 프로젝트 내 functions/ 디렉토리에 API 코드를 작성하면(Pages Full Stack) 자동으로 배포됩니다. 이는 글로벌 엣지에서 실행되어 빠른 응답 속도를 보장합니다.
 * 언어: TypeScript
   * 선택 이유: 정적 타입을 지원하여 코드의 안정성을 높이고, 프론트엔드와 동일한 언어를 사용하여 개발 생산성을 극대화합니다.
 * 환경 변수 (Environment Variables):
   * GAME_WALLET_PRIVATE_KEY: 게임 지갑의 프라이빗 키 (16진수 형식). 니모닉에서 wallet-tools/mnemonic-to-key.mjs를 통해 변환하여 설정.
   * 선택 이유: CSPIN 인출 트랜잭션 서명을 위해 필요하며, Cloudflare 대시보드에서 암호화된 환경변수로 안전하게 관리.
 * 핵심 API 엔드포인트:
   * (Pages는 functions/api/spin.ts 파일을 /api/spin으로 자동 라우팅합니다.)
   * /api/spin: 사용자의 베팅 요청을 받아 Provably Fair 알고리즘으로 스핀 결과를 생성하고 반환합니다.
   * /api/double-up: 미니게임 요청을 받아 50% 확률의 성공/실패 결과를 반환합니다.
   * /api/state: 사용자의 현재 게임 크레딧 상태를 조회합니다.
 * 오프체인 데이터 저장소: Cloudflare KV
   * 선택 이유: Cloudflare Pages Functions(Workers 로직)에 최적화된 초저지연 Key-Value 저장소입니다. 사용자의 지갑 주소를 Key로, 현재 보유 크레딧을 Value로 저장하여 오프체인 잔액을 관리하는 데 가장 이상적입니다. (예: {'UQBF...R8Mtd': { credit: 5000 }})
4. 블록체인 연동 (Blockchain Integration)
웹 애플리케이션과 TON 블록체인을 연결하는 영역입니다.
 * 지갑 연결 UI: @tonconnect/ui-react
   * 선택 이유: TON 공식 라이브러리로, 'Wallet 연결' 버튼과 QR 코드 모달 등 TON Connect 표준 UI를 단 몇 줄의 코드로 손쉽게 구현할 수 있습니다.
 * 트랜잭션 생성 및 전송: ton-core, ton-crypto
   * 선택 이유: TON 블록체인의 트랜잭션을 구성하고 서명을 요청하는 핵심 라이브러리입니다. 프론트엔드에서 이 라이브러리들을 사용하여 CSPIN 토큰의 입금(Deposit) 및 인출(Withdraw) 트랜잭션 메시지를 생성하고, 사용자의 지갑에 전송하여 서명을 요청하게 됩니다.
5. 개발 및 배포 (CI/CD Pipeline)
 * 소스 코드 관리: GitHub
   * 역할: 모든 프론트엔드(React) 및 백엔드(Functions) 코드를 단일 저장소에서 관리.
 * 자동 빌드 및 배포: Cloudflare Pages GitHub Integration
   * 작동 방식:
     * 개발자가 main 브랜치에 코드를 git push 합니다.
     * GitHub이 변경 사항을 Cloudflare Pages에 자동으로 알립니다.
     * Cloudflare Pages는 최신 코드를 가져와 React 앱을 빌드(정적 파일 생성)하고, functions/ 디렉토리의 백엔드 코드(Workers 로직)를 함께 패키징합니다.
     * 빌드가 성공하면, 새로운 버전이 전 세계 Cloudflare 엣지 네트워크에 수 분 내로 배포 완료됩니다.
