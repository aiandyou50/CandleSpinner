# π”§ μμ • μ™„λ£ λ³΄κ³ μ„ (2025-10-23)

**μμ • λ€μƒ:** λ”λΈ”μ—… React Error + μΈμ¶ λ””λ²„κΉ…  
**λ°°ν¬ μƒνƒ:** μ¤€λΉ„ μ™„λ£  

---

## β… μμ • μ‚¬ν•­

### **1. React Error #310 (λ”λΈ”μ—… μ¤λ¥) - μμ • μ™„λ£**

**λ¬Έμ :**
```
π¨ μ• μ μ—†λ” μ¤λ¥κ°€ λ°μƒν–μµλ‹λ‹¤
Minified React error #310
```

**μ›μΈ:**
- `useState` ν›…μ΄ μ»΄ν¬λ„νΈ λ λ”λ§ ν•¨μ λ‚΄λ¶€μ—μ„ μ„ μ–Έλ¨
- Reactλ” λ¨λ“  stateλ¥Ό μ»΄ν¬λ„νΈ μµμƒμ„μ—μ„λ§ μ„ μ–Έν•΄μ•Ό ν•λ” κ·μΉ™ μμ

**μμ •:**
```typescript
// β μ΄μ „ (μλ»λ¨)
if (currentScreen === 'doubleup') {
  const [doubleupChoice, setDoubleupChoice] = useState(...);  // ν•¨μ λ‚΄λ¶€!
}

// β… μμ • (μ¬λ°”λ¦„)
const [doubleupChoice, setDoubleupChoice] = useState(null);  // μ»΄ν¬λ„νΈ top-level
const [doubleupResult, setDoubleupResult] = useState(null);

if (currentScreen === 'doubleup') {
  const handleDoubleupChoice = (choice) => {
    setDoubleupChoice(choice);
    // ...
  };
}
```

**μμ • νμΌ:**
- `src/components/GameComplete.tsx` (Line 28-29, Line 776 λ“±)

---

### **2. λ”λΈ”μ—… μƒνƒ λ¦¬μ…‹ - κ°•ν™”**

**κ°μ„  μ‚¬ν•­:**
- λ”λΈ”μ—… μ„±κ³µ ν›„ β†’ μλ Ή ν™”λ©΄μΌλ΅ μ΄λ™ μ‹ μƒνƒ λ¦¬μ…‹
- λ”λΈ”μ—… μ‹¤ν¨ ν›„ β†’ λ©”μΈμΌλ΅ λμ•„κ° μ‹ μƒνƒ λ¦¬μ…‹
- μ΄λ ‡κ² ν•λ©΄ λ‹¤μ‹ κ²μ„ν•  λ• μ΄μ „ κ²°κ³Όμ μν–¥ μ κ±°

**μμ • μ½”λ“:**
```typescript
// "κ³„μ† κ²μ„" λ²„νΌ
onClick={async () => {
  await saveGameState();
  setDoubleupChoice(null);
  setDoubleupResult(null);
  setCurrentScreen('main');
}}

// λ”λΈ”μ—… μ‹¤ν¨ ν›„
setTimeout(() => {
  setDoubleupChoice(null);
  setDoubleupResult(null);
  setCurrentScreen('main');
  setLastWinnings(0);
}, 1500);
```

---

### **3. μΈμ¶ API κ°μ„  (TON μμλ£ μ§„λ‹¨)**

**μƒλ΅ μ¶”κ°€λ νμΌ:**

#### **a) `/api/debug-private-key` (μƒλ΅ μƒμ„±)**
- κ°μΈν‚¤ ν•μ‹ κ²€μ¦ (Hex vs Mnemonic)
- κ°μΈν‚¤ κΈΈμ΄ ν™•μΈ (128μ = 64bytes)
- κ°μΈν‚¤λ΅λ¶€ν„° κ²μ„ μ§€κ°‘ μ£Όμ† μƒμ„± κ°€λ¥ μ—¬λ¶€ ν™•μΈ
- μƒμ„±λ μ£Όμ†μ™€ ν™κ²½λ³€μ μ£Όμ† μΌμΉ μ—¬λ¶€ ν™•μΈ

**μ‚¬μ©λ²•:**
```bash
GET https://aiandyou.me/api/debug-private-key
```

**μ‘λ‹µ μμ‹:**
```json
{
  "status": "β… λ¨λ“  κ²€μ¦ ν†µκ³Ό!",
  "format": "HEX",
  "privateKeyLength": 128,
  "privateKeyLength_bytes": 64,
  "keyPairCreated": true,
  "derivedWalletAddress": "UQBFPDdS...",
  "addressMatches": true,
  "verification": "β… κ°μΈν‚¤μ™€ μ§€κ°‘ μ£Όμ†κ°€ μΌμΉν•©λ‹λ‹¤!"
}
```

#### **b) μΈμ¶ API κ°μ„  (`initiate-withdrawal.ts`)**

**μ¶”κ°€ ν•¨μ:**
```typescript
// κ²μ„ μ§€κ°‘μ TON μ”μ•΅ ν™•μΈ
async function getGameWalletTonBalance(
  gameWalletAddress: string
): Promise<{ balance: bigint; isEnough: boolean }>

// ν•„μ” TON: 0.05 TON (μ¶©λ¶„ν• μ—¬μ )
// λ°ν™κ°’: 
//   - balance: ν„μ¬ μ”μ•΅ (nanotons)
//   - isEnough: μΈμ¶ κ°€λ¥ μ—¬λ¶€
```

**μ¶”κ°€ Step:**
```typescript
// Step 5.5: κ²μ„ μ§€κ°‘μ TON μ”μ•΅ ν™•μΈ (κ²½κ³ λ§)
const tonStatus = await getGameWalletTonBalance(gameWallet.address.toString());
if (!tonStatus.isEnough) {
  console.warn(`β οΈ κ²μ„ μ§€κ°‘μ TON λ¶€μ΅±: ${(Number(tonStatus.balance) / 1e9).toFixed(4)} TON`);
  // κ²½κ³ λ§ ν•κ³  κ³„μ† μ§„ν–‰ (μ‹¤ν¨ν•  κ°€λ¥μ„± μμ)
}
```

---

## π“‹ λ‹Ήμ‹ μ΄ ν•΄μ•Ό ν•  μ‘μ—…

### **1. κ°μΈν‚¤ ν•μ‹ ν™•μΈ**

```bash
# ν„°λ―Έλ„μ—μ„ μ‹¤ν–‰
curl https://aiandyou.me/api/debug-private-key
```

**κ²°κ³Ό ν™•μΈ:**
- β… `"status": "β… λ¨λ“  κ²€μ¦ ν†µκ³Ό!"`μ΄λ©΄ κ°μΈν‚¤ OK
- β `"format": "POSSIBLY_MNEMONIC"`μ΄λ©΄ κ°μΈν‚¤ ν•μ‹ μμ • ν•„μ”

**κ°μΈν‚¤κ°€ Mnemonicμ΄λ©΄:**
```bash
# wallet-tools/ ν΄λ”μ μ¤ν¬λ¦½νΈ μ‚¬μ©
node wallet-tools/mnemonic-to-key.mjs <λ‹λ¨λ‹‰μ½”λ“ 12κ° λ‹¨μ–΄>

# κ²°κ³Όμ "privateKey" κ°’μ„ wrangler.tomlμ— μ„¤μ •
```

### **2. κ²μ„ μ§€κ°‘μ— TON μ…κΈ (ν•„μ)**

ν„μ¬ μΈμ¶ μ‹¤ν¨ μ›μΈ:
- κ²μ„ μ§€κ°‘μ TON λ¶€μ΅± κ°€λ¥μ„± λ†’μ
- μΈμ¶ν•  λ•λ§λ‹¤ 0.03-0.05 TON ν•„μ”

**ν•΄κ²°:**
```bash
# κ²μ„ μ§€κ°‘ μ£Όμ†μ— 0.5 TON μ…κΈ
# (TON μ§€κ°‘ μ•±μ—μ„ μλ™μΌλ΅ μ „μ†΅)

κ²μ„ μ§€κ°‘: UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd
κΈμ•΅: 0.5 TON
```

### **3. λ‹¤μ‹ ν…μ¤νΈ**

```bash
# κ°μΈν‚¤ κ²€μ¦
curl https://aiandyou.me/api/debug-private-key

# μΈμ¶ μ‹λ„
# κ²μ„ UIμ—μ„ "μΈμ¶" λ²„νΌ ν΄λ¦­
```

---

## π“ μμƒ κ²°κ³Ό

| ν•­λ© | μ΄μ „ | ν„μ¬ |
|------|------|------|
| λ”λΈ”μ—… ν΄λ¦­ | β React Error #310 | β… μ •μƒ μ‘λ™ |
| λ”λΈ”μ—… μƒνƒ | β οΈ κ³„μ† λ‚¨μ | β… μλ™ λ¦¬μ…‹ |
| μΈμ¶ μ¤λ¥ | 500 μ—λ¬ | π” μ›μΈ μ§„λ‹¨ κ°€λ¥ |
| TON λ¶€μ΅± | λ―Έμ§„λ‹¨ | β… μ‚¬μ „ ν™•μΈ κ°€λ¥ |

---

## π€ λ°°ν¬ μ²΄ν¬λ¦¬μ¤νΈ

- [x] React Error μμ •
- [x] λ”λΈ”μ—… μƒνƒ λ¦¬μ…‹ κ°•ν™”
- [x] κ°μΈν‚¤ λ””λ²„κ·Έ API μ¶”κ°€
- [x] TON μ”μ•΅ ν™•μΈ λ΅μ§ μ¶”κ°€
- [ ] κ°μΈν‚¤ ν•μ‹ ν™•μΈ (λ‹Ήμ‹  μ‘μ—…)
- [ ] κ²μ„ μ§€κ°‘μ— TON μ…κΈ (λ‹Ήμ‹  μ‘μ—…)
- [ ] μ¬ν…μ¤νΈ (λ‹Ήμ‹  μ‘μ—…)
- [ ] λ°°ν¬ (git push)

---

**λ¬Έμ  λ°μƒ μ‹ μ„μ λ””λ²„κ·Έ API μ‚¬μ©ν•μ—¬ μ§„λ‹¨ν•μ„Έμ”!**

