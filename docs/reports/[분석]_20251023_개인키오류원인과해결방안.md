# 🔧 [Step 3-Phase 1] 개인키 오류 해결 방안

**문제:** 환경변수의 개인키가 다른 지갑(EQCdUA1O...)을 생성 중
**영향:** 인출 기능 완전히 불가능 (게임 지갑의 개인키가 아님)
**해결:** 올바른 게임 지갑의 개인키 재설정

---

## 진단

### 현재 상태
```
환경변수 지갑: UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd (✅ 올바름)
개인키 검증 결과: EQCdUA1OC3KbqGyEB9DLfcvjF9LaHtOBCqyoAAzxmzIVuMyR ❌ 다른 지갑

결론: GAME_WALLET_PRIVATE_KEY는 UQBFPDdS... 지갑의 개인키가 아님!
```

---

## 해결 방법 (3가지 옵션)

### **옵션 1: 기존 게임 지갑 개인키 찾기** (권장)
```bash
# wallet-tools 폴더의 mnemonic-to-key.mjs 사용
# 게임 지갑 생성 시 사용했던 니모닉이 있으면:

node wallet-tools/mnemonic-to-key.mjs <12개_니모닉_단어>

# 결과에서 "privateKey" 항목 확인
# 생성된 주소가 UQBFPDdS...와 일치하는지 확인
```

### **옵션 2: 새 게임 지갑 생성 (위험)**
```bash
# 완전히 새로운 지갑을 생성하면:
# - 기존 게임 지갑의 CSPIN 포기
# - 새로운 CSPIN_JETTON_WALLET 주소 필요
# - 환경변수 모두 재설정

node wallet-tools/generate-wallet.mjs

# ⚠️ 이 방법은 기존 자산 손실 위험 있음!
```

### **옵션 3: 개발팀에 문의** (안전)
```
게임 지갑 생성 시 기록한 니모닉이 있는지 확인
또는 Tonwhales 지갑 에서 내보낸 개인키 재확인
```

---

## 당신이 해야 할 작업

1. **게임 지갑 생성 기록 찾기**
   - 언제 생성했는가?
   - 니모닉 코드 어디 보관?
   - 기존 개인키 백업?

2. **올바른 개인키 생성**
   ```bash
   # 니모닉이 있으면:
   node wallet-tools/mnemonic-to-key.mjs word1 word2 word3 word4 word5 word6 word7 word8 word9 word10 word11 word12
   
   # 또는 Tonwhales에서 내보내기
   ```

3. **검증**
   ```bash
   curl https://aiandyou.me/api/debug-private-key
   # "addressMatches": true 확인
   ```

4. **wrangler.toml 업데이트**
   ```toml
   [env.production.vars]
   GAME_WALLET_PRIVATE_KEY = "올바른_개인키_128자"
   ```

5. **배포 및 재테스트**

---

## 임시 해결책 (Test)

지금 바로 테스트하고 싶으면:
```bash
# 현재 생성되는 지갑(EQCdUA1O...)으로 환경변수 주소 변경
# ⚠️ 주의: CSPIN은 이전 주소로 계속 가야 함
```

---

**❓ 니모닉이나 기존 개인키 기록이 있나요?**

