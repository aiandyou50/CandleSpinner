# [보고서]_20251021_TON-학습-및-스마트컨트랙트-가이드

**작성자**: AI 학습 엔진  
**범위**: ton-docs 폴더 기반 TON 생태계 학습  
**목표**: CandleSpinner에서 필요한 TON 지식 정리

---

## 1️⃣ **TON 블록체인 소개**

### TON이란?
```
Telegram Open Network의 약자
- 완전 탈중앙화 블록체인
- 높은 TPS (초당 트랜잭션 수: 100,000+)
- 낮은 트랜잭션 비용
- Telegram 생태계 통합
```

### 참고 자료 위치
```
ton-docs/
├── docs/v3/concepts/         ← 기본 개념
├── docs/v3/guidelines/       ← 개발 가이드라인
├── src/pages/develop/        ← 개발자 가이드
└── static/example-code-snippets/ ← 코드 예제
```

---

## 2️⃣ **CandleSpinner 관련 핵심 개념**

### ✅ 우리가 사용 중인 개념

#### **a) Wallet & TonConnect**
```typescript
// 현재 구현
import { TonConnectButton, useTonWallet } from '@tonconnect/ui-react';

const wallet = useTonWallet(); // 사용자 지갑 정보
```

**개념**:
- TON 표준 지갑 연결 프로토콜
- QR 코드 또는 브라우저 확장프로그램으로 연결
- 사용자의 개인키는 클라이언트에만 보관 (안전)
- 트랜잭션 서명만 사용자 지갑에서 진행

**학습 경로**:
```
ton-docs/docs/v3/concepts/wallets/ → TonConnect 정의
ton-docs/docs/v3/guidelines/smart-contracts/ → 지갑과 스마트계약 상호작용
```

#### **b) Jetton (TON 기반 토큰)**
```typescript
// CandleSpinner의 CSPIN이 바로 Jetton
const CSPIN_TOKEN_MASTER = 'EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV';
```

**개념**:
- Ethereum의 ERC-20 같은 표준
- Master Contract와 각 사용자의 Wallet Contract로 이루어짐
- Transfer를 위해서는 특별한 메시지 형식 필요

**Jetton 표준 문서**:
```
ton-docs/docs/v3/concepts/tokens/jettons.md
```

**구조**:
```
Jetton Master Contract (CSPIN_TOKEN_MASTER)
    ↓
    └─ User Wallet Contract 1 (내가 가진 CSPIN)
    └─ User Wallet Contract 2 (다른 사람이 가진 CSPIN)
    └─ User Wallet Contract 3 ...
```

#### **c) 트랜잭션 (Transaction) 구조**
```typescript
// 현재 구현
const transaction = {
  validUntil: Math.floor(Date.now() / 1000) + 600,  // 10분 유효
  messages: [
    {
      address: GAME_WALLET_ADDRESS,  // 받는 주소
      amount: (BigInt(amount) * BigInt(1000000000)).toString(), // nano TON
      payload: undefined  // 추가 데이터 (선택)
    }
  ]
};
```

**개념**:
- `validUntil`: 트랜잭션 유효 기간
- `messages`: 보낼 메시지 배열 (여러 개 동시 송금 가능)
- `address`: 수신자 지갑 주소
- `amount`: nano TON 단위 (1 TON = 1,000,000,000 nano TON)
- `payload`: 스마트계약 호출시 필요한 데이터

**참고**:
```
ton-docs/docs/v3/guidelines/smart-contracts/tx-params.md
```

#### **d) Cell & BOC (Bag of Cells)**
```typescript
// TonConnect 결과
const result = await tonConnectUI.sendTransaction(transaction);
// result.boc = "serialized cell data" (16진수 문자열)
```

**개념**:
- TON의 모든 데이터는 **Cell** 단위로 저장
- **BOC**: 여러 Cell을 직렬화한 형식
- 스마트계약, 트랜잭션, 상태 모두 Cell/BOC로 표현

**참고**:
```
ton-docs/docs/v3/concepts/cells.md
ton-docs/docs/v3/concepts/boc.md
```

---

## 3️⃣ **향후 구현 예정: Jetton Transfer**

### 현재 방식 (v2.1.0)
```
사용자 → TON 직접 전송 → 게임 지갑
```

### 향후 방식 (v3.0.0?)
```
사용자 → CSPIN Jetton 전송 → 게임 지갑
```

### Jetton Transfer 메시지 구조
```typescript
// 예제 (아직 미구현)
const jettonTransferMessage = {
  // Message Type: transfer
  // 수신: CSPIN Jetton Wallet Contract
  // 내용: 다른 지갑으로 토큰 전송
  
  "type": 0xf8a7ea5, // Jetton transfer opcode
  "queryId": 0,
  "amount": BigInt(depositAmount) * BigInt(1000000000), // CSPIN 양
  "destination": GAME_WALLET_ADDRESS, // 받는 지갑
  "responseAddress": senderAddress, // 실패시 반환받는 지갑
  "customPayload": null,
  "forwardAmount": BigInt(1),
  "forwardPayload": null
};
```

### 학습 자료
```
ton-docs/docs/v3/concepts/tokens/jettons.md
ton-docs/docs/v3/guidelines/smart-contracts/messages.md
```

---

## 4️⃣ **ton-docs의 주요 섹션 가이드**

### 📚 **Concepts** (개념 이해)
```
ton-docs/docs/v3/concepts/
├── addresses.md          ← TON 지갑 주소 형식
├── cells.md              ← Cell 구조
├── boc.md                ← BOC 직렬화
├── contracts/            ← 스마트계약 기초
├── languages/            ← 계약 개발 언어 (FunC, Tact)
├── tokens/
│   ├── nft.md            ← NFT 표준
│   └── jettons.md        ← 토큰 표준 ⭐
└── wallets/              ← 지갑 표준
```

### 🛠️ **Guidelines** (개발 가이드)
```
ton-docs/docs/v3/guidelines/
├── smart-contracts/
│   ├── anatomy.md        ← 계약 구조
│   ├── messages.md       ← 메시지 형식 ⭐
│   ├── jettons/
│   │   ├── overview.md
│   │   ├── operations.md ← Transfer 등
│   │   └── standards.md
│   └── ton-core.md       ← @ton/core 라이브러리
└── deploy/               ← 배포 가이드
```

### 🎯 **Develop** (개발자 자료)
```
ton-docs/src/pages/develop/
├── getting-started/      ← 시작하기
├── circuit-breaker/      ← 고급 개념
└── testing/              ← 테스트
```

### 📄 **Example Code**
```
ton-docs/static/example-code-snippets/
├── ton-core/             ← @ton/core 예제
└── contracts/            ← FunC 컨트랙트 예제
```

---

## 5️⃣ **필독 문서 목록 (CandleSpinner 우선순위)**

| 순서 | 문서 | 파일 경로 | 이유 | 시간 |
|------|------|---------|------|------|
| 1️⃣ | **Jetton 표준** | `docs/v3/concepts/tokens/jettons.md` | CSPIN 토큰 이해 필수 | 30분 |
| 2️⃣ | **메시지 구조** | `docs/v3/guidelines/smart-contracts/messages.md` | Jetton transfer 구현 필요 | 20분 |
| 3️⃣ | **주소 형식** | `docs/v3/concepts/addresses.md` | BOQ/BOUNC 형식 이해 | 15분 |
| 4️⃣ | **Cell & BOC** | `docs/v3/concepts/cells.md`, `boc.md` | 데이터 직렬화 이해 | 25분 |
| 5️⃣ | **TonConnect** | `docs/v3/guidelines/wallets/tonconnect.md` | 지갑 연결 심화 | 20분 |
| 6️⃣ | **ton-core API** | `docs/v3/guidelines/smart-contracts/ton-core.md` | @ton/core 라이브러리 | 30분 |

**총 예상 시간**: 약 2시간

---

## 6️⃣ **실습 예제 (학습 후 시도할 것)**

### 예제 1: Jetton 주소 확인
```typescript
// ton-docs/static/example-code-snippets/ton-core/
// address 관련 예제 참고

import { Address } from '@ton/core';

// CSPIN 주소 파싱
const cspin = Address.parse('EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV');
console.log(cspin.toString()); // 표준 형식
console.log(cspin.toString({ urlSafe: true })); // URL 안전 형식
```

### 예제 2: 트랜잭션 메시지 생성
```typescript
// ton-docs/docs/v3/guidelines/smart-contracts/messages.md 참고

import { beginCell } from '@ton/core';

const message = beginCell()
  .storeUint(0xf8a7ea5, 32) // Jetton transfer opcode
  .storeUint(0, 64)           // queryId
  .storeCoins(1000000000)      // amount
  .storeAddress(destinationAddress)
  .endCell();
```

### 예제 3: BOC 직렬화
```typescript
// ton-docs/docs/v3/concepts/boc.md 참고

import { beginCell, Cell } from '@ton/core';

const cell = beginCell().storeString("Hello TON").endCell();
const bocString = cell.toBoc().toString('hex'); // BOC 변환
```

---

## 7️⃣ **주의사항 및 Best Practices**

### ⚠️ **흔한 실수**

1. **주소 형식 혼동**
```
❌ 잘못된 예:
const addr = 'EQBZ6...'; // 문자열

✅ 올바른 예:
import { Address } from '@ton/core';
const addr = Address.parse('EQBZ6...');
```

2. **단위 혼동**
```
❌ 잘못된 예:
amount: 100 // 100 TON이 아니라 100 nano TON!

✅ 올바른 예:
amount: BigInt(100) * BigInt(1000000000) // 100 TON
```

3. **스마트계약 호출**
```
❌ 잘못된 예:
// payload가 없으면 계약이 실행되지 않음

✅ 올바른 예:
payload: beginCell()
  .storeUint(0xf8a7ea5, 32) // opcode
  .storeUint(0, 64)          // queryId
  .endCell()
```

### ✅ **Best Practices**

1. **항상 `BigInt` 사용**
   - TON의 금액은 매우 크므로 `BigInt` 필수
   - JavaScript 숫자는 정확도 손실

2. **트랜잭션 유효 기간 설정**
   ```typescript
   validUntil: Math.floor(Date.now() / 1000) + 600 // 10분
   ```

3. **에러 처리**
   ```typescript
   try {
     const result = await tonConnectUI.sendTransaction(tx);
   } catch (e) {
     // 사용자 거부, 네트워크 오류 등
     console.error('TX failed:', e);
   }
   ```

---

## 8️⃣ **다음 단계: Jetton Transfer 구현 로드맵**

### Phase 1: 지식 축적 (현재)
- [ ] Jetton 표준 완독
- [ ] 메시지 구조 이해
- [ ] ton-core API 익숙해지기

### Phase 2: 프로토타입 (v3.0.0)
- [ ] Jetton transfer 메시지 생성 함수 작성
- [ ] 테스트넷에서 CSPIN transfer 테스트
- [ ] 실패 케이스 처리

### Phase 3: 프로덕션 (v3.1.0)
- [ ] 메인넷에 배포
- [ ] 실제 사용자 입금 테스트
- [ ] 모니터링 및 최적화

---

## 📚 **추가 리소스**

### 공식 톱소스
- **ton-docs**: https://ton.org/docs/
- **ton-core 라이브러리**: https://github.com/ton-org/ton-core
- **TonConnect 라이브러리**: https://github.com/ton-connect/sdk

### 커뮤니티
- **TON 개발자 포럼**: https://forum.ton.org/
- **GitHub Discussions**: https://github.com/ton-org/

### 테스트넷 도구
- **Testnet Faucet**: https://testnet-faucet.ton.org/
- **Testnet Explorer**: https://testnet.tonscan.org/

---

**작성 일시**: 2025-10-21 01:30 KST  
**마지막 업데이트**: ton-docs 기반 분석  
**다음 리뷰**: v3.0.0 Jetton transfer 구현 시점
