# [보고서]_20251021_TMA-모드-분석

**작성자**: AI 분석 엔진  
**분석 범위**: isTMA 플래그의 UI/동작 차이  
**버전**: v2.1.0

---

## 1️⃣ **TMA (Telegram Mini App) 모드란?**

### 정의
```typescript
const isTMA = typeof window !== 'undefined' && window.Telegram?.WebApp;
```

- ✅ **True**: Telegram 내장 브라우저에서 실행 (Mini App)
- ❌ **False**: 일반 웹 브라우저에서 실행 (웹사이트)

---

## 2️⃣ **TMA On (Telegram Mini App 모드)**

### 특징
```
✅ Telegram 앱 내에서만 실행 가능
✅ WebApp API 사용 가능
✅ 봇 명령어 통합
✅ 모바일 최적화
```

### UI/동작 차이

#### 📱 Deposit.tsx의 TMA 전용 코드

**a) 알림 방식 (Alert)**
```typescript
// TMA 모드: Telegram의 native alert 사용
if (isTMA) WebApp.showAlert(successMsg);

// 웹 모드: 상태 메시지로 표시
// (message 상태로 화면에 렌더링)
```

**vs 웹 모드**: 
- TMA: 팝업 알림 (즉시 눈에 띔)
- 웹: 텍스트 메시지 (사용자가 확인해야 함)

#### 📝 입력 필드 차이

**b) 메인 버튼 활성화**
```typescript
// TMA 전용
if (isTMA) {
  WebApp.MainButton.setText('입금하기');     // 하단 버튼 텍스트 변경
  WebApp.MainButton.enable();                // 버튼 활성화
}
```

**vs 웹 모드**:
- TMA: Telegram의 하단 고정 버튼 활용
- 웹: 일반 HTML 버튼 사용

#### 🎨 레이아웃 차이

**c) TMA 전용 UI**
```typescript
// Deposit.tsx L112-160 (TMA 모드)
if (isTMA) {
  return (
    <div className="p-4 bg-gradient-to-br from-slate-900 to-slate-800...">
      <h1>💰 CSPIN 입금</h1>
      {/* 컴팩트한 입력 폼 */}
      {/* TMA 크기에 최적화 (보통 390px 너비) */}
    </div>
  );
}

// Deposit.tsx L161-240 (웹 모드)
return (
  <div className="min-h-screen bg-gradient-to-br...">
    <div className="max-w-md mx-auto">
      {/* 전체 화면 활용 */}
      {/* 뒤로가기 버튼 포함 */}
    </div>
  </div>
);
```

---

## 3️⃣ **TMA Off (웹 브라우저 모드)**

### 특징
```
✅ 모든 웹 브라우저에서 실행 가능
✅ 표준 HTML/CSS 활용
✅ 데스크톱/모바일 응답형
✅ 뒤로가기 버튼 제공
```

### UI/동작 차이

#### 🌐 웹 전용 기능

**a) 뒤로가기 버튼**
```typescript
// 웹 모드에서만 렌더링
{onBack && (
  <button onClick={onBack} className="...">
    ← 뒤로가기
  </button>
)}

// TMA에서는 불필요 (Telegram 네비게이션 사용)
```

**b) 전체 화면 레이아웃**
```typescript
// 웹: min-h-screen (최소 화면 높이)
<div className="min-h-screen...">

// TMA: p-4 (패딩만)
<div className="p-4...">
```

**c) 예시값 버튼**
```typescript
// 웹 전용: 100 입력 빠른 버튼
<button onClick={() => setDepositAmount('100')}>100</button>

// TMA: 불필요 (터치 입력이 편함)
```

---

## 4️⃣ **양쪽 공통 기능**

| 기능 | TMA | 웹 | 코드 |
|------|-----|-----|------|
| 지갑 연결 필수 | ✅ | ✅ | `if (!wallet?.account?.address)` |
| 입금액 입력 | ✅ | ✅ | `<input type="number">` |
| 메시지 표시 | ✅ | ✅ | TMA: `WebApp.showAlert()`, 웹: 상태 |
| TonConnect 서명 | ✅ | ✅ | `tonConnectUI.sendTransaction()` |
| KV 크레딧 저장 | ✅ | ✅ | `/api/deposit` 호출 |

---

## 5️⃣ **WebApp API (TMA 전용)**

### 사용되는 API

```typescript
// ✅ 이미 Deposit.tsx에서 사용 중
window.Telegram?.WebApp?.showAlert(msg)      // 팝업 알림
window.Telegram?.WebApp?.MainButton.setText()  // 버튼 텍스트 변경
window.Telegram?.WebApp?.MainButton.enable()   // 버튼 활성화
window.Telegram?.WebApp?.MainButton.disable()  // 버튼 비활성화

// 🆕 향후 사용 가능한 API (구현하지 않음)
window.Telegram?.WebApp?.close()              // 미니앱 닫기
window.Telegram?.WebApp?.hapticFeedback.tap() // 진동 피드백
window.Telegram?.WebApp?.CloudStorage.getItem() // 클라우드 스토리지
```

---

## 6️⃣ **실제 테스트 체크리스트**

### TMA 모드 테스트 (Telegram 앱 필요)
```
[ ] Telegram 앱에서 봇 열기 (@CandleSpinner_bot)
[ ] Mini App 시작
[ ] 입금 버튼 클릭
[ ] 지갑 연결
[ ] 입금액 입력
[ ] 입금 실행
[ ] alert 팝업 표시 확인
[ ] 크레딧 반영 확인
```

### 웹 모드 테스트 (브라우저)
```
[ ] https://aiandyou.me 접속
[ ] 입금 버튼 클릭
[ ] 지갑 연결
[ ] 입금액 입력
[ ] 입금 실행
[ ] 화면에 메시지 표시 확인
[ ] 뒤로가기 버튼 작동 확인
[ ] 크레딧 반영 확인
```

---

## 7️⃣ **결론**

| 항목 | TMA | 웹 |
|------|-----|-----|
| **플랫폼** | Telegram 앱 | 모든 브라우저 |
| **알림 방식** | Native popup | 텍스트 메시지 |
| **네비게이션** | Telegram 기본 | 뒤로가기 버튼 |
| **레이아웃** | 컴팩트 (390px) | 반응형 |
| **WebApp API** | 활용 가능 | 비활용 |
| **사용자 수** | 낮음 | 높음 |
| **권장도** | 보조 채널 | 메인 채널 |

**권장사항**: 둘 다 지원하되, **웹 모드 우선** (더 많은 사용자)

---

**작성 일시**: 2025-10-21 01:15 KST
