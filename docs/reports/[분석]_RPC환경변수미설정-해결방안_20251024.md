# ğŸ” RPC í™˜ê²½ë³€ìˆ˜ ë¶„ì„ ë° í•´ê²°ë°©ì•ˆ

**ì‘ì„±ì¼:** 2025-10-24 16:10  
**ìƒíƒœ:** TON_RPC_API_KEY ë¯¸ì„¤ì • í™•ì¸ë¨

---

## ğŸ“Š í˜„ì¬ ìƒí™© ë¶„ì„

### Cloudflare ë°°í¬ ë¡œê·¸ ë¶„ì„

```
Build environment variables: 
  âœ… BACKEND_RPC_URL: https://rpc.ankr.com/ton_api_v2
  âœ… TON_RPC_HTTPS_ENDPOINT: https://rpc.ankr.com/ton_api_v2
  âŒ TON_RPC_API_KEY: [ì—†ìŒ!]
```

### í˜„ì¬ ì½”ë“œ (initiate-withdrawal.ts)

```typescript
// Line 193-200
const backendRpcUrl = env.BACKEND_RPC_URL || 'https://rpc.ankr.com/ton_api_v2';
const tonRpcApiKey = env.TON_RPC_API_KEY;  // â† undefined!
const rpcUrl = tonRpcApiKey 
  ? `${backendRpcUrl}/${tonRpcApiKey}`
  ? backendRpcUrl;

console.log(`[RPC] ì‚¬ìš© ì¤‘ì¸ URL: ${rpcUrl.replace(tonRpcApiKey || '', '***API_KEY***')}`);
```

### ê²°ê³¼

```
âœ… BACKEND_RPC_URL: "https://rpc.ankr.com/ton_api_v2"
âŒ TON_RPC_API_KEY: undefined
â†“
ğŸ”´ ìµœì¢… rpcUrl: "https://rpc.ankr.com/ton_api_v2" (API í‚¤ ì—†ìŒ!)
```

---

## ğŸš¨ í˜„ì¬ ë¬¸ì œ

```
âŒ ë¬¸ì œ 1: TON_RPC_API_KEYê°€ Cloudflare í™˜ê²½ë³€ìˆ˜ì— ë¯¸ì„¤ì •
âŒ ë¬¸ì œ 2: API í‚¤ ì—†ì´ Ankr RPC í˜¸ì¶œí•˜ë©´ ì œí•œ/ì‹¤íŒ¨ ê°€ëŠ¥
âŒ ë¬¸ì œ 3: ì½”ë“œì—ì„œ API í‚¤ ì—†ì„ ë•Œ ì²˜ë¦¬ ë¯¸í¡
```

---

## âœ… í•´ê²° ë°©ì•ˆ

### **Option A: Cloudflare í™˜ê²½ë³€ìˆ˜ì— TON_RPC_API_KEY ì¶”ê°€ (ê¶Œì¥)**

**í˜„ì¬ ìƒí™©:**
- wrangler.tomlì— ì •ì˜ë¨ (ë¡œì»¬ ê°œë°œìš©)
- Cloudflare í”„ë¡œë•ì…˜ì—ëŠ” ë¯¸ì„¤ì •

**í•´ê²°:**
```
Cloudflare ëŒ€ì‹œë³´ë“œ
â†’ aiandyou.me (Pages)
â†’ Settings â†’ Environment variables
â†’ Production
â†’ Add variables

Variable name: TON_RPC_API_KEY
Value: [ë‹¹ì‹ ì˜ Ankr API í‚¤]
Type: Encrypted
```

**ì„¤ì • í›„ ì½”ë“œ:**
```typescript
// initiate-withdrawal.ts í˜„ì¬ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©
const rpcUrl = `${backendRpcUrl}/${tonRpcApiKey}`;
// ê²°ê³¼: https://rpc.ankr.com/ton_api_v2/YOUR_API_KEY âœ…
```

---

### **Option B: ì½”ë“œ ê°œì„  (ë¶€ê°€ ì‘ì—…)**

í˜„ì¬ ì½”ë“œì˜ ë¬¸ì œì :
```typescript
const rpcUrl = tonRpcApiKey 
  ? `${backendRpcUrl}/${tonRpcApiKey}`
  ? backendRpcUrl;  // âŒ ë¬¸ë²• ì˜¤ë¥˜! (? ëŒ€ì‹  :)
```

**ìˆ˜ì • í•„ìš”:**
```typescript
const rpcUrl = tonRpcApiKey 
  ? `${backendRpcUrl}/${tonRpcApiKey}`
  : backendRpcUrl;  // âœ… ì‚¼í•­ ì—°ì‚°ì ìˆ˜ì •
```

---

## ğŸ“‹ ë‹¹ì‹ ì´ í•´ì•¼ í•  ì¼

### **ì¦‰ì‹œ (1ìˆœìœ„)**

```
1. Cloudflare ëŒ€ì‹œë³´ë“œ ì ‘ì†
   https://dash.cloudflare.com/

2. Pages í”„ë¡œì íŠ¸: aiandyou.me

3. Settings â†’ Environment variables

4. Production í™˜ê²½ì— ì¶”ê°€:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Variable name: TON_RPC_API_KEY  â”‚
   â”‚ Value: [Ankr API í‚¤]            â”‚
   â”‚ Type: Encrypted                 â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

5. Save â†’ 2-3ë¶„ ëŒ€ê¸° (ì¬ë°°í¬)
```

---

## ğŸ”§ ì½”ë“œ ìˆ˜ì • í•„ìš” ì—¬ë¶€

### í˜„ì¬ ì½”ë“œ ìƒíƒœ

```typescript
// functions/api/initiate-withdrawal.ts (Line 193-200)

const backendRpcUrl = env.BACKEND_RPC_URL || 'https://rpc.ankr.com/ton_api_v2';
const tonRpcApiKey = env.TON_RPC_API_KEY;
const rpcUrl = tonRpcApiKey 
  ? `${backendRpcUrl}/${tonRpcApiKey}`
  ? backendRpcUrl;  // âŒ ë¬¸ë²• ì˜¤ë¥˜!
```

### í•„ìš”í•œ ìˆ˜ì •

```typescript
// âœ… ìˆ˜ì •ë¨
const rpcUrl = tonRpcApiKey 
  ? `${backendRpcUrl}/${tonRpcApiKey}`
  : backendRpcUrl;  // ? â†’ :
```

**ì¦‰ì‹œ ìˆ˜ì •í•  ì˜ˆì •ì…ë‹ˆë‹¤!**

---

## ğŸ“Š ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

### ë‹¹ì‹ ì´ í´ë¼ìš°ë“œí”Œë ˆì–´ì— ì„¤ì •í•  í™˜ê²½ë³€ìˆ˜ (Production)

```
[ ] 1. GAME_WALLET_PRIVATE_KEY
      Type: Encrypted
      Value: 4e6568d1990bff34...ef7978fc

[ ] 2. GAME_WALLET_ADDRESS âš ï¸ ìˆ˜ì • í•„ìš”
      Type: Secret  
      Value: UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8JaY

[ ] 3. TON_RPC_API_KEY âš ï¸ ì¶”ê°€ í•„ìš”!
      Type: Encrypted
      Value: [ë‹¹ì‹ ì˜ Ankr API í‚¤]

[ ] 4. CSPIN_TOKEN_ADDRESS
      Type: Secret
      Value: EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV
```

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

### ì¦‰ì‹œ (ë‹¹ì‹ )
```
1. Cloudflare í™˜ê²½ë³€ìˆ˜ 3ê°œ ì„¤ì •/ìˆ˜ì •
   - GAME_WALLET_ADDRESS (ìˆ˜ì •)
   - TON_RPC_API_KEY (ì¶”ê°€)
   - ê¸°íƒ€ í™•ì¸
```

### ê·¸ ë‹¤ìŒ (AI)
```
1. initiate-withdrawal.ts ì½”ë“œ ìˆ˜ì •
   - ì‚¼í•­ ì—°ì‚°ì ? â†’ :
   - ê¸°íƒ€ ê²€í† 
```

### ìµœì¢… (ë‹¹ì‹ )
```
1. ë°°í¬ ëŒ€ê¸° (2-3ë¶„)
2. debug API í…ŒìŠ¤íŠ¸
3. ì‹¤ì œ ì¸ì¶œ í…ŒìŠ¤íŠ¸
```

---

## ğŸ’¡ ë³´ë„ˆìŠ¤ ì •ë³´

### Ankr RPC API í‚¤ ì—†ì„ ë•Œ

```
GET https://rpc.ankr.com/ton_api_v2
â†“
ì‘ë‹µ: 401 Unauthorized (ë˜ëŠ” 429 Rate Limited)
â†“
ì›ì¸: API í‚¤ í•„ìˆ˜
```

### ì˜¬ë°”ë¥¸ í˜•ì‹

```
https://rpc.ankr.com/ton_api_v2/YOUR_API_KEY
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 BACKEND_RPC_URL
                       â”‚
                   + / ê¸°í˜¸
                       â”‚
                  + API_KEY
```

---

## ğŸ“ ì •ë¦¬

### í˜„ì¬ ë¬¸ì œ
- âŒ TON_RPC_API_KEY ë¯¸ì„¤ì •
- âŒ initiate-withdrawal.ts ì‚¼í•­ ì—°ì‚°ì ì˜¤ë¥˜

### í•´ê²° ë°©ë²•
- âœ… Cloudflare í™˜ê²½ë³€ìˆ˜ ì„¤ì • (ë‹¹ì‹ )
- âœ… ì½”ë“œ ìˆ˜ì • (AI)

### ì˜ˆìƒ ê²°ê³¼
```
TON_RPC_API_KEY ì„¤ì •
    â†“
rpcUrl = "https://rpc.ankr.com/ton_api_v2/YOUR_API_KEY"
    â†“
Ankr RPC ì •ìƒ í˜¸ì¶œ âœ…
```
