# 🚀 중앙화 방식 - 빠른 재테스트 가이드

**작성일**: 2025-10-25 오전 3:35  
**상태**: ✅ 수정 완료, 재테스트 준비

---

## ⚡ 지금 바로 할 것 (3분)

### Step 1: 캐시 삭제 및 새로고침

```
1. 게임 페이지 열기: https://aiandyou.me/
2. F12 (개발자 도구) 열기
3. F5 (새로고침) 또는 Ctrl+Shift+R (캐시 삭제 새로고침)
4. 개발자 도구 → Application → Storage → Delete all
5. 페이지 다시 로드
```

---

### Step 2: 게임 실행 및 테스트

```
1. 게임 시작
2. 크레딧 확인 (있어야 함)
3. [📤 인출] 클릭
4. 모드 선택: [👤 중앙화 방식] 선택
5. Jetton 주소 입력:
   UQCsBJHqi3TtqOFiEP2caPEGQvMnpwz4sz6E760UjOQaKFD_
6. 인출액: 10 CSPIN 입력
7. [✓ 인출] 클릭
```

---

### Step 3: TON Connect 팝업 확인 (핵심!)

**팝업에서 확인할 것**:

```
Confirm Action
Wallet: Tonkeeper

□ "↑ Sent: -0.03 TON" (가스비)
□ "↓ Received: +1000 CSPIN" (토큰!)  ← 이게 보임?
또는
□ "CSPIN 토큰을 보낼 것입니다"
또는
□ 토큰 아이콘 + "CSPIN"

결과:
[ ] 예상대로 CSPIN 표시됨! ✅ → 성공!
[ ] 여전히 "TON 전송"만 보임 ❌ → 다른 원인
```

---

### Step 4: 서명 및 완료

```
1. TON Connect에서 "Confirm" 클릭 (또는 우측 스와이프)
2. Tonkeeper 앱에서 생체인증 또는 PIN 입력
3. 트랜잭션 완료 대기

결과:
✅ 성공: "[오전 X:XX:XX] ✅ CSPIN 인출 완료!"
❌ 실패: 오류 메시지 기록
```

---

## 📊 체크리스트 (1분)

```
준비:
[ ] 캐시 삭제 완료
[ ] 페이지 새로고침 완료
[ ] 게임 로드됨

테스트:
[ ] [📤 인출] 클릭
[ ] [👤 중앙화 방식] 선택
[ ] Jetton 주소 입력
[ ] 10 CSPIN 입력
[ ] [✓ 인출] 클릭

확인:
[ ] TON Connect 팝업 나타남
[ ] 팝업에서 CSPIN 표시?
  [ ] Yes ✅ (성공!)
  [ ] No ❌ (다른 원인)

결과:
[ ] 서명 완료
[ ] 트랜잭션 완료
[ ] 크레딧 차감 확인
```

---

## 📷 비교 이미지

### Before (❌)

```
Confirm Action
Wallet: Tonkeeper

[↑ Sent: -0.03 TON (UQCs...KFD_)]
[⚔ Network fee: ≈0.00432 TON]
Total: $0.0648
```

### After (✅ 예상)

```
Confirm Action
Wallet: Tonkeeper

[↓ Received: +1000 CSPIN]
[↑ Sent: -0.03 TON (UQCs...KFD_)]
[⚔ Network fee: ≈0.00432 TON]
Total: $0.0648
```

---

## 🧪 테스트 결과 보고 양식

### 성공한 경우

```
✅ 중앙화 방식 성공!

TON Connect 팝업:
- 보이는 내용: "CSPIN 토큰을 보낼 것입니다"
- 또는: "[↓ Received: +1000 CSPIN]"

최종 결과:
- 메시지: "✅ CSPIN 인출 완료!"
- 크레딧: 차감됨 ✅
- 디버그 로그:
  [오전 X:XX:XX] ✅ 트랜잭션 완료

다음: RPC 방식으로 진행
```

### 실패한 경우

```
❌ 여전히 작동 안 함

TON Connect 팝업:
- 보이는 내용: 여전히 "0.03 TON 전송"만 보임
- CSPIN 관련 내용 없음

디버그 로그:
```
[오전 X:XX:XX] 📍 Jetton 주소 변환: UQCsBJHqi3TtqOFiEP2c... → EQCsBJHqi3TtqOFiEP2c...
[오전 X:XX:XX] 📨 TON Connect 트랜잭션 전송 (Jetton 주소: EQCsBJHqi3TtqOFiEP2c...)
[오전 X:XX:XX] ❌ 서명 오류: ...
```

가능한 원인:
1. 캐시가 아직 갱신 안 됨
2. sessionStorage의 Jetton 주소가 잘못됨
3. 다른 브라우저 문제

해결:
- 완전히 캐시 삭제 후 재테스트
- 또는 다른 브라우저 시도
```

---

## 💡 빠른 팁

### 캐시 완전 삭제

```
Chrome/Brave:
1. Ctrl+Shift+Delete
2. 시간 범위: "전체 시간"
3. "캐시된 이미지 및 파일" 체크
4. 삭제

Safari:
1. Develop → Empty Web Storage (또는)
2. Safari → Preferences → Privacy → Manage Website Data

Firefox:
1. Ctrl+Shift+Delete
2. "모든 것" 선택
3. 삭제
```

### 디버그 로그 확인

```
1. 게임 페이지 열기
2. F12 (개발자 도구)
3. Console 탭
4. 인출 실행
5. 콘솔에서 로그 확인

주요 로그:
[오전 X:XX:XX] 📍 Jetton 주소 변환: ...
[오전 X:XX:XX] 📨 TON Connect 트랜잭션 전송: ...
[오전 X:XX:XX] ✅ 트랜잭션 완료
```

---

## ⏰ 예상 소요 시간

```
캐시 삭제 + 새로고침: 2분
테스트 실행:         2분
TON Connect 확인:   1분
서명 및 완료:        1분
─────────────────────────
총 소요 시간:        ~6분
```

---

## 🎯 핵심 포인트

### 수정된 것

```
GameComplete.tsx
- wallet.account.address (사용자 일반 지갑)
+ userFriendlyJettonAddress (Jetton 중간 지갑)
= TON Connect에서 CSPIN 표시 가능!
```

### 왜 작동할까

```
Jetton 중간 지갑 주소 사용
  ↓
TON Connect가 "이것은 Jetton 지갑입니다" 감지
  ↓
Jetton 마스터 확인 (CSPIN)
  ↓
"CSPIN 토큰 전송" 표시
  ↓
사용자 승인
  ↓
CSPIN 전송 완료! ✅
```

---

## 🚨 주의사항

### 중요!

```
[ ] Tonkeeper 지갑이 최신 버전?
    → 앱스토어/플레이스토어에서 업데이트 확인

[ ] TON 잔액 충분?
    → 최소 0.1 TON (가스비 0.03 + 여유)

[ ] CSPIN 잔액 충분?
    → 1000 CSPIN 이상

[ ] Jetton 중간 지갑 주소 정확?
    → Tonkeeper에서 직접 복사한 주소?
```

---

## 🎉 성공 시

```
중앙화 방식 ✅ 완료!

다음 단계:
1. RPC 방식 테스트
   → Ankr 대시보드 Origin 확인
   → 5-10분 대기
   → 재테스트

2. 양쪽 모드 모두 성공하면
   → 프로덕션 배포 준비!
```

---

**지금 바로 시작하세요! 곧 성공할 것으로 예상됩니다!** 🚀

