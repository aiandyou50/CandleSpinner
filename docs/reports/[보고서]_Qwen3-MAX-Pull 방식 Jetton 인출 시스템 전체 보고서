
---

# ğŸ“„ **Pull ë°©ì‹ Jetton ì¸ì¶œ ì‹œìŠ¤í…œ ì „ì²´ ë³´ê³ ì„œ**  
## â€” TON ë¸”ë¡ì²´ì¸ ê¸°ë°˜ ê²Œì„ ë‚´ CSPIN í† í° ì¸ì¶œ êµ¬ì¡°
### ì‘ì„±ì¼:2025.10.27. ì‘ì„±ì:Qwen3-MAX AI
---

## 1. ğŸ¯ **ëª©ì **

- ê²Œì„ ìš´ì˜ ì¸¡ì´ **TON ê°€ìŠ¤ë¹„ë¥¼ ìµœì†Œí™”**í•˜ë©´ì„œ  
- ìœ ì €ê°€ **ìì‹ ì˜ CSPIN í† í°ì„ ì•ˆì „í•˜ê²Œ ìˆ˜ë ¹**í•  ìˆ˜ ìˆë„ë¡  
- **Pull**(ìˆ˜ë™ ìˆ˜ë ¹) ë°©ì‹ìœ¼ë¡œ Jetton ì¸ì¶œ ê¸°ëŠ¥ì„ êµ¬í˜„

---

## 2. ğŸ§± **ì‹œìŠ¤í…œ êµ¬ì„± ìš”ì†Œ**

| êµ¬ì„± ìš”ì†Œ | ì„¤ëª… |
|----------|------|
| **User Wallet** | ìœ ì €ì˜ TON ì§€ê°‘ (ì˜ˆ: Tonkeeper). CSPIN ìˆ˜ë ¹ì²˜ |
| **Game Contract** | ê²Œì„ ë¡œì§ + `claimable_amount` ì €ì¥ + `claim()` í•¨ìˆ˜ ì œê³µ |
| **Jetton Master** | CSPIN í† í°ì˜ ë°œí–‰ì (Minter). CSPIN ì´ëŸ‰ ê´€ë¦¬ |
| **Game Jetton Wallet** | ê²Œì„ ì»¨íŠ¸ë™íŠ¸ê°€ ì†Œìœ í•œ CSPIN ë³´ìœ  ê³„ì • (Jetton Wallet Contract) |
| **TON Testnet / Mainnet** | ì‹¤ì œ ì‹¤í–‰ í™˜ê²½ |

> âœ… ëª¨ë“  Jettonì€ TON í‘œì¤€ **Jetton Processing Specification**ì„ ë”°ë¦…ë‹ˆë‹¤ .

---

## 3. ğŸ”„ **Pull ë°©ì‹ ì‘ë™ íë¦„ **(Sequence)

```mermaid
sequenceDiagram
    participant User as ìœ ì € (ì›¹)
    participant GameContract as ê²Œì„ ì»¨íŠ¸ë™íŠ¸
    participant GameJettonWallet as ê²Œì„ Jetton ì›”ë ›
    participant UserJettonWallet as ìœ ì € Jetton ì›”ë ›

    Note over User: "ì¸ì¶œ" ë²„íŠ¼ í´ë¦­
    User->>GameContract: claim() íŠ¸ëœì­ì…˜ (ì™¸ë¶€ ë©”ì‹œì§€)
    Note right of GameContract: 1. claimable_amount í™•ì¸<br>2. ìƒíƒœ 0ìœ¼ë¡œ ì´ˆê¸°í™”
    GameContract->>GameJettonWallet: ë‚´ë¶€ ë©”ì‹œì§€: transfer(CSPIN)
    GameJettonWallet->>UserJettonWallet: Jetton ì „ì†¡ (í‘œì¤€ í¬ë§·)
    Note over UserJettonWallet: CSPIN ìˆ˜ì‹  ì™„ë£Œ
```

> ğŸ’¡ ì´ íë¦„ì€ **ë¹„ë™ê¸°ì **, **ë¹„ì›ìì **(non-atomic)ì´ë©°, ê° ë‹¨ê³„ëŠ” ë³„ë„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤ .

---

## 4. ğŸ—ï¸ **ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ êµ¬ì¡°**

### 4.1 Game Contract (í•µì‹¬ í•¨ìˆ˜)

```func
() recv_external(slice in_msg_body) impure {
  slice cs = in_msg_body;
  int op = cs~load_uint(32);

  if (op == 0x12345678) { ;; claim opcode
    cell sender = get_sender_address(); ;; ì‹¤ì œëŠ” ë©”ì‹œì§€ íŒŒì‹± í•„ìš”
    int amount = get_claimable(sender);
    if (amount > 0) {
      set_claimable(sender, 0); ;; ë¨¼ì € ìƒíƒœ ì´ˆê¸°í™” (Reentrancy ë°©ì§€)
      send_jetton_transfer(sender, amount); ;; ë‚´ë¶€ ë©”ì‹œì§€ ì „ì†¡
    }
  }
}
```

### 4.2 ë°ì´í„° ì €ì¥ êµ¬ì¡°

| Key (Cell) | Value |
|-----------|-------|
| `claimable::<user_address>` | `1000000000` (1 CSPIN = 10â¹ ë‹¨ìœ„) |

---

## 5. ğŸ” **ë³´ì•ˆ ê³ ë ¤ì‚¬í•­**

| ìœ„í˜‘ | ëŒ€ì‘ ì „ëµ |
|------|----------|
| **Reentrancy** | ìƒíƒœ ë¨¼ì € ì—…ë°ì´íŠ¸ â†’ ì „ì†¡ (Checks-Effects-Interactions) |
| **Front-running** | `sender` ì£¼ì†Œì™€ ìˆ˜ë ¹ì ì£¼ì†Œ ì¼ì¹˜ ê²€ì¦ |
| **ì´ì¤‘ ìˆ˜ë ¹** | `claimable` ê°’ì„ `claim()` ì‹œ ë¬´ì¡°ê±´ 0ìœ¼ë¡œ ì„¤ì • |
| **Jetton ì†Œì‹¤** | ìˆ˜ì‹ ì Jetton ì›”ë › ì¡´ì¬ ì—¬ë¶€ëŠ” í™•ì¸ ë¶ˆê°€ â†’ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê²½ê³  |
| **Gas Griefing** | `claim()` ë¡œì§ì„ ìµœëŒ€í•œ ë‹¨ìˆœí™” |

> âš ï¸ Pull ë°©ì‹ì€ **ì‚¬ìš©ì ì±…ì„ì´ í¬ë¯€ë¡œ**, UXì—ì„œ "ì´ í† í°ì€ ì˜êµ¬íˆ ì†Œì‹¤ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤" ê²½ê³  í•„ìš”.

---

## 6. âœ… **ì¥ì **

- ê²Œì„ ìš´ì˜ ì¸¡ì´ **TON ê°€ìŠ¤ë¹„ ë¶€ë‹´ ì—†ìŒ**
- **ì¼ê´„ ì „ì†¡ ë¶ˆí•„ìš”** â†’ ì‹¤ì‹œê°„ ë³´ìƒ ì§€ê¸‰ ê°€ëŠ¥
- **ìŠ¤íŒ¸ ë°©ì§€**: ìœ ì €ê°€ ì§ì ‘ íŠ¸ëœì­ì…˜ ë°œìƒ â†’ ë¬´ë¶„ë³„í•œ ìš”ì²­ ê°ì†Œ

---

## 7. âŒ **ë‹¨ì **

- ìœ ì €ê°€ **ê°€ìŠ¤ë¹„**(TON)ë¥¼ ì§ì ‘ ì§€ë¶ˆí•´ì•¼ í•¨
- **ì‚¬ìš©ì ê²½í—˜ ì €í•˜**: ì¸ì¶œì„ ìœ„í•´ ì§ì ‘ íŠ¸ëœì­ì…˜ ìŠ¹ì¸ í•„ìš”
- **í† í° ì†Œì‹¤ ìœ„í—˜**: ì§€ì›ë˜ì§€ ì•ŠëŠ” ì§€ê°‘ì— ì „ì†¡ ì‹œ ë³µêµ¬ ë¶ˆê°€

---

## 8. ğŸ“Š **ê°€ìŠ¤ë¹„ ì˜ˆìƒ**

| ë‹¨ê³„ | ë¹„ìš© (TON) |
|------|-----------|
| ìœ ì € `claim()` íŠ¸ëœì­ì…˜ | ~0.025 |
| ê²Œì„ Jetton ì›”ë › â†’ ì „ì†¡ | ~0.015 (í™œì„± ìƒíƒœ ê¸°ì¤€) |
| **ì´ ì†Œëª¨ **(ìœ ì € ë¶€ë‹´) | **~0.025 TON** |

> ê²Œì„ ì¸¡ì€ **0 TON**ë§Œ ì†Œëª¨ (ë‹¨, Jetton ì›”ë ›ì— ì†ŒëŸ‰ TON ìƒì‹œ ë³´ìœ  ê¶Œì¥)

---

## 9. ğŸ“š **ì°¸ê³  ìë£Œ**

- TON Jetton Specification: 
- Mintless Jetton (ëŒ€ê·œëª¨ ì—ì–´ë“œë ìµœì í™”): 
- TON Operation ê°œë…: 
- https://github.com/ton-community/ton-docs
- https://github.com/ton-community/ton-api-v4?tab=readme-ov-file
---

## 10. ğŸ› ï¸ **í–¥í›„ ê°œì„  ë°©í–¥**

- **Hybrid ë°©ì‹**: ì†Œì•¡ì€ Push, ëŒ€ì•¡ì€ Pull
- **Gasless Claim**: ìš´ì˜ ì¸¡ì´ ìœ ì € íŠ¸ëœì­ì…˜ ê°€ìŠ¤ë¹„ ëŒ€ë‚© (Relay ì„œë²„ êµ¬ì¶•)
- **ì„œëª… ê¸°ë°˜ Claim**: ì˜¤í”„ì²´ì¸ì—ì„œ ì„œëª…ëœ ë³´ìƒ ë°ì´í„°ë¡œ ì¸ì¶œ â†’ ìœ„ë³€ì¡° ë°©ì§€

---
