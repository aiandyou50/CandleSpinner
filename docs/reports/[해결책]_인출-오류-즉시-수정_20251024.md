***REMOVED***μΈμ¶ κΈ°λ¥ - μ¦‰μ‹ ν•΄κ²° λ°©μ•

**μ‘μ„±μΌ**: 2025-10-24  
**μƒνƒ**: π”§ μμ • μ¤‘

---

#***REMOVED***π”΄ 2κ°€μ§€ μ¤λ¥ μ›μΈ

##***REMOVED***1. TonAPI 400 μ¤λ¥ (μ¤‘μ•™ν™” λ°©μ‹)

**μ›μΈ**:
- TonAPIμ Jetton μ§€κ°‘ μ΅°ν μ—”λ“ν¬μΈνΈ νΈμ¶ μ‹¤ν¨
- API λ¬Έμ„μ— μ •ν™•ν• μ—”λ“ν¬μΈνΈκ°€ λ¶λ…ν™•
- λλ” API ν‚¤κ°€ ν•„μ”ν•λ° μ—†μ

**ν•΄κ²°μ±…** β…:
- TonAPI νΈμ¶ **μ™„μ „ μ κ±°**
- ν”„λ΅ νΈμ—”λ“μ—μ„ Jetton μ§€κ°‘ μ£Όμ†λ¥Ό **μ§μ ‘ κ³„μ‚° λλ” μ…λ ¥**ν•μ—¬ λ°±μ—”λ“μ— μ „λ‹¬
- λ°±μ—”λ“λ” λ°›μ€ μ£Όμ†λ¥Ό **κ·Έλ€λ΅ μ‚¬μ©**

##***REMOVED***2. Ankr RPC CORS μ¤λ¥ (RPC λ°©μ‹)

**μ›μΈ**:
- Ankr RPC μ—”λ“ν¬μΈνΈμ—μ„ ν΄λΌμ°λ“ν”λ μ–΄ μ›μ»¤μ Originμ„ μΈμ‹ λ¶κ°€
- λλ” RPC μ—”λ“ν¬μΈνΈκ°€ μ„¤μ •λμ§€ μ•μ

**ν•΄κ²°μ±…** β…:
- RPC νΈμ¶λ„ λ°±μ—”λ“μ—μ„λ§ μν–‰ (ν΄λΌμ΄μ–ΈνΈ X)
- ν™κ²½λ³€μ `ANKR_JSON_RPC_HTTPS_ENDPOINT` μ¬λ°”λ¥΄κ² μ„¤μ •
- Ankr λ€μ‹λ³΄λ“μ—μ„ Origin λ“±λ΅ (ν•„μ”μ‹)

---

#***REMOVED***π› οΈ μμ • μ‚¬ν•­

##***REMOVED***λ°±μ—”λ“ λ³€κ²½ (v2 β†’ v3)

###***REMOVED***μ κ±°λ λ¶€λ¶„
```typescript
// β μ κ±°: TonAPI νΈμ¶
async function getJettonWalletAddress(
  masterAddress: string,
  ownerAddress: string
): Promise<string> {
  // TonAPI νΈμ¶... β† μ΄ λ¶€λ¶„ μ κ±°
}
```

###***REMOVED***μ¶”κ°€λ λ¶€λ¶„
```typescript
// β… μ¶”κ°€: ν”„λ΅ νΈμ—”λ“μ—μ„ λ°›μ€ μ£Όμ† μ‚¬μ©
const userJettonWalletAddress = body.userJettonWalletAddress;
if (!userJettonWalletAddress) {
  throw new Error('userJettonWalletAddress ν•„μ”');
}
```

##***REMOVED***ν”„λ΅ νΈμ—”λ“ λ³€κ²½

###***REMOVED***API μ”μ²­μ— Jetton μ£Όμ† ν¬ν•¨

```typescript
const payload = {
  walletAddress: wallet.account.address,
  withdrawalAmount: withdrawAmount,
  mode: withdrawMode,
  userJettonWalletAddress: '...'  // β† ν”„λ΅ νΈμ—μ„ κ³„μ‚°ν•μ—¬ μ „λ‹¬
};
```

---

#***REMOVED***π€ λ‹¤μ λ‹¨κ³„

##***REMOVED***1λ‹¨κ³„: μ‚¬μ©μ Jetton μ§€κ°‘ μ£Όμ† κµ¬ν•κΈ°

**μµμ… A: ν”„λ΅ νΈμ—”λ“μ—μ„ κ³„μ‚°** (κ¶μ¥)

```typescript
import { Address } from '@ton/ton';

async function calculateJettonWalletAddress(
  masterAddress: string,
  ownerAddress: string
): Promise<string> {
  // TON λΌμ΄λΈλ¬λ¦¬λ¥Ό μ‚¬μ©ν•μ—¬ μ§μ ‘ κ³„μ‚°
  // λλ” ν†¤μ¤ν‚¬μ„ μ‚¬μ©ν•μ—¬ κ³„μ‚°
  // λλ” TonWeb λΌμ΄λΈλ¬λ¦¬ μ‚¬μ©
  
  // μ„μ‹: κ³ μ •κ°’ λλ” ν™κ²½λ³€μμ—μ„ μ½κΈ°
  return process.env.REACT_APP_JETTON_WALLET_ADDRESS || '';
}
```

**μµμ… B: TonAPI μ‚¬μ©** (API ν‚¤ ν•„μ”)

```typescript
async function getJettonWalletAddress(
  masterAddress: string,
  ownerAddress: string
): Promise<string> {
  const response = await fetch(
    `https://tonapi.io/v2/jettons/${masterAddress}/wallets?owner_account=${ownerAddress}`,
    {
      headers: { Authorization: `Bearer ${TONAPI_KEY}` }
    }
  );
  // ...
}
```

##***REMOVED***2λ‹¨κ³„: ν”„λ΅ νΈμ—”λ“ μμ •

```typescript
// μΈμ¶ λ²„νΌ ν΄λ¦­ μ‹:
const userJettonWallet = await getJettonWalletAddress(
  process.env.REACT_APP_CSPIN_TOKEN_ADDRESS,
  wallet.account.address
);

const response = await fetch('/api/initiate-withdrawal', {
  body: JSON.stringify({
    walletAddress: wallet.account.address,
    withdrawalAmount,
    mode: withdrawMode,
    userJettonWalletAddress: userJettonWallet  // β† μ¶”κ°€
  })
});
```

##***REMOVED***3λ‹¨κ³„: ν™κ²½ λ³€μ μ„¤μ •

**ν΄λΌμ°λ“ν”λ μ–΄ (λ°±μ—”λ“)**:
```
ANKR_JSON_RPC_HTTPS_ENDPOINT = https://rpc.ankr.com/ton/jsonrpc
GAME_WALLET_ADDRESS = UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd
GAME_WALLET_PRIVATE_KEY = (64μ hex λ¬Έμμ—΄)
CSPIN_TOKEN_ADDRESS = EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV
```

**ν΄λΌμ΄μ–ΈνΈ** (`.env.local`):
```
REACT_APP_JETTON_WALLET_ADDRESS = (μ‚¬μ©μ jetton μ§€κ°‘ μ£Όμ† λλ” κ³„μ‚° ν•¨μ)
REACT_APP_CSPIN_TOKEN_ADDRESS = EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV
```

---

#***REMOVED***β οΈ ν„μ¬ μƒν™©

##***REMOVED***μ™„λ£λ¨ β…
- [x] v3 λ°±μ—”λ“ μ‘μ„± (Jetton μ£Όμ† μ΅°ν μ κ±°)
- [x] ν”„λ΅ νΈμ—”λ“ μ”μ²­ μμ • (μ£Όμ† μ „λ‹¬ μ¤€λΉ„)
- [x] μ¤λ¥ λ¶„μ„ λ¬Έμ„ μ‘μ„±

##***REMOVED***μ§„ν–‰ μ¤‘ π΅
- [ ] ν”„λ΅ νΈμ—”λ“: Jetton μ§€κ°‘ μ£Όμ† κ³„μ‚° ν•¨μ μ¶”κ°€
- [ ] ν™κ²½ λ³€μ μ„¤μ • ν™•μΈ
- [ ] ν…μ¤νΈ

##***REMOVED***ν•„μ”ν• μ •λ³΄ β“
- μ‚¬μ©μ Jetton μ§€κ°‘ μ£Όμ†λ¥Ό μ–΄λ””μ„ κµ¬ν• μ§€? (κ³„μ‚° vs API vs κ³ μ •κ°’)
- Ankr RPC μ—”λ“ν¬μΈνΈ μ„¤μ • ν™•μΈλμ—λ‚?
- TON ν…μ¤νΈλ„· λλ” λ©”μΈλ„·?

---

#***REMOVED***π― λΉ λ¥Έ ν…μ¤νΈ (μ„μ‹)

##***REMOVED***μ„μ‹ κ³ μ •κ°’μΌλ΅ ν…μ¤νΈν•κΈ°

**ν”„λ΅ νΈμ—”λ“**:
```typescript
// μ„μ‹: κ³ μ •λ Jetton μ§€κ°‘ μ£Όμ† μ‚¬μ©
const userJettonWallet = 'EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV';

const response = await fetch('/api/initiate-withdrawal', {
  body: JSON.stringify({
    walletAddress: wallet.account.address,
    withdrawalAmount,
    mode: withdrawMode,
    userJettonWalletAddress: userJettonWallet
  })
});
```

**κ²°κ³Ό**:
- β… μ •μƒ μ‘λ™ β†’ μ‹¤μ  μ£Όμ†λ΅ κ³„μ‚° ν•„μ”
- β μ—¬μ „ν μ¤λ¥ β†’ λ‹¤λ¥Έ λ¬Έμ  λ¶„μ„

---

#***REMOVED***π“ κ²°λ΅ 

**μ¦‰μ‹ μ΅°μΉ**:
1. ν”„λ΅ νΈμ—”λ“μ—μ„ Jetton μ§€κ°‘ μ£Όμ† μ…λ ¥/κ³„μ‚°
2. λ°±μ—”λ“μ— μ£Όμ† μ „λ‹¬
3. ν…μ¤νΈ

**μμƒ μ‹κ°„**: 10-20λ¶„

---
