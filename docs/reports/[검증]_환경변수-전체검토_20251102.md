# í™˜ê²½ ë³€ìˆ˜ ê²€ì¦ ë³´ê³ ì„œ (2025-11-02)

## ğŸ” ì „ì²´ í™˜ê²½ ë³€ìˆ˜ ê²€í†  ê²°ê³¼

### 1. âŒ ë°œê²¬ëœ ë¬¸ì œ

#### A. GAME_WALLET_MNEMONIC ì² ì ì˜¤ë¥˜
**Cloudflare í™˜ê²½ ë³€ìˆ˜:**
```
GAME_WALLET_MNEMONIC  âœ… (ì˜¬ë°”ë¦„)
```

**ì½”ë“œ:**
```typescript
// src/index.ts (ìˆ˜ì • ì „)
export interface Env {
  GAME_WALLET_MNEMONI: string;  // âŒ ë§ˆì§€ë§‰ 'C' ëˆ„ë½!
}
```

**ìˆ˜ì •:**
```typescript
// src/index.ts (ìˆ˜ì • í›„)
export interface Env {
  GAME_WALLET_MNEMONIC: string;  // âœ… ìˆ˜ì • ì™„ë£Œ
}
```

**ì˜í–¥:**
- Backend APIì—ì„œ ë‹ˆëª¨ë‹‰ ì½”ë“œë¥¼ ì½ì§€ ëª»í•¨
- ì¶œê¸ˆ ê¸°ëŠ¥ ë“±ì—ì„œ ì˜¤ë¥˜ ë°œìƒ ê°€ëŠ¥ì„±

#### B. TON API Key ì´ì¤‘ êµ¬ì¡°
**Cloudflare í™˜ê²½ ë³€ìˆ˜:**
```
TONCENTER_API_KEY  âœ… (Workers ì „ìš©)
```

**ì½”ë“œ:**
```typescript
// Frontend (src/components/Deposit.tsx)
const tonClient = new TonClient({
  endpoint: 'https://toncenter.com/api/v2/jsonRPC',
  apiKey: import.meta.env.VITE_TON_API_KEY || undefined,  // âš ï¸ Frontendìš©
});

// Backend (src/index.ts)
export interface Env {
  TONCENTER_API_KEY?: string;  // âœ… Workersìš©
}
```

**ë¬¸ì œì :**
- Frontendì™€ Backendê°€ ì„œë¡œ ë‹¤ë¥¸ í™˜ê²½ ë³€ìˆ˜ ì‚¬ìš©
- FrontendëŠ” `VITE_TON_API_KEY` (ë¹Œë“œ íƒ€ì„)
- BackendëŠ” `TONCENTER_API_KEY` (ëŸ°íƒ€ì„)

**í˜„ì¬ ìƒí™©:**
- Frontend: Rate Limitì— ë…¸ì¶œ (API Key ì—†ì´ í˜¸ì¶œ)
- Backend: API Key ì‚¬ìš© ê°€ëŠ¥

### 2. âœ… í™˜ê²½ ë³€ìˆ˜ ì •ë¦¬

| ë³€ìˆ˜ëª… | ìœ„ì¹˜ | ìƒíƒœ | ìš©ë„ |
|--------|------|------|------|
| **GAME_WALLET_MNEMONIC** | Cloudflare Workers | âœ… | ê²Œì„ ìš´ì˜ ì§€ê°‘ ë‹ˆëª¨ë‹‰ |
| `GAME_WALLET_MNEMONI` | ~~src/index.ts~~ | âŒ â†’ âœ… | ìˆ˜ì • ì™„ë£Œ |
| **TONCENTER_API_KEY** | Cloudflare Workers | âœ… | TonCenter API Key (Backend) |
| **VITE_TON_API_KEY** | .env (Frontend) | âš ï¸ | TonCenter API Key (Frontend) |
| **GAME_WALLET_ADDRESS** | Cloudflare Workers | âœ… | ê²Œì„ ìš´ì˜ ì§€ê°‘ ì£¼ì†Œ |
| **CSPIN_JETTON_MASTER** | Cloudflare Workers | âœ… | CSPIN Token Master ì£¼ì†Œ |

### 3. ğŸ” ë³´ì•ˆ ê¶Œì¥ ì‚¬í•­

#### Frontend API Key ë¬¸ì œ
**í˜„ì¬:**
```typescript
// Frontendì—ì„œ ì§ì ‘ TonClient í˜¸ì¶œ
const tonClient = new TonClient({
  apiKey: import.meta.env.VITE_TON_API_KEY  // âš ï¸ ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë¨!
});
```

**ë¬¸ì œì :**
- `VITE_` ì ‘ë‘ì‚¬ í™˜ê²½ ë³€ìˆ˜ëŠ” ë¹Œë“œ íƒ€ì„ì— ë²ˆë“¤ì— í¬í•¨ë¨
- ë¸Œë¼ìš°ì €ì—ì„œ API Keyê°€ ë…¸ì¶œë¨ (ê°œë°œì ë„êµ¬ë¡œ í™•ì¸ ê°€ëŠ¥)
- ì•…ì˜ì ì¸ ì‚¬ìš©ìê°€ API Keyë¥¼ íƒˆì·¨í•  ìˆ˜ ìˆìŒ

**ê¶Œì¥ í•´ê²°ì±… (Option A - ì„ì‹œ):**
```bash
# .envì— ì œí•œëœ ê¶Œí•œì˜ API Key ì¶”ê°€
VITE_TON_API_KEY=<TonCenter API Key>
```
- Rate Limitì„ í”¼í•  ìˆ˜ ìˆìŒ
- í•˜ì§€ë§Œ ì—¬ì „íˆ ë³´ì•ˆ ìœ„í—˜

**ê¶Œì¥ í•´ê²°ì±… (Option B - ì¥ê¸°):**
```typescript
// Backend APIë¥¼ í†µí•´ Jetton Wallet ê³„ì‚°
// src/api/routes/calculate-jetton-wallet.ts (ì‹ ê·œ)
export async function calculateJettonWallet(
  request: Request,
  env: Env
): Promise<Response> {
  const { userAddress, jettonMasterAddress } = await request.json();
  
  // Workers í™˜ê²½ì—ì„œ TONCENTER_API_KEY ì‚¬ìš©
  const tonClient = new TonClient({
    endpoint: 'https://toncenter.com/api/v2/jsonRPC',
    apiKey: env.TONCENTER_API_KEY,  // âœ… ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©
  });
  
  const jettonWallet = await jettonMaster.getWalletAddress(...);
  
  return Response.json({ jettonWallet });
}

// Frontendì—ì„œ í˜¸ì¶œ
const response = await fetch('/api/calculate-jetton-wallet', {
  method: 'POST',
  body: JSON.stringify({ userAddress, jettonMasterAddress })
});
const { jettonWallet } = await response.json();
```

**ì¥ì :**
- API Keyê°€ ì„œë²„ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©ë¨
- ë¸Œë¼ìš°ì €ì— ë…¸ì¶œë˜ì§€ ì•ŠìŒ
- ë³´ì•ˆ ê°•í™”

### 4. ğŸ“‹ ìˆ˜ì • ì‚¬í•­ ìš”ì•½

#### íŒŒì¼ ë³€ê²½
1. **src/index.ts**
   ```diff
   export interface Env {
   - GAME_WALLET_MNEMONI: string;
   + GAME_WALLET_MNEMONIC: string;  // âœ… ì² ì ìˆ˜ì •
     TONCENTER_API_KEY?: string;
   }
   ```

2. **wrangler.toml**
   ```diff
   # í™˜ê²½ ë³€ìˆ˜ (SecretsëŠ” Dashboardì—ì„œ ì„¤ì •ë¨)
   - # GAME_WALLET_MNEMONI
   + # GAME_WALLET_MNEMONIC  // âœ… ì² ì ìˆ˜ì •
   - # CSPIN_JETTON_WALLET
   + # (ì œê±°ë¨ - ë™ì  ê³„ì‚°ìœ¼ë¡œ ëŒ€ì²´)
     # TONCENTER_API_KEY
   ```

3. **.env**
   ```diff
   # TON API Key (ì„ íƒì‚¬í•­)
   + # âš ï¸ ì£¼ì˜: Frontendì— ë…¸ì¶œë˜ë¯€ë¡œ ì œí•œëœ ê¶Œí•œì˜ API Key ì‚¬ìš© ê¶Œì¥
   + # TonCenter API Key ë°œê¸‰: https://tonconsole.com
   VITE_TON_API_KEY=
   ```

### 5. âš ï¸ Cloudflare Dashboard í™•ì¸ í•„ìš”

**í™•ì¸ ì‚¬í•­:**
1. https://dash.cloudflare.com
2. Workers & Pages â†’ **candlespinner-workers**
3. Settings â†’ **Variables**
4. ë³€ìˆ˜ëª… í™•ì¸:
   ```
   âœ… GAME_WALLET_MNEMONIC (not MNEMONI)
   âœ… TONCENTER_API_KEY
   âœ… GAME_WALLET_ADDRESS
   âœ… CSPIN_JETTON_MASTER
   ```

**ë§Œì•½ `GAME_WALLET_MNEMONI`ë¡œ ì €ì¥ë˜ì–´ ìˆë‹¤ë©´:**
1. ìƒˆ ë³€ìˆ˜ ì¶”ê°€: `GAME_WALLET_MNEMONIC` (ì˜¬ë°”ë¥¸ ì² ì)
2. ê°’ ë³µì‚¬
3. ê¸°ì¡´ ë³€ìˆ˜ ì‚­ì œ: `GAME_WALLET_MNEMONI`

### 6. ğŸ§ª í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

#### ë°°í¬ í›„ í™•ì¸
- [ ] ì½”ë“œ ë¹Œë“œ ì„±ê³µ (`npm run build`)
- [ ] Workers ë°°í¬ ì„±ê³µ (`npm run deploy`)
- [ ] Frontendì—ì„œ Jetton Wallet ê³„ì‚° ì„±ê³µ
- [ ] Rate Limit ì˜¤ë¥˜ í•´ê²° í™•ì¸
- [ ] Backend APIì—ì„œ ë‹ˆëª¨ë‹‰ ì ‘ê·¼ ê°€ëŠ¥ í™•ì¸

#### í™˜ê²½ ë³€ìˆ˜ ê²€ì¦
```bash
# Workers ë¡œê·¸ì—ì„œ í™•ì¸
console.log('Environment Variables:', {
  hasMnemonic: !!env.GAME_WALLET_MNEMONIC,
  hasApiKey: !!env.TONCENTER_API_KEY,
  hasAddress: !!env.GAME_WALLET_ADDRESS,
});
```

### 7. ğŸ“š ì°¸ê³  ìë£Œ

#### Vite í™˜ê²½ ë³€ìˆ˜
- [Vite Env Variables](https://vitejs.dev/guide/env-and-mode.html)
- `VITE_` ì ‘ë‘ì‚¬ ë³€ìˆ˜ë§Œ ë¹Œë“œì— í¬í•¨ë¨
- ë¹Œë“œ íƒ€ì„ì— ë¬¸ìì—´ë¡œ ëŒ€ì²´ë¨

#### Cloudflare Workers í™˜ê²½ ë³€ìˆ˜
- [Workers Environment Variables](https://developers.cloudflare.com/workers/configuration/environment-variables/)
- ëŸ°íƒ€ì„ì— `env` ê°ì²´ë¡œ ì ‘ê·¼
- SecretsëŠ” ì•”í˜¸í™”ë˜ì–´ ì €ì¥

#### TonCenter API
- [TonCenter API](https://toncenter.com/api/v2/)
- API Key ë°œê¸‰: https://tonconsole.com
- Rate Limits:
  - ë¬´ë£Œ: 1 req/sec, 10 req/min
  - API Key: 10 req/sec, 300 req/min

---

**ì‘ì„±ì¼:** 2025-11-02  
**ì‘ì„±ì:** GitHub Copilot  
**ìƒíƒœ:** âœ… ì² ì ì˜¤ë¥˜ ìˆ˜ì • ì™„ë£Œ, API Key êµ¬ì¡° ë¬¸ì„œí™”
