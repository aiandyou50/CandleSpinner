# 인출 기능 수정 - 필요한 정보 체크리스트

**작성일**: 2025-10-24  
**용도**: 남은 문제 해결을 위해 필요한 정보 확인

---

## 🔴 현재 상황

### 해결된 것 ✅
- 중앙화 방식: Address 형식 오류 → **자동 변환 추가** ✅
- Jetton 주소 입력: UI 추가 ✅
- 디버그 로그: 강화됨 ✅

### 남은 문제 🟡
1. **중앙화 방식**: 아직 **실제 테스트 필요**
   - Address 변환이 작동하는지 확인 필요
   - TON Connect 서명 성공 여부 확인 필요

2. **RPC 방식**: **CORS 오류 진행 중**
   - `Origin not allowed (-32079)` 오류
   - 환경변수 설정 또는 RPC 변경 필요

---

## 📋 필요한 정보들

### 1️⃣ 환경 설정 관련 정보 (🔴 긴급)

#### 백엔드 환경변수 확인

**확인 필요**:
```
wrangler.toml 또는 클라우드플레어 환경변수에서 확인:

[ ] ANKR_JSON_RPC_HTTPS_ENDPOINT 설정 값?
    현재 설정값: ?
    
[ ] GAME_WALLET_ADDRESS 설정 값?
    현재 설정값: ?
    
[ ] GAME_WALLET_PRIVATE_KEY 설정 값?
    설정됨? (Y/N)
    
[ ] CSPIN_TOKEN_ADDRESS 설정 값?
    현재 설정값: ?
```

**어디서 확인?**
```
1. Cloudflare Pages 대시보드
   → 프로젝트 → 설정 → 환경 변수
   
2. 또는 로컬 wrangler.toml 파일
   → 프로젝트 루트의 wrangler.toml
```

---

### 2️⃣ Ankr RPC 관련 정보 (🟡 중요)

#### Ankr 대시보드 정보

**확인 필요**:
```
[ ] Ankr 계정 있는가? (Y/N)
    https://app.ankr.com/dashboard
    
[ ] TON RPC 설정 확인?
    - API Key: 
    - Endpoints: 
    - Origin 등록 상태:
    
[ ] Origin 등록 목록
    현재 등록된 Origin:
    - 예: https://candlespinner.pages.dev
    - 예: https://localhost:3000
    - 기타: ?
```

**어디서 확인?**
```
1. https://app.ankr.com/dashboard
2. TON Chain 선택
3. API Keys 탭
4. 해당 API Key의 설정 클릭
5. Origin settings 확인
```

---

### 3️⃣ TON 지갑 정보 (🟡 중요)

#### 테스트용 지갑 주소들

**필요한 주소들**:
```
[ ] 테스트용 사용자 TON 지갑 주소?
    형식: 0:ac0491... 또는 EQAs...
    주소: ?
    
[ ] 사용자의 CSPIN Jetton 지갑 주소?
    형식: EQB... (CSPIN 토큰용)
    주소: ?
    
[ ] 게임 지갑 주소?
    형식: 0:... 또는 EQ...
    주소: UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd (현재 설정값)
    
[ ] CSPIN 토큰 마스터 주소?
    형식: EQ...
    주소: EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV (현재 설정값)
```

**어디서 구하나?**
```
1. 테스트 네트워크 faucet 사이트
   - https://testnet-faucet.ton.org (테스트넷)
   
2. TON Explorer
   - https://tonscan.org (메인넷)
   - https://testnet.tonscan.org (테스트넷)
   
3. TON Wallet 앱
   - 설정 → 지갑 주소 확인
```

---

### 4️⃣ 네트워크 환경 정보 (🟡 중요)

#### 테스트 네트워크 확인

**확인 필요**:
```
[ ] 현재 테스트 대상 네트워크?
    [ ] 메인넷 (TON mainnet)
    [ ] 테스트넷 (TON testnet)
    
[ ] Jetton 주소 환경?
    - 메인넷에서만 사용 가능한 CSPIN Jetton?
    - 테스트넷 용도 따로 있나?
```

---

### 5️⃣ 배포 환경 정보 (🟡 참고)

#### 클라우드플레어 배포 정보

**확인 필요**:
```
[ ] 현재 배포된 도메인?
    주소: https://candlespinner.pages.dev?
    
[ ] 개발/프로덕션 환경 구분?
    - 개발: https://... (dev 버전)
    - 프로덕션: https://... (prod 버전)
    
[ ] 페이지 public URL?
    https://...(정확한 주소)?
```

---

## 🎯 정보별 중요도 및 영향

| 정보 | 중요도 | 영향 범위 | 기다려야 하나? |
|------|--------|----------|---|
| ANKR_JSON_RPC_HTTPS_ENDPOINT | 🔴 긴급 | RPC 방식 작동 | ⭐ 바로 필요 |
| 환경변수 (GAME_WALLET 등) | 🔴 긴급 | 인출 전체 | ⭐ 바로 필요 |
| 사용자 Jetton 주소 | 🟡 중요 | 테스트 진행 | 있으면 좋음 |
| Ankr Origin 등록 상태 | 🟡 중요 | RPC CORS 해결 | 있으면 좋음 |
| 테스트 지갑 주소 | 🟢 참고 | 테스트 진행 | 있으면 더 쉬움 |

---

## 📝 현재 알고 있는 정보

### 이미 확인된 것
```
✅ GAME_WALLET_ADDRESS
   UQBFPDdSlPgqPrn2XwhpVq0KQExN2kv83_batQ-dptaR8Mtd

✅ CSPIN_TOKEN_ADDRESS  
   EQBZ6nHfmT2wct9d4MoOdNPzhtUGXOds1y3NTmYUFHAA3uvV

✅ 네트워크
   메인넷 (mainnet)

✅ 배포 도메인
   https://candlespinner.pages.dev (추정)
```

### 아직 확인 안 된 것
```
❓ ANKR_JSON_RPC_HTTPS_ENDPOINT
   - 설정되어 있나?
   - 정확한 URL은?
   
❓ GAME_WALLET_PRIVATE_KEY
   - 설정되어 있나?
   
❓ 사용자 테스트 Jetton 지갑
   - 어느 주소인가?
   
❓ Ankr Origin 등록
   - Origin이 등록되었나?
   - 클라우드플레어 도메인 포함?
```

---

## 🛠️ 문제별 필요 정보

### 문제 1: RPC CORS 오류 해결

**필요 정보**:
```
1. ANKR_JSON_RPC_HTTPS_ENDPOINT 환경변수 현재 값
2. Ankr 대시보드에서 Origin 등록 목록
3. 클라우드플레어 배포 도메인 정확한 주소
```

**진행 방법**:
```
IF 환경변수가 설정 안 됨
  → 나에게 설정값 말씀해줘
  → 내가 코드 수정하면 배포하고 테스트

ELSE IF 환경변수는 설정됐는데 오류 계속
  → Ankr 대시보드에서 Origin 추가
  → 또는 내가 대체 RPC 제공자로 변경해줌

ELSE
  → 환경변수 재확인 또는 프록시 구현
```

---

### 문제 2: 중앙화 방식 테스트

**필요 정보**:
```
1. 테스트용 TON 지갑 주소 (사용자 지갑)
2. 해당 지갑의 CSPIN Jetton 지갑 주소
3. 해당 Jetton 지갑에 CSPIN 토큰이 있는지 확인
```

**진행 방법**:
```
1. 게임에서 크레딧 보유
2. 인출 화면 진입
3. Jetton 주소 입력
4. 중앙화 방식 선택
5. 인출 요청
6. TON Connect에서 서명
7. 완료 확인
```

---

## 💬 어떤 방식으로 제공해주면 좋을까?

### 옵션 1: 직접 알려주기 (빠름) ✅ 추천
```
"ANKR_JSON_RPC_HTTPS_ENDPOINT = https://rpc.ankr.com/ton/jsonrpc"
"테스트 지갑: UQBs..."
"Jetton 주소: EQB..."
```

### 옵션 2: 스크린샷으로 보여주기
```
1. wrangler.toml 스크린샷
2. Ankr 대시보드 스크린샷
3. 지갑 정보 스크린샷
```

### 옵션 3: 클라우드플레어 대시보드 정보
```
프로젝트 → 설정 → 환경 변수 화면 스크린샷
```

---

## ✅ 체크리스트

필요한 정보를 정리해서 아래처럼 알려주세요:

```
[ ] ANKR_JSON_RPC_HTTPS_ENDPOINT: ___________________
[ ] GAME_WALLET_PRIVATE_KEY 설정됨? (Y/N)
[ ] 테스트 사용자 지갑: ___________________
[ ] 테스트 Jetton 지갑: ___________________
[ ] Ankr Origin 등록: ___________________
[ ] 현재 배포 도메인: ___________________
[ ] 기타 문제: ___________________
```

---

## 🚀 정보 제공 후 진행 순서

```
1️⃣ 정보 받기
   ↓
2️⃣ 환경 변수 설정 (필요시)
   ↓
3️⃣ 코드 수정 (필요시)
   ↓
4️⃣ 배포
   ↓
5️⃣ 테스트 (중앙화 → RPC 순서)
   ↓
6️⃣ 완료 및 프로덕션 배포
```

---

## 📞 요약

**지금 바로 필요한 것**:
1. ⭐ `ANKR_JSON_RPC_HTTPS_ENDPOINT` 환경변수 값
2. ⭐ 환경변수가 설정 안 됐다면, 설정 방법 알려주기
3. 🟡 테스트용 Jetton 지갑 주소 (재테스트 시)

**이 정보들이 있으면**:
- 중앙화 방식: 바로 테스트 가능 ✅
- RPC 방식: CORS 오류 해결 가능 ✅
- 프로덕션 배포: 진행 가능 ✅

---

**준비되신 정보부터 말씀해주세요!** 🙏
