# 📝 JSDoc & TypeScript 주석 가이드

CandleSpinner 프로젝트에서 코드의 가독성과 유지보수성을 높이기 위한 JSDoc 주석 작성 방법입니다.

---

## 🎯 목표

- 함수/컴포넌트의 **목적** 명확히 하기
- **매개변수와 반환값** 타입 설명
- **사용 예시** 제공
- IDE 자동완성 & 에러 감지 향상

---

## 📋 작성 규칙

### 1️⃣ React 컴포넌트

```typescript
/**
 * 게임 메인 컴포넌트 (MVP 완전 테스트 UI v3.0)
 * 
 * TON 지갑으로 연결된 사용자가 슬롯머신 게임을 플레이합니다.
 * 입금, 게임, 인출, 더블업 등의 화면을 관리합니다.
 * 
 * @component
 * @example
 * ```tsx
 * <Game 
 *   onDepositClick={() => showDepositModal()}
 *   onWithdrawClick={() => showWithdrawModal()}
 * />
 * ```
 * 
 * @prop {() => void} [onDepositClick] - 입금 버튼 클릭 시 실행되는 콜백
 * @prop {() => void} [onDoubleUpClick] - 더블업 버튼 클릭 시 실행되는 콜백
 * @prop {() => void} [onWithdrawClick] - 인출 버튼 클릭 시 실행되는 콜백
 * 
 * @returns {JSX.Element} 게임 UI
 */
interface GameProps {
  onDepositClick?: () => void;
  onDoubleUpClick?: () => void;
  onWithdrawClick?: () => void;
}

export const Game: React.FC<GameProps> = ({ onDepositClick, onDoubleUpClick, onWithdrawClick }) => {
  // ...
};
```

### 2️⃣ 커스텀 React 훅

```typescript
/**
 * TonConnect 지갑 관리 훅
 * 
 * 사용자의 지갑 연결, Jetton 지갑 파생, 자동 로드를 담당합니다.
 * ton-core 또는 RPC를 통해 Jetton 지갑 주소를 파생합니다.
 * 
 * @hook
 * @example
 * ```tsx
 * const { connectedWallet, manualJettonWallet, deriveStatus } = useTonConnect();
 * 
 * if (!connectedWallet) {
 *   return <div>지갑을 연결하세요</div>;
 * }
 * 
 * console.log('Jetton Wallet:', manualJettonWallet);
 * ```
 * 
 * @returns {Object} TonConnect 상태 객체
 * @returns {Wallet|null} connectedWallet - TonConnect에서 반환한 지갑 정보
 * @returns {string} manualJettonWallet - 파생된 CSPIN Jetton 지갑 주소
 * @returns {(value: string) => void} setManualJettonWallet - 수동으로 Jetton 지갑 주소 설정
 * @returns {string|null} deriveStatus - 파생 상태 메시지 ("파생 성공", "RPC 실패" 등)
 */
export function useTonConnect() {
  // ...
}
```

### 3️⃣ 게임 상태 관리 훅

```typescript
/**
 * 게임 상태 관리 훅 (Zustand 스토어)
 * 
 * 사용자의 크레딧, 베팅액, 스핀 결과, 최근 승리 등을 관리합니다.
 * 
 * @hook
 * @example
 * ```tsx
 * const { userCredit, betAmount, isSpinning, updateCredit, setBet, endSpin } = useGameState();
 * 
 * // 크레딧 업데이트
 * updateCredit(1000);
 * 
 * // 베팅액 설정
 * setBet(50);
 * 
 * // 스핀 종료
 * endSpin(100);  // 100 크레딧 획득
 * ```
 * 
 * @returns {Object} 게임 상태 객체
 * @returns {number} userCredit - 사용자의 현재 크레딧
 * @returns {number} betAmount - 현재 베팅액
 * @returns {number} lastWinnings - 최근 승리 금액
 * @returns {boolean} isSpinning - 현재 스핀 중인지 여부
 * @returns {(credit: number) => void} updateCredit - 크레딧 업데이트 함수
 * @returns {(amount: number) => void} setBet - 베팅액 설정 함수
 * @returns {(winnings: number) => void} endSpin - 스핀 종료 함수
 */
export function useGameState() {
  // ...
}
```

### 4️⃣ API 엔드포인트 함수

```typescript
/**
 * CSPIN 토큰 입금 시작
 * 
 * 사용자의 지갑에서 게임 지갑으로 CSPIN 토큰을 전송하는 트랜잭션을 생성합니다.
 * WalletContractV5R1 사용, SendMode 적용.
 * 
 * @async
 * @param {Request} request - Cloudflare Workers 요청 객체
 * @returns {Promise<Response>} 트랜잭션 BOC와 해시를 포함한 응답
 * 
 * @example
 * ```typescript
 * // 요청
 * POST /api/initiate-deposit
 * {
 *   "jettonWalletAddress": "EQA7...",
 *   "amount": "1000000000"
 * }
 * 
 * // 응답
 * {
 *   "boc": "te6cckECWAEAA/...",
 *   "hash": "4e65..."
 * }
 * ```
 * 
 * @throws {Error} 개인키 로드 실패, 트랜잭션 생성 실패 등
 */
export async function handleInitiateDeposit(request: Request): Promise<Response> {
  // ...
}
```

### 5️⃣ 유틸리티 함수

```typescript
/**
 * 16진수 문자열을 Uint8Array로 변환
 * 
 * Node.js Buffer 의존성 제거하고 Cloudflare Workers에서 안전하게 동작.
 * 
 * @param {string} hex - 16진수 문자열 (예: "4e6568" 또는 "0x4e6568")
 * @returns {Uint8Array} 변환된 바이트 배열
 * 
 * @example
 * ```typescript
 * const hex = "48656c6c6f";  // "Hello"
 * const bytes = hexToBytes(hex);
 * console.log(bytes);  // Uint8Array(5) [72, 101, 108, 108, 111]
 * ```
 */
function hexToBytes(hex: string): Uint8Array {
  // ...
}
```

### 6️⃣ 타입 정의

```typescript
/**
 * 게임 상태 인터페이스
 * 
 * @interface GameState
 * @property {number} userCredit - 사용자의 현재 크레딧 (단위: nanoCSPIN)
 * @property {number} betAmount - 현재 베팅액 (단위: nanoCSPIN)
 * @property {number} lastWinnings - 최근 승리 금액 (단위: nanoCSPIN)
 * @property {boolean} isSpinning - 현재 스핀 중인지 여부
 * @property {boolean} canDoubleUp - 더블업 가능 여부
 */
interface GameState {
  userCredit: number;
  betAmount: number;
  lastWinnings: number;
  isSpinning: boolean;
  canDoubleUp: boolean;
}

/**
 * API 응답 타입 (성공)
 * 
 * @interface ApiSuccessResponse
 * @template T - 데이터의 타입
 * @property {T} data - 응답 데이터
 * @property {boolean} success - 성공 여부 (true)
 * @property {string} [message] - 선택 사항 메시지
 */
interface ApiSuccessResponse<T> {
  data: T;
  success: true;
  message?: string;
}

/**
 * API 응답 타입 (오류)
 * 
 * @interface ApiErrorResponse
 * @property {null} data - null
 * @property {boolean} success - 성공 여부 (false)
 * @property {string} error - 에러 메시지
 * @property {string} [code] - 에러 코드 (예: "INSUFFICIENT_BALANCE")
 */
interface ApiErrorResponse {
  data: null;
  success: false;
  error: string;
  code?: string;
}
```

---

## ✅ 체크리스트

컴포넌트/함수 작성 시 다음을 확인하세요:

- [ ] 함수/컴포넌트의 **목적** 설명했는가?
- [ ] **매개변수** 타입과 설명 추가했는가?
- [ ] **반환값** 타입과 설명 추가했는가?
- [ ] **사용 예시** 제공했는가?
- [ ] **throws** (에러 발생 가능성) 문서화했는가?
- [ ] **@async**, **@component**, **@hook** 태그 사용했는가?

---

## 🔗 IDE 인식

### VS Code TypeScript Intellisense
JSDoc 주석은 자동으로 IDE의 자동완성에 나타납니다:

```
// 사용자가 함수 호출할 때 Ctrl+Space
functionName(|)  // JSDoc이 Intellisense에 표시됨
```

### ESLint & Prettier
```json
// .eslintrc.json
{
  "rules": {
    "jsdoc/require-jsdoc": ["warn", {
      "require": {
        "FunctionDeclaration": true,
        "ArrowFunctionExpression": true,
        "ClassDeclaration": true,
        "ClassExpression": true
      }
    }]
  }
}
```

---

## 📚 참고

- [JSDoc 공식 문서](https://jsdoc.app)
- [TypeScript JSDoc 참조](https://www.typescriptlang.org/docs/handbook/jsdoc-supported-types.html)
- [React JSDoc 예제](https://react.dev/learn)

---

**마지막 업데이트:** 2025-10-23

