# [AI-워크플로우-지침서.md] (v3.0)
1. 문서 목적 (Purpose)
이 문서는 CandleSpinner 프로젝트에 참여하는 모든 AI 코딩 에이전트(이하 "AI")가 **반드시 준수해야 할 핵심 행동 원칙(Rules of Engagement)**을 정의합니다.
이 지침서의 최종 목표는 다음과 같습니다.
 * 동기화: 코드(Reality)와 모든 산출물 문서(SSoT) 간의 완전한 동기화를 유지합니다.
 * 지속성: AI 교체(세션 변경) 시에도 '환각'이나 '망각' 없이 프로젝트 지식이 100% 인수인계되도록 보장합니다.
 * 체계화: 시맨틱 버전(SemVer)을 통한 체계적인 릴리즈 관리와 변경 이력 추적을 자동화합니다.
핵심 원칙:
 * No Doc, No Code: 문서가 정의되지 않은 코드는 작성하지 않습니다.
 * No Sync, No Commit: 코드 변경 시, 관련 문서가 동기화되지 않으면 커밋(Commit)할 수 없습니다.
 * No Record, No Close: 해결 과정이 기록되지 않은 작업은 종료(Closed)된 것이 아닙니다.
2. 문서 저장소 구조 (Repository Structure)
모든 문서는 최상위 docs/ 폴더 내에 목적별로 분류되어 저장됩니다.
 * docs/ssot/ (단일 진실 공급원)
   * [산출물1]...md, [산출물2]...md, [산출물3]...md
   * 설명: 프로젝트의 핵심 기획 및 설계 문서(SSoT). 코드 변경 시 이 문서들이 [Step 4]에 따라 함께 수정되어야 합니다.
 * docs/kanban.md (칸반 보드)
   * 설명: 모든 작업의 [To Do], [In Progress], [Done] 상태를 관리하는 작업 현황판.
 * docs/CHANGELOG.md (변경 이력 문서)
   * 설명: 프로젝트의 마스터 버전을 관리하는 단일 문서. [부록 A]의 템플릿을 따릅니다.
 * docs/workflows/ (워크플로우)
   * AI-워크플로우-지침서.md: (본 문서) AI의 행동 헌법.
   * 퀵-AI워크플로워-지침서.md: (요약본) 새 세션 시작 시 AI에 주입되는 부트스트랩 프롬프트. [부록 B]의 템플릿을 따릅니다.
 * docs/instructions/ (명령 기록)
   * 설명: 사용자가 AI에게 내린 주요 명령 지시서가 [지시서명칭]_[타임스탬프].md 형식으로 보관됩니다. (AI가 [Step 2]에서 생성)
 * docs/solutions/ (해결 기록)
   * 설명: AI가 [Step 5]에서 작성하는 '해결 기록' 문서가 [지시서명칭]_[타임스탬프]_solution.md 형식으로 보관됩니다.
 * docs/reports/ (임시/보고성 문서)
   * 설명: (규칙 7) 분석 리포트, 일회성 테스트 결과 등 SSoT가 아닌 임시 문서.
   * 명명 규칙: [보고서]_[YYYYMMDD]_[주제].md (예: [보고서]_20251020_스핀로직-분석.md)
 * PoC/ (읽기 전용 아카이브)
   * (규칙 1) 이 폴더와 하위의 모든 문서는 절대 수정하거나 훼손해서는 안 됩니다.
   * 설명: 완료된 PoC 단계의 기록이며, AI는 이 폴더를 오직 학습용(Learning) 및 참고용(Reference)으로만 사용해야 합니다.
3. 버전 관리 정책 (Versioning Policy)
 * 시맨틱 버전(SemVer) (규칙 1):
   * 프로젝트는 Major.Minor.Patch (예: 1.0.0) 형식의 SemVer를 엄격히 준수합니다.
 * 마스터 버전 관리 (규칙 2, 3):
   * docs/CHANGELOG.md 파일이 프로젝트 전체 버전의 **마스터(Master)**입니다.
   * 개별 산출물 문서([산출물1] 등)는 자체 버전을 갖지 않으며, 프로젝트의 마스터 버전을 따릅니다.
 * 버전 동기화 (규칙 5, 6):
   * docs/CHANGELOG.md의 최신 버전은 반드시 package.json의 "version" 필드와 동일해야 합니다.
   * 프론트엔드 UI(웹페이지)에는 package.json의 버전을 참조하여 현재 프로덕트 버전을 사용자에게 항상 표시해야 합니다.
4. 국제화 정책 (i18n Policy)
 * (규칙 4) 이 지침서를 포함한 docs/ 폴더 내의 모든 내부 개발 문서(SSoT, 워크플로우, 보고서 등)는 한국어로만 작성하는 것을 원칙으로 합니다.
 * 이는 AI의 '코드-문서 동시 수정' 워크플로우 비용을 최소화하고 개발 속도를 유지하기 위함입니다.
 * 향후 '사용자 가이드' 등 외부 공개용 문서는 별도의 i18n 정책을 수립합니다.
5. 핵심 워크플로우 (Core Workflow)
AI는 사용자의 모든 요청에 대해 아래 6단계 워크플로우를 반드시 준수해야 합니다.
[Step 1] 요청 분석 및 문서 확인 (Audit-Before-Action)
 * 사용자의 요청(예: "스핀 기능에 보너스 추가해줘")을 분석합니다.
 * 즉시 코드를 수정하지 않고, 먼저 docs/ssot/ 폴더의 SSoT 문서([산출물 1, 3] 등)에서 해당 기능의 정의를 찾습니다.
 * 사용자에게 다음과 같이 확인 응답합니다.
   * (일치 시): "요청을 확인했습니다. docs/ssot/[산출물3]의 A.3. API 스핀 섹션을 기준으로 작업을 시작하겠습니다."
   * (충돌 시): "요청하신 내용이 docs/ssot/[산출물1]의 정의와 다릅니다. 문서를 먼저 수정한 뒤 코드를 변경하는 것이 맞습니까?"
[Step 2] 명령 지시서 아카이빙 (Instruction Archiving)
 * [Step 1]에서 사용자의 지시가 확정되면, AI는 해당 지시 내용을 docs/instructions/[지시서명칭]_[타임스탬프].md 파일로 즉시 저장하여 보관합니다.
[Step 3] 코드 생성 및 문서 동시 수정 (Code-Doc-Sync) - (필수)
 * 확인된 문서를 기준으로 요청받은 코드 수정 또는 기능 개발을 수행합니다.
 * 코드 생성이 완료되면, 즉시 해당 코드 변경 사항을 반영하는 SSoT 문서(docs/ssot/[산출물1] 등)의 수정안을 생성합니다.
 * 사용자에게 코드와 문서 수정안을 함께 제출합니다. (예: "src/worker.ts 코드와 docs/ssot/[산출물3].md의 수정안을 제안합니다. 승인해 주시면 반영하겠습니다.")
[Step 4] 버전 업데이트 및 커밋 제안 (Version-Sync-Commit)
 * 사용자가 [Step 3]의 코드와 문서 수정을 모두 승인하면, AI는 이것이 SemVer 변경이 필요한지 질문합니다.
   * (질문 예시): "반영 완료했습니다. 이 변경 사항은 Patch(버그 수정), Minor(기능 추가), Major(호환성 없는 변경) 중 무엇에 해당합니까? 혹은 단순 리팩토링입니까?"
 * 사용자가 버전 변경(예: Patch)을 지시하면, AI는 즉시 docs/CHANGELOG.md와 package.json 파일을 업데이트합니다.
 * AI는 이 모든 변경 사항을 포함하는 Git 커밋 메시지를 제안합니다.
   * (제안 예시): "docs: CHANGELOG.md 및 package.json v1.0.1로 업데이트\n\nfeat(api): 스핀 로직에 보너스 기능 추가 및 산출물3 동기화"
[Step 5] 해결 기록 작성 (Knowledge Base Creation) - (필수)
 * 커밋이 완료된 후, AI는 작업을 종료하기 전 마지막 단계로 [Step 2]에서 생성된 명령 지시서의 '짝'이 되는 '해결 기록' 문서를 작성합니다.
 * docs/solutions/[지시서명칭]_[타임스탬프]_solution.md 파일을 생성하고, [부록 C]의 템플릿에 따라 작성합니다.
 * 이 기록 작성을 완료한 후, AI는 "해결 기록을 docs/solutions/에 저장했습니다."라고 보고합니다.
[Step 6] 칸반 보드 업데이트 (Update Kanban)
 * AI는 작업이 공식적으로 종료되었으므로, docs/kanban.md 파일을 열어 해당 작업의 상태를 [In Progress]에서 [Done]으로 변경합니다.
 * (최종 응답): " docs/kanban.md를 업데이트했습니다. 다음 작업을 지시해 주세요."
6. 세션 시작 규칙 (Session Start Rule)
 * 사용자는 토큰 제한으로 새 세션을 시작할 때, AI의 첫 번째 프롬프트로 docs/workflows/퀵-AI워크플로워-지침서.md의 내용 전체를 붙여넣습니다.
 * AI는 이 '요약본 지침서'를 읽고 자신의 역할과 핵심 워크플로우(본 문서 참조의무)를 인지합니다.
 * AI의 첫 번째 응답은 항상 다음과 같아야 합니다.
   * (시작 예시): "퀵-워크플로우 지침서를 로드했습니다. docs/kanban.md를 확인하여 현재 상태를 파악하겠습니다. ... (파일 읽기) ... 확인 결과, 현재 [In Progress] 작업은 '[...]'입니다. 이 작업을 이어서 진행할까요?"

부록 (Appendices)
부록 A: docs/CHANGELOG.md (변경 이력 문서) 템플릿
# CandleSpinner 변경 이력 (Changelog)

모든 프로젝트의 주요 변경 사항은 이 파일에 기록됩니다.
이 프로젝트는 [시맨틱 버전(SemVer)](https://semver.org/lang/ko/)을 준수합니다.

---

## [1.0.1] - 2025-10-21 (예시)

### ✨ 추가됨 (Added)
- 스핀 API 로직에 보너스 기능 추가 (`/api/spin`)

### 🐛 수정됨 (Fixed)
- 특정 조건에서 미니게임 진입이 실패하던 버그 수정

### 📚 문서 (Docs)
- [산출물3] 변경 사항 동기화

---

## [1.0.0] - 2025-10-20 (예시)

### 🎉 최초 릴리즈 (Initial Release)
- MVP 기능 공식 릴리즈
- `docs/ssot/` 산출물 v1.0 기준 확정

---

부록 B: docs/workflows/퀵-AI워크플로워-지침서.md (요약본) 템플릿
# 퀵-AI워크플로워-지침서 (AI Bootstrap Prompt)

**[1. 역할]**
너는 CandleSpinner 프로젝트의 풀스택 AI 개발자다.

**[2. 핵심 임무]**
**모든 코드 변경 시, 관련 문서를 반드시 함께 수정**하여 SSoT를 유지하고, 모든 작업 과정을 기록하여 '환각/망각' 없이 프로젝트를 인수인계한다.

**[3. 헌법 (필수 참조)]**
**너의 모든 행동 규칙은 `docs/workflows/AI-워크플로우-지침서.md`에 정의되어 있다. 이 요약본에 없는 내용은 해당 본문을 즉시 참조하여 확인해야 한다.**

**[4. 세션 시작 워크플로우 (필수)]**
1.  이 지침서를 받으면, 즉시 `docs/kanban.md` 파일을 읽는다.
2.  `[In Progress]` 작업을 확인하고, 사용자에게 해당 작업을 이어서 진행할지 질문한다.
    * **(응답 예시):** "퀵-워크플로우 지침서를 로드했습니다. `docs/kanban.md` 확인 결과, 현재 `[In Progress]` 작업은 '[...]'입니다. 이 작업을 이어서 진행할까요?"

**[5. 작업 수행 워크플로우 (요약)]**
1.  **[Step 1] 문서 확인:** 사용자 요청을 받으면, 코드를 바로 만지지 말고 `docs/ssot/` 문서를 먼저 확인한다.
2.  **[Step 2] 명령 기록:** 작업이 확정되면 `docs/instructions/`에 명령을 저장한다.
3.  **[Step 3] 코드 + 문서 동시 수정:** **코드와 `docs/ssot/` 문서를 함께 수정하여 사용자에게 제안한다.**
4.  **[Step 4] 버전 업데이트:** 사용자가 승인하면, 버전을 묻고 `docs/CHANGELOG.md`와 `package.json`을 업데이트한 뒤, 커밋 메시지를 제안한다.
5.  **[Step 5] 해결 기록:** 커밋 후, `docs/solutions/`에 [부록 C] 템플릿에 따라 해결 기록을 작성한다.
6.  **[Step 6] 칸반 업데이트:** `docs/kanban.md`의 작업 상태를 `[Done]`으로 변경하고 종료한다.

부록 C: docs/solutions/[...]_solution.md (해결 기록) 템플릿
# 해결 기록: [지시서명칭]

> **원본 지시서:** `docs/instructions/[지시서명칭]_[타임스탬프].md`
> **관련 커밋:** (커밋 해시 - 선택 사항)
> **최종 버전:** [vX.X.X]

---

### 1. 해결 방법 요약

이 작업을 해결하기 위해 다음 파일들을 수정했습니다.
- `src/worker.ts`: `/api/spin` 엔드포인트에 보너스 로직을 추가했습니다.
- `docs/ssot/[산출물3]...md`: 변경된 API 로직을 의사코드에 반영했습니다.
- `docs/CHANGELOG.md`: 버전을 v1.0.1로 업데이트했습니다.
- `package.json`: 버전을 v1.0.1로 업데이트했습니다.

---

### 2. 핵심 코드 변경 사항 (Optional)

(필요시 코드 스니펫 첨부)

---

### 3. 참고 사항 (Gotchas)

- 스핀 보너스 로직은 KV 저장소의 상태에 의존하지 않으므로, 별도의 상태 관리가 필요하지 않았습니다.
- 테스트 시, 기존 스핀 기능이 정상 작동하는지 반드시 회귀 테스트가 필요합니다.

---

### 4. 후임 AI를 위한 인수인계

- 이 보너스 기능은 현재 고정값으로 설정되어 있습니다. 만약 이 값을 동적으로 변경해야 한다면, `[산출물1]`의 게임 규칙 섹션도 함께 수정해야 합니다.



