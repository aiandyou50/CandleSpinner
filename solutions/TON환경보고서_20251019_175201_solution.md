# 해결 기록: TON 블록체인 개발 환경 보고서 작성

> **원본 지시서:** `instructions/TON환경보고서_20251019_175201.md`  
> **최종 버전:** v1.0.1  
> **작성일시:** 2025-10-19 17:52:01

---

## 1. 해결 방법 요약

이 작업은 프로젝트의 TON 블록체인 통합 현황을 분석하고 문서화하는 기술 보고서 작성이었습니다.

### 분석 대상 파일:
- `package.json`: TON 관련 라이브러리 의존성 파악
- `src/hooks/useTonConnect.ts`: TON Connect 지갑 연결 로직 및 Jetton Wallet 파생 메커니즘 분석
- `src/hooks/useRpc.ts`: RPC 통신 래퍼 및 재시도 로직 분석
- `wrangler.toml`: Cloudflare Pages 설정 확인
- `ssot/[산출물2]기술-스택-및-아키텍처-설계.md`: 아키텍처 정의 참조

### 생성된 산출물:
- `reports/[보고서]_20251019_TON환경보고서.md`: 완성된 기술 보고서

---

## 2. 핵심 발견 사항

### 2.1 TON 라이브러리 사용 현황

**프론트엔드:**
- 총 6개의 TON 관련 라이브러리 사용 중
- `@tonconnect/ui-react`: 공식 TON Connect UI (React 통합)
- `@ton/core`, `@ton/crypto`, `@ton/ton`: 최신 TON SDK
- `ton-core`, `tonweb`: 레거시 라이브러리 (중복 가능성)

**백엔드:**
- TON 라이브러리 직접 사용 없음
- 순수 오프체인 게임 로직만 처리

### 2.2 지갑 연결 메커니즘

**다층 폴백 전략 발견:**
1. ton-core 라이브러리 우선 시도
2. RPC API 호출로 폴백
3. 수동 입력 최종 폴백

이 전략은 다양한 환경에서의 호환성을 보장합니다.

### 2.3 아키텍처 특징

**온체인-오프체인 분리:**
- 온체인: 입금/인출만 (가스비 발생)
- 오프체인: 모든 게임 로직 (무료, 빠름)

이 설계는 사용자 경험과 비용 효율성을 모두 만족시킵니다.

---

## 3. 개선 제안 사항

보고서에 다음 개선 제안을 포함했습니다:

1. **라이브러리 중복 제거:** `ton-core` 레거시 버전 제거 검토
2. **RPC 폴백 체인 개선:** 다중 RPC 공급자 설정
3. **트랜잭션 상태 추적:** 온체인 확인 로직 강화

---

## 4. 참고 사항 (Gotchas)

### 4.1 Buffer 폴리필 필요

Cloudflare Pages Functions에서 `nodejs_compat` 플래그 필요:
- 이유: TON 라이브러리들이 Node.js의 Buffer API 사용
- 해결: `wrangler.toml`에 `compatibility_flags = ["nodejs_compat"]` 설정 확인

### 4.2 Private Key 없음

백엔드는 Private Key를 가지지 않으므로:
- 직접 온체인 트랜잭션 전송 불가
- 인출 처리는 별도 보안 서버 필요

### 4.3 환경 변수 의존성

`VITE_FUNCTION_API_KEY` 환경 변수가 설정되지 않으면:
- RPC 호출 시 인증 헤더 누락 가능
- 로컬 개발 환경에서 이 변수 설정 필수

---

## 5. 후임 AI를 위한 인수인계

### 5.1 보고서 활용 방법

이 보고서는 다음 상황에서 참조하세요:
- 신규 개발자 온보딩
- TON 관련 라이브러리 업데이트 결정
- 지갑 연결 이슈 디버깅
- 아키텍처 변경 검토

### 5.2 SSoT와의 관계

**중요:** 이 보고서는 SSoT가 아닙니다.
- SSoT: `ssot/[산출물2]기술-스택-및-아키텍처-설계.md`
- 이 보고서: 현재 구현 상태의 스냅샷

코드 변경 시 SSoT는 반드시 업데이트해야 하지만, reports/ 폴더의 보고서는 시점 기록이므로 수정하지 않습니다.

### 5.3 다음 작업 제안

1. `ton-core` 레거시 제거 가능성 조사
2. 인출 처리기(Withdrawal Processor) 구현
3. RPC 상태 모니터링 대시보드 추가

---

**해결 기록 종료**
