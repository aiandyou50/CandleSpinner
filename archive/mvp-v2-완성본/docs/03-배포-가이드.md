# ë°°í¬ ê°€ì´ë“œ - Cloudflare Workers

**ëª©í‘œ**: í”„ë¡œë•ì…˜ ë°°í¬ ë° ìš´ì˜

---

## ğŸ“‹ ì‚¬ì „ ì¤€ë¹„

### 1. Cloudflare ê³„ì •
- https://cloudflare.com ê°€ì…
- Workers í”Œëœ: Free (ì¶©ë¶„í•¨)

### 2. Wrangler CLI ì„¤ì¹˜
```bash
npm install -g wrangler
# ë˜ëŠ” í”„ë¡œì íŠ¸ ë¡œì»¬
npm install --save-dev wrangler
```

### 3. Wrangler ë¡œê·¸ì¸
```bash
npx wrangler login
```

---

## ğŸš€ ë°°í¬ í”„ë¡œì„¸ìŠ¤

### Step 1: KV Namespace ìƒì„±

```bash
# KV ìƒì„±
npx wrangler kv:namespace create CREDIT_KV

# ì¶œë ¥ ì˜ˆì‹œ:
# { binding = "CREDIT_KV", id = "abc123..." }
```

**wrangler.toml ì—…ë°ì´íŠ¸**:
```toml
[[kv_namespaces]]
binding = "CREDIT_KV"
id = "abc123..."  # ìƒì„±ëœ ID ì…ë ¥
```

### Step 2: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**ë°©ë²• A: Cloudflare Dashboard (ê¶Œì¥)**
```
1. https://dash.cloudflare.com/workers
2. candlespinner-workers â†’ Settings â†’ Variables
3. Add Variable â†’ Secret:
   - GAME_WALLET_MNEMONIC: "word1 word2 ... word24"
   - TONCENTER_API_KEY: "your_api_key"
4. Add Variable â†’ Text:
   - GAME_WALLET_ADDRESS: "UQBFPDd..."
   - CSPIN_JETTON_MASTER: "EQBZ6nH..."
   - CSPIN_JETTON_WALLET: "EQD6zAw..."
```

**ë°©ë²• B: Wrangler CLI**
```bash
npx wrangler secret put GAME_WALLET_MNEMONIC
# í”„ë¡¬í”„íŠ¸ì—ì„œ ë‹ˆëª¨ë‹‰ ì…ë ¥

npx wrangler secret put TONCENTER_API_KEY
# í”„ë¡¬í”„íŠ¸ì—ì„œ API í‚¤ ì…ë ¥
```

### Step 3: ë¹Œë“œ

```bash
npm run build
```

**í™•ì¸ì‚¬í•­**:
```bash
# dist í´ë” ìƒì„± í™•ì¸
ls dist/
# ì¶œë ¥:
# index.html
# assets/
# _routes.json  â† ì¤‘ìš”!
```

### Step 4: ë°°í¬

```bash
npx wrangler deploy
```

**ì¶œë ¥**:
```
ğŸŒ€ Building list of assets...
ğŸŒ€ Starting asset upload...
âœ¨ Success! Uploaded 4 files

Your worker has access to the following bindings:
- KV Namespaces:
  - CREDIT_KV: abc123...
  
Deployed candlespinner-workers triggers
  https://candlespinner-workers.your-subdomain.workers.dev
Current Version ID: xyz789...
```

### Step 5: ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì„¤ì •

```
1. Cloudflare Dashboard â†’ Workers
2. candlespinner-workers â†’ Triggers
3. Custom Domains â†’ Add Custom Domain
4. ì…ë ¥: aiandyou.me
5. DNS ìë™ ì„¤ì • ì™„ë£Œ
```

---

## âœ… ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

### 1. ê¸°ë³¸ ì ‘ì†
```bash
curl https://aiandyou.me/
# HTML ë°˜í™˜ í™•ì¸
```

### 2. API í…ŒìŠ¤íŠ¸
```bash
curl https://aiandyou.me/api/check-api-key
# JSON: {"status":"ok","hasApiKey":true}
```

### 3. ê´€ë¦¬ì í˜ì´ì§€
```bash
curl https://aiandyou.me/admin
# HTML ë°˜í™˜ (index.htmlê³¼ ë™ì¼)
```

### 4. ë¸Œë¼ìš°ì € í…ŒìŠ¤íŠ¸
1. https://aiandyou.me ì ‘ì†
   - âœ… ê²Œì„ í˜ì´ì§€ ë¡œë“œ
   - âœ… TON Connect ì‘ë™

2. https://aiandyou.me/admin ì ‘ì†
   - âœ… ê´€ë¦¬ì í˜ì´ì§€ ë¡œë“œ
   - âœ… "ê´€ë¦¬ì ì¸ì¦ í•„ìš”" í‘œì‹œ

---

## ğŸ”§ wrangler.toml ì„¤ì •

```toml
# Cloudflare Workers ì„¤ì •
name = "candlespinner-workers"
compatibility_date = "2024-11-01"
main = "src/index.ts"
compatibility_flags = ["nodejs_compat"]

# Assets (React ë¹Œë“œ ê²°ê³¼ë¬¼)
[assets]
directory = "./dist"
binding = "ASSETS"

# KV Namespace
[[kv_namespaces]]
binding = "CREDIT_KV"
id = "your_kv_id_here"

# í™˜ê²½ ë³€ìˆ˜ëŠ” Dashboardì—ì„œ ì„¤ì •!
# ì ˆëŒ€ wrangler.tomlì— ì§ì ‘ ì‘ì„± ê¸ˆì§€!
```

---

## ğŸ› ë°°í¬ ë¬¸ì œ í•´ê²°

### Error 1101 - Worker threw exception

**ì¦ìƒ**: /admin ì ‘ì† ì‹œ 500 ì—ëŸ¬

**ì›ì¸**: ASSETS ë°”ì¸ë”© ëˆ„ë½

**í•´ê²°**:
```toml
[assets]
directory = "./dist"
binding = "ASSETS"  â† ì¶”ê°€!
```

```typescript
// src/index.ts - ì—ëŸ¬ í•¸ë“¤ë§
if (!env.ASSETS) {
  return new Response('ASSETS not configured', { status: 500 });
}
```

### dist/_routes.json ëˆ„ë½

**ì¦ìƒ**: ë¹Œë“œ ì„±ê³µí–ˆëŠ”ë° _routes.json ì—†ìŒ

**í•´ê²°**: vite.config.ts í”ŒëŸ¬ê·¸ì¸ í™•ì¸
```typescript
{
  name: 'generate-routes-json',
  closeBundle() {
    fs.writeFileSync(
      path.resolve(__dirname, 'dist/_routes.json'),
      JSON.stringify({
        version: 1,
        include: ['/*'],
        exclude: ['/assets/*']
      }, null, 2)
    );
  }
}
```

### í™˜ê²½ ë³€ìˆ˜ ì˜¤ë¥˜

**ì¦ìƒ**: "GAME_WALLET_ADDRESS: NOT SET"

**í•´ê²°**:
```bash
# Dashboardì—ì„œ í™•ì¸
# Workers â†’ candlespinner-workers â†’ Settings â†’ Variables

# ë˜ëŠ” CLIë¡œ í™•ì¸
npx wrangler secret list
```

---

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ë¡œê·¸ í™•ì¸

**ì‹¤ì‹œê°„ ë¡œê·¸**:
```bash
npx wrangler tail
```

**Dashboard**:
```
Cloudflare Dashboard â†’ Workers â†’ candlespinner-workers â†’ Logs
```

### ë©”íŠ¸ë¦­ í™•ì¸

```
Dashboard â†’ Workers â†’ candlespinner-workers â†’ Metrics
- Requests
- Errors
- CPU Time
- KV Operations
```

---

## ğŸ”„ ì—…ë°ì´íŠ¸ í”„ë¡œì„¸ìŠ¤

### ì½”ë“œ ë³€ê²½ ì‹œ

```bash
# 1. ìˆ˜ì • ì‚¬í•­ í™•ì¸
git status

# 2. ë¹Œë“œ
npm run build

# 3. ë°°í¬
npx wrangler deploy

# 4. Git ì»¤ë°‹
git add .
git commit -m "feat: ìƒˆ ê¸°ëŠ¥ ì¶”ê°€"
git push origin main
```

### í™˜ê²½ ë³€ìˆ˜ ë³€ê²½ ì‹œ

```bash
# Cloudflare Dashboardì—ì„œ ìˆ˜ì •
# ë˜ëŠ”
npx wrangler secret put VARIABLE_NAME
```

**ì£¼ì˜**: í™˜ê²½ ë³€ìˆ˜ ë³€ê²½ í›„ ì¬ë°°í¬ ë¶ˆí•„ìš” (ì¦‰ì‹œ ë°˜ì˜)

---

## ğŸ’° ë¹„ìš©

### Cloudflare Workers Free í”Œëœ
- ìš”ì²­: 100,000/ì¼
- KV ì½ê¸°: 100,000/ì¼
- KV ì“°ê¸°: 1,000/ì¼
- KV ìŠ¤í† ë¦¬ì§€: 1GB

**ì˜ˆìƒ ë¹„ìš©**: $0/ì›” (MVP ì¶©ë¶„)

### TON ë„¤íŠ¸ì›Œí¬ ìˆ˜ìˆ˜ë£Œ
- ì…ê¸ˆ: ì‚¬ìš©ì ë¶€ë‹´ (~0.2 TON)
- ì¸ì¶œ: ê²Œì„ ë¶€ë‹´ (~0.2 TON/ê±´)

**ì›” ë¹„ìš© ì˜ˆì‹œ**:
- ì¸ì¶œ 10ê±´/ì›”: 2 TON = $5
- ì¸ì¶œ 100ê±´/ì›”: 20 TON = $50

---

## âœ… ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Wrangler CLI ì„¤ì¹˜
- [ ] Cloudflare ë¡œê·¸ì¸
- [ ] KV Namespace ìƒì„±
- [ ] wrangler.toml KV ID ì„¤ì •
- [ ] í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (Dashboard)
- [ ] npm run build ì„±ê³µ
- [ ] dist/_routes.json í™•ì¸
- [ ] npx wrangler deploy ì„±ê³µ
- [ ] ì»¤ìŠ¤í…€ ë„ë©”ì¸ ì„¤ì •
- [ ] https://your-domain ì ‘ì† í™•ì¸
- [ ] /api ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
- [ ] /admin í˜ì´ì§€ í™•ì¸
- [ ] TON Connect ì‘ë™ í™•ì¸
- [ ] ì…ê¸ˆ í…ŒìŠ¤íŠ¸ (í…ŒìŠ¤íŠ¸ë„·)
- [ ] ì¸ì¶œ í…ŒìŠ¤íŠ¸

---

**ë°°í¬ ì™„ë£Œ!** ğŸ‰
