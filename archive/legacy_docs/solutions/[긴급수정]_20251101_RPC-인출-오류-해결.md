***REMOVED***[ê¸´ê¸‰ ìˆ˜ì •] RPC ì¸ì¶œ ì˜¤ë¥˜ í•´ê²° - "bad secret key size" ìˆ˜ì •

**ì‘ì„±ì¼**: 2025-11-01  
**ë²„ì „**: v2.5.1  
**ì‘ì—…ì**: GitHub Copilot AI Agent

---

#***REMOVED***ğŸ“‹ ë¬¸ì œ ìš”ì•½

##***REMOVED***ì¦ìƒ
- RPCë¥¼ í†µí•œ ì ¯í†¤ ì¸ì¶œ(withdrawal) í•¨ìˆ˜ ì‹¤í–‰ ì‹œ ë‹¤ìŒ ì˜¤ë¥˜ ë°œìƒ:
  ```
  âŒ ì˜¤ë¥˜: bad secret key size (API Status 500)
  ```

##***REMOVED***ê·¼ë³¸ ì›ì¸
- **GAME_WALLET_PRIVATE_KEY í™˜ê²½ë³€ìˆ˜ì˜ í˜•ì‹ ë¶ˆì¼ì¹˜**
  - ì‹¤ì œ ì €ì¥ëœ ê°’: **ë‹ˆëª¨ë‹‰(24ë‹¨ì–´ mnemonic)**
  - ì½”ë“œê°€ ê¸°ëŒ€í•œ ê°’: **64ë°”ì´íŠ¸ hex ë¬¸ìì—´ (128ì)**
  
- ì½”ë“œê°€ ë‹ˆëª¨ë‹‰ì„ hexë¡œ íŒŒì‹±í•˜ë ¤ê³  ì‹œë„í•˜ì—¬ "bad secret key size" ì˜¤ë¥˜ ë°œìƒ

---

#***REMOVED***ğŸ”§ í•´ê²° ë°©ë²•

##***REMOVED***ë³€ê²½ ì‚¬í•­

ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì—ì„œ **ë‹ˆëª¨ë‹‰ â†’ í‚¤í˜ì–´ ë³€í™˜ ë¡œì§** ìˆ˜ì •:

###***REMOVED***ë³€ê²½ ì „ (ì˜ëª»ëœ ì½”ë“œ)
```typescript
import { keyPairFromSecretKey } from '@ton/crypto';

const gameWalletPrivateKey = env.GAME_WALLET_PRIVATE_KEY;
const keyPair = keyPairFromSecretKey(Buffer.from(gameWalletPrivateKey, 'hex'));
```

###***REMOVED***ë³€ê²½ í›„ (ìˆ˜ì •ëœ ì½”ë“œ)
```typescript
import { mnemonicToPrivateKey, mnemonicValidate } from '@ton/crypto';

const gameWalletMnemonic = env.GAME_WALLET_PRIVATE_KEY;
const mnemonic = gameWalletMnemonic.trim().split(/\s+/);

// BIP39 ìœ íš¨ì„± ê²€ì¦
const isValid = await mnemonicValidate(mnemonic);
if (!isValid) {
  throw new Error('ìœ íš¨í•˜ì§€ ì•Šì€ ë‹ˆëª¨ë‹‰: BIP39 ê²€ì¦ ì‹¤íŒ¨');
}

// ë‹ˆëª¨ë‹‰ì„ í‚¤í˜ì–´ë¡œ ë³€í™˜
const keyPair = await mnemonicToPrivateKey(mnemonic);
```

---

#***REMOVED***ğŸ“ ìˆ˜ì •ëœ íŒŒì¼ ëª©ë¡

##***REMOVED***1. **ì¸ì¶œ(Withdrawal) API** (3ê°œ íŒŒì¼)
- `functions/api/initiate-withdrawal.ts` âœ… (ë©”ì¸ ë²„ì „)
- `functions/api/initiate-withdrawal-v3.ts` âœ… (ëŒ€ì²´ ë²„ì „)
- `functions/api/initiate-withdrawal-v2-backup.ts` âœ… (ë°±ì—… ë²„ì „)

##***REMOVED***2. **ì…ê¸ˆ(Deposit) API** (1ê°œ íŒŒì¼)
- `functions/api/initiate-deposit.ts` âœ…

##***REMOVED***3. **ë””ë²„ê·¸/ì§„ë‹¨ API** (2ê°œ íŒŒì¼)
- `functions/api/debug-withdrawal.ts` âœ…
  - ë‹ˆëª¨ë‹‰ ë‹¨ì–´ ìˆ˜ í‘œì‹œ
  - ì²˜ìŒ 3ë‹¨ì–´ë§Œ ë§ˆìŠ¤í‚¹í•˜ì—¬ í‘œì‹œ
  
- `functions/api/debug-private-key.ts` âœ…
  - BIP39 ê²€ì¦ ë¡œì§ ì¶”ê°€
  - ë‹ˆëª¨ë‹‰ í˜•ì‹ í™•ì¸

---

#***REMOVED***âœ… ê²€ì¦ ê²°ê³¼

##***REMOVED***ë¹Œë“œ í…ŒìŠ¤íŠ¸
```bash
âœ… npm run typecheck  ***REMOVED***TypeScript ì»´íŒŒì¼ í†µê³¼
âœ… npm run build      ***REMOVED***Vite ë¹Œë“œ ì„±ê³µ
```

##***REMOVED***ë³´ì•ˆ ê²€ì¦
- âœ… ë‹ˆëª¨ë‹‰ì€ ì ˆëŒ€ ë¡œê·¸ì— ì¶œë ¥ë˜ì§€ ì•ŠìŒ
- âœ… í™˜ê²½ë³€ìˆ˜ì—ì„œë§Œ ì½ì–´ì˜´
- âœ… ë©”ëª¨ë¦¬ì—ì„œë§Œ ì²˜ë¦¬ë˜ê³  ì €ì¥ë˜ì§€ ì•ŠìŒ
- âœ… BIP39 ê²€ì¦ì„ í†µí•´ ìœ íš¨ì„± í™•ì¸

---

#***REMOVED***ğŸš€ ë°°í¬ ê°€ì´ë“œ

##***REMOVED***1. Cloudflare Pages í™˜ê²½ë³€ìˆ˜ í™•ì¸

**ì¤‘ìš”**: `GAME_WALLET_PRIVATE_KEY`ê°€ **ë‹ˆëª¨ë‹‰ í˜•ì‹**(24ë‹¨ì–´)ìœ¼ë¡œ ì €ì¥ë˜ì–´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.

```
í˜•ì‹: word1 word2 word3 ... word24
ì˜ˆì‹œ: abandon ability able about above absent ... (24ê°œ ë‹¨ì–´)
```

###***REMOVED***í™˜ê²½ë³€ìˆ˜ ì„¤ì • ìœ„ì¹˜
- URL: https://dash.cloudflare.com/[account]/pages/candlespinner/settings/environment-variables
- ë³€ìˆ˜ëª…: `GAME_WALLET_PRIVATE_KEY`
- ê°’: 24ë‹¨ì–´ ë‹ˆëª¨ë‹‰ (ê³µë°±ìœ¼ë¡œ êµ¬ë¶„)

##***REMOVED***2. ë°°í¬ í›„ í…ŒìŠ¤íŠ¸

###***REMOVED***A. ë””ë²„ê·¸ ì—”ë“œí¬ì¸íŠ¸ë¡œ ê²€ì¦
```bash
***REMOVED***1. ë‹ˆëª¨ë‹‰ í˜•ì‹ í™•ì¸
curl https://aiandyou.me/api/debug-private-key

***REMOVED***ì˜ˆìƒ ì‘ë‹µ:
{
  "status": "âœ… ëª¨ë“  ê²€ì¦ í†µê³¼!",
  "mnemonicValid": true,
  "mnemonicWordCount": 24,
  "addressMatches": true,
  "verification": "âœ… ë‹ˆëª¨ë‹‰ê³¼ ì§€ê°‘ ì£¼ì†Œê°€ ì¼ì¹˜í•©ë‹ˆë‹¤! (V5R1 - Telegram TON Wallet)"
}
```

```bash
***REMOVED***2. ì¸ì¶œ API ìƒíƒœ í™•ì¸
curl https://aiandyou.me/api/debug-withdrawal

***REMOVED***ì˜ˆìƒ ì‘ë‹µ:
{
  "status": {
    "mnemonicValid": true,
    "gameWalletValid": true,
    "cspinTokenValid": true
  },
  "addressMatch": {
    "match": true,
    "note": "âœ… ë‹ˆëª¨ë‹‰ê³¼ ì£¼ì†Œê°€ ì¼ì¹˜í•©ë‹ˆë‹¤ (í˜•ì‹ ë¬´ê´€)"
  }
}
```

###***REMOVED***B. ì‹¤ì œ ì¸ì¶œ í…ŒìŠ¤íŠ¸
```bash
curl -X POST https://aiandyou.me/api/initiate-withdrawal \
  -H "Content-Type: application/json" \
  -d '{
    "walletAddress": "UQB...",
    "withdrawalAmount": 1,
    "userJettonWalletAddress": "EQA..."
  }'

***REMOVED***ì˜ˆìƒ ì‘ë‹µ:
{
  "success": true,
  "txHash": "abc123...",
  "message": "RPC ë°©ì‹ ì¸ì¶œ ì™„ë£Œ: 1 CSPIN"
}
```

---

#***REMOVED***ğŸ“ ì¶”ê°€ ë…¸íŠ¸

##***REMOVED***ë‹ˆëª¨ë‹‰ vs ê°œì¸í‚¤ (Private Key)

| í˜•ì‹ | ì˜ˆì‹œ | ê¸¸ì´ | ì‚¬ìš© ëª©ì  |
|------|------|------|----------|
| **ë‹ˆëª¨ë‹‰** | `abandon ability able...` | 24ë‹¨ì–´ | ì‚¬ëŒì´ ê¸°ì–µí•˜ê¸° ì‰¬ìš´ í˜•íƒœ |
| **ê°œì¸í‚¤ (hex)** | `4e6568d1990bff34...` | 128ì (64ë°”ì´íŠ¸) | í”„ë¡œê·¸ë¨ì´ ì§ì ‘ ì‚¬ìš© |

- í˜„ì¬ í”„ë¡œì íŠ¸ëŠ” **ë‹ˆëª¨ë‹‰** í˜•ì‹ ì‚¬ìš©
- TONì˜ `mnemonicToPrivateKey()` í•¨ìˆ˜ê°€ ë³€í™˜ ì²˜ë¦¬

##***REMOVED***ë³´ì•ˆ ê¶Œì¥ì‚¬í•­

1. âœ… **ë‹ˆëª¨ë‹‰ì€ ì ˆëŒ€ ë¡œê·¸ì— ì¶œë ¥í•˜ì§€ ë§ˆì„¸ìš”**
   - í˜„ì¬ ì½”ë“œëŠ” ì•ˆì „: `console.log('[RPC] í‚¤ ìŒ ë³€í™˜ ì™„ë£Œ')` (ë‹ˆëª¨ë‹‰ ë¯¸ì¶œë ¥)

2. âœ… **ë‹ˆëª¨ë‹‰ì€ í™˜ê²½ë³€ìˆ˜ì—ë§Œ ì €ì¥**
   - Cloudflare Pages í™˜ê²½ë³€ìˆ˜ ì‚¬ìš© ì¤‘
   - Gitì—ëŠ” ì ˆëŒ€ ì»¤ë°‹í•˜ì§€ ì•ŠìŒ (`.gitignore` ì ìš©)

3. âœ… **BIP39 ê²€ì¦ í•„ìˆ˜**
   - í˜„ì¬ ì½”ë“œëŠ” `mnemonicValidate()` ì‚¬ìš©

---

#***REMOVED***ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [TON ê³µì‹ ë¬¸ì„œ - Mnemonic](https://docs.ton.org/develop/wallets/mnemonic)
- [@ton/crypto API](https://github.com/ton-org/ton-crypto)
- [BIP39 Mnemonic Standard](https://github.com/bitcoin/bips/blob/master/bip-0039.mediawiki)

---

#***REMOVED***ğŸ¯ ê²°ë¡ 

ì´ë²ˆ ìˆ˜ì •ìœ¼ë¡œ ë‹¤ìŒ ë¬¸ì œë“¤ì´ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤:

1. âœ… "bad secret key size" ì˜¤ë¥˜ í•´ê²°
2. âœ… ë‹ˆëª¨ë‹‰ â†’ í‚¤í˜ì–´ ë³€í™˜ ë¡œì§ ìˆ˜ì •
3. âœ… BIP39 ìœ íš¨ì„± ê²€ì¦ ì¶”ê°€
4. âœ… ëª¨ë“  ì¸ì¶œ/ì…ê¸ˆ API ì¼ê´€ì„± ìœ ì§€
5. âœ… ë””ë²„ê·¸ ì—”ë“œí¬ì¸íŠ¸ ê°œì„ 

**ë‹¤ìŒ ë‹¨ê³„**: í”„ë¡œë•ì…˜ ë°°í¬ í›„ ì‹¤ì œ ì¸ì¶œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰

---

**ìˆ˜ì • ì™„ë£Œì¼**: 2025-11-01  
**ê²€ì¦ ìƒíƒœ**: âœ… ë¡œì»¬ ë¹Œë“œ í…ŒìŠ¤íŠ¸ í†µê³¼  
**ë°°í¬ ëŒ€ê¸°**: ì‚¬ìš©ì í™•ì¸ í•„ìš”
