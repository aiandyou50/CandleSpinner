# ì¸ì¶œ êµ¬í˜„ ê·¼ë³¸ì  ë¬¸ì œ: ê²Œì„ ì„œëª… í•„ìš”

**ì‘ì„±ì¼**: 2025-11-02  
**ë¬¸ì œ**: í˜„ì¬ êµ¬í˜„ì´ ì…ê¸ˆê³¼ ë™ì¼í•˜ê²Œ ë™ì‘ (ì‚¬ìš©ìâ†’ê²Œì„)  
**ì›ì¸**: Jetton TransferëŠ” ì„œëª…ìì˜ í† í°ë§Œ ì „ì†¡ ê°€ëŠ¥  
**ê²°ë¡ **: ê²Œì„ ë‹ˆëª¨ë‹‰ ì„œëª… ì—†ì´ëŠ” ê²Œì„â†’ì‚¬ìš©ì ì „ì†¡ ë¶ˆê°€ëŠ¥

---

## ğŸš¨ ë¬¸ì œ ë°œê²¬

### ì‚¬ìš©ì í…ŒìŠ¤íŠ¸ ê²°ê³¼
1. âœ… ì¸ì¶œí•˜ê¸° ë²„íŠ¼ í´ë¦­ â†’ íŠ¸ëœì­ì…˜ ìƒì„±
2. âœ… ì§€ê°‘ ìŠ¹ì¸
3. âŒ **1 CSPINì´ ì§€ê°‘ì—ì„œ ë¹ ì ¸ë‚˜ê° (ì…ê¸ˆê³¼ ë™ì¼!)**
4. âŒ **1 CSPINì´ ë“¤ì–´ì˜¤ì§€ ì•ŠìŒ**

### ë””ë²„ê·¸ ë¡œê·¸ ë¶„ì„
```json
{
  "address": "EQCEhINVl6GjdghH66wdyGBqSVbon7EPoICWsyXfvQZDRyGc",  // â† ì‚¬ìš©ì Jetton Wallet
  "amount": "200000000",  // 0.2 TON
  "payload": {
    "opcode": "0xf8a7ea5",  // Jetton Transfer
    "amount": "1000000000",  // 1 CSPIN
    "destination": "ê²Œì„ TON ì§€ê°‘",  // â† ê²Œì„ì—ê²Œ ë³´ë‚´ë¼!
    "response_destination": "ì‚¬ìš©ì TON ì§€ê°‘"
  }
}
```

**í•´ì„**:
- ë©”ì‹œì§€ ì „ì†¡ì: **ì‚¬ìš©ì**
- ë©”ì‹œì§€ ìˆ˜ì‹ ì: **ì‚¬ìš©ì Jetton Wallet**
- ë‚´ìš©: "ê²Œì„ì—ê²Œ 1 CSPIN ë³´ë‚´"
- ê²°ê³¼: **ì‚¬ìš©ì â†’ ê²Œì„** (ì…ê¸ˆ!)

---

## ğŸ“– TEP-74 Jetton Transfer ì´í•´

### í•µì‹¬ ì›ë¦¬
```
Jetton Transferì˜ ì ˆëŒ€ ê·œì¹™:
- ë©”ì‹œì§€ë¥¼ ë³´ë‚´ëŠ” ì‚¬ëŒ = ì„œëª…í•˜ëŠ” ì‚¬ëŒ
- ì„œëª…í•˜ëŠ” ì‚¬ëŒ = í† í° ì†Œìœ ì
- í† í° ì†Œìœ ìì˜ Jetton Walletë§Œ ì œì–´ ê°€ëŠ¥
```

### ì…ê¸ˆ (í˜„ì¬ êµ¬í˜„ë¨)
```
[ì‚¬ìš©ì]
  â†“ (ì„œëª…: ì‚¬ìš©ì ê°œì¸í‚¤)
[ì‚¬ìš©ì Jetton Wallet]
  â†“ "ê²Œì„ì—ê²Œ 1 CSPIN ë³´ë‚´"
[ê²Œì„ Jetton Wallet]
  â†“ (ìë™ ìˆ˜ë ¹)
[ê²Œì„]
```

### ì¸ì¶œ (ì›í•˜ëŠ” ë™ì‘)
```
[ê²Œì„]
  â†“ (ì„œëª…: ê²Œì„ ê°œì¸í‚¤) â† âœ… ì´ê²ƒì´ í•„ìš”!
[ê²Œì„ Jetton Wallet]
  â†“ "ì‚¬ìš©ìì—ê²Œ 1 CSPIN ë³´ë‚´"
[ì‚¬ìš©ì Jetton Wallet]
  â†“ (ìë™ ìˆ˜ë ¹)
[ì‚¬ìš©ì]
```

**ë¬¸ì œ**: ì‚¬ìš©ìëŠ” ê²Œì„ì˜ ê°œì¸í‚¤ê°€ ì—†ìŒ!

---

## â“ ì§ˆë¬¸ ë‹µë³€

### Q3: ì›ë˜ ê³„íšì´ ë§ëŠ”ê°€?
**âœ… ë„¤, ë§ìŠµë‹ˆë‹¤!**

ì›ë˜ ê³„íš:
> ê²Œì„ ìš´ì˜ ì§€ê°‘ CSPIN í† í° Jetton Walletì—ê²Œ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ì„œ  
> CSPIN í† í°ì„ ê²Œì„ ìœ ì € ì§€ê°‘ìœ¼ë¡œ ë³´ë‚¸ë‹¤

**ì´ê²ƒì´ ì •í™•íˆ ì¸ì¶œì…ë‹ˆë‹¤!**

### Q4: ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì—†ì´ ê°€ëŠ¥í•œê°€?
**âŒ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤ (ê²Œì„ ë‹ˆëª¨ë‹‰ ì„œëª… í•„ìš”)**

**ê°€ëŠ¥í•œ ê²½ìš°**:
- ë°±ì—”ë“œì—ì„œ ê²Œì„ ë‹ˆëª¨ë‹‰ìœ¼ë¡œ ì„œëª…
- Node.js, Python ë“± ì„œë²„ í™˜ê²½

**ë¶ˆê°€ëŠ¥í•œ ê²½ìš°**:
- Cloudflare Workers (@ton/ton ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œì•½)
- í”„ë¡ íŠ¸ì—”ë“œë§Œ ì‚¬ìš© (ê²Œì„ ë‹ˆëª¨ë‹‰ ë…¸ì¶œ ìœ„í—˜)

---

## ğŸ› ï¸ í•´ê²° ë°©ì•ˆ

### Option 1: ë°±ì—”ë“œ RPC (Node.js ì„œë²„)

**êµ¬ì¡°**:
```
[í”„ë¡ íŠ¸ì—”ë“œ]
  â†“ /api/withdraw ìš”ì²­
[Node.js ì„œë²„]
  â†“ ê²Œì„ ë‹ˆëª¨ë‹‰ìœ¼ë¡œ ì„œëª…
[ê²Œì„ Jetton Wallet]
  â†“ "ì‚¬ìš©ìì—ê²Œ ì „ì†¡"
[ì‚¬ìš©ì Jetton Wallet]
```

**ì¥ì **:
- âœ… ìë™ ì¸ì¶œ
- âœ… ì¦‰ì‹œ ì²˜ë¦¬
- âœ… ì‚¬ìš©ì ê²½í—˜ ìµœê³ 

**ë‹¨ì **:
- âŒ Node.js ì„œë²„ í•„ìš” (Cloudflare Workers X)
- âŒ ì¸í”„ë¼ ë¹„ìš© ì¦ê°€
- âŒ ë³´ì•ˆ ê´€ë¦¬ í•„ìš” (ë‹ˆëª¨ë‹‰ ì €ì¥)

**êµ¬í˜„ ì˜ˆì‹œ**:
```typescript
// Node.js ì„œë²„ (Express ë“±)
import { WalletContractV5R1, TonClient, Address, beginCell, toNano } from '@ton/ton';
import { mnemonicToPrivateKey } from '@ton/crypto';

app.post('/api/withdraw', async (req, res) => {
  const { walletAddress, amount } = req.body;
  
  // 1. ê²Œì„ ì§€ê°‘ ì´ˆê¸°í™”
  const mnemonic = process.env.GAME_WALLET_MNEMONIC!.split(' ');
  const keyPair = await mnemonicToPrivateKey(mnemonic);
  
  const gameWallet = WalletContractV5R1.create({
    workchain: 0,
    publicKey: keyPair.publicKey
  });
  
  const tonClient = new TonClient({
    endpoint: 'https://toncenter.com/api/v2/jsonRPC',
    apiKey: process.env.TONCENTER_API_KEY
  });
  
  const contract = tonClient.open(gameWallet);
  
  // 2. seqno ì¡°íšŒ
  const seqno = await contract.getSeqno();
  
  // 3. ê²Œì„ Jetton Wallet ì£¼ì†Œ
  const gameJettonWallet = Address.parse(process.env.CSPIN_JETTON_WALLET!);
  
  // 4. Jetton Transfer Payload
  const userAddress = Address.parse(walletAddress);
  const amountNano = BigInt(Math.floor(amount * 1_000_000_000));
  
  const payload = beginCell()
    .storeUint(0xf8a7ea5, 32)      // Jetton transfer
    .storeUint(0, 64)              // query_id
    .storeCoins(amountNano)        // amount
    .storeAddress(userAddress)     // âœ… ì‚¬ìš©ìì—ê²Œ ë³´ë‚´ë¼!
    .storeAddress(userAddress)     // response_destination
    .storeBit(0)                   // custom_payload
    .storeCoins(BigInt(1))         // forward_ton_amount
    .storeBit(0)                   // forward_payload
    .endCell();
  
  // 5. íŠ¸ëœì­ì…˜ ìƒì„±
  const transfer = gameWallet.createTransfer({
    seqno,
    secretKey: keyPair.secretKey,  // âœ… ê²Œì„ ê°œì¸í‚¤ë¡œ ì„œëª…!
    messages: [
      {
        to: gameJettonWallet,
        value: toNano('0.2'),  // ê²Œì„ì´ ë„¤íŠ¸ì›Œí¬ Fee ë¶€ë‹´
        body: payload
      }
    ]
  });
  
  // 6. BOC ì „ì†¡
  await contract.send(transfer);
  
  res.json({ success: true });
});
```

**ë¹„ìš©**:
- ê²Œì„ì´ ë„¤íŠ¸ì›Œí¬ Fee ë¶€ë‹´ (0.2 TON/ì¸ì¶œ)
- ì„œë²„ ìš´ì˜ ë¹„ìš©

---

### Option 2: ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸

**êµ¬ì¡°**:
```
[ì‚¬ìš©ì]
  â†“ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ í˜¸ì¶œ
[ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸]
  â†“ ê²Œì„ Jetton Wallet ì œì–´
[ê²Œì„ Jetton Wallet]
  â†“ "ì‚¬ìš©ìì—ê²Œ ì „ì†¡"
[ì‚¬ìš©ì Jetton Wallet]
```

**ì¥ì **:
- âœ… ì™„ì „ ìë™í™”
- âœ… íƒˆì¤‘ì•™í™”
- âœ… ë‹ˆëª¨ë‹‰ ë…¸ì¶œ ì—†ìŒ

**ë‹¨ì **:
- âŒ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ê°œë°œ í•„ìš” (Tact/FunC)
- âŒ ë°°í¬ ë¹„ìš©
- âŒ ê°ì‚¬(Audit) í•„ìš”
- âŒ ì‹œê°„ ì†Œìš” (ìˆ˜ì£¼~ìˆ˜ê°œì›”)

**ì»¨íŠ¸ë™íŠ¸ ë¡œì§ (Tact ì˜ˆì‹œ)**:
```tact
contract WithdrawManager {
  owner: Address;
  jettonWallet: Address;
  
  receive(msg: WithdrawRequest) {
    // 1. í¬ë ˆë”§ í™•ì¸ (ì˜¨ì²´ì¸ or ì˜¤í”„ì²´ì¸)
    require(msg.amount <= getCredit(msg.user), "Insufficient credit");
    
    // 2. Jetton Walletì—ê²Œ ì „ì†¡ ëª…ë ¹
    send(SendParameters{
      to: self.jettonWallet,
      value: ton("0.2"),
      body: JettonTransfer{
        amount: msg.amount,
        destination: msg.user,  // âœ… ì‚¬ìš©ìì—ê²Œ
        response_destination: msg.user,
        forward_ton_amount: 1,
      }.toCell()
    });
    
    // 3. í¬ë ˆë”§ ì°¨ê°
    deductCredit(msg.user, msg.amount);
  }
}
```

**ë¹„ìš©**:
- ì»¨íŠ¸ë™íŠ¸ ë°°í¬: ~5 TON
- ì‚¬ìš©ìê°€ ê°€ìŠ¤ ë¶€ë‹´: ê° ~0.3 TON
- ë˜ëŠ” ê²Œì„ì´ ë¶€ë‹´ (subsidized)

---

### Option 3: ìˆ˜ë™ ì¸ì¶œ (í˜„ì‹¤ì  MVP)

**êµ¬ì¡°**:
```
[ì‚¬ìš©ì]
  â†“ ì¸ì¶œ ìš”ì²­ (í¬ë ˆë”§ë§Œ ì°¨ê°)
[KV ì €ì¥ì†Œ]
  â†“ ëŒ€ê¸°ì—´ì— ì¶”ê°€
[ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ]
  â†“ ì¼ê´„ ì²˜ë¦¬ (í•˜ë£¨ 1íšŒ)
[ê²Œì„ ìš´ì˜ì]
  â†“ TON Connectë¡œ ìˆ˜ë™ ì „ì†¡
[ì‚¬ìš©ìë“¤]
```

**ì¥ì **:
- âœ… ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥
- âœ… ì¸í”„ë¼ ë¹„ìš© ì—†ìŒ
- âœ… ë³´ì•ˆ ê°„ë‹¨
- âœ… ë°°ì¹˜ ì²˜ë¦¬ë¡œ ë„¤íŠ¸ì›Œí¬ Fee ì ˆê°

**ë‹¨ì **:
- âŒ ìˆ˜ë™ ì‘ì—… í•„ìš”
- âŒ ì²˜ë¦¬ ì§€ì—° (12~24ì‹œê°„)
- âŒ í™•ì¥ì„± ì œí•œ

**êµ¬í˜„ ë‹¨ê³„**:
1. í¬ë ˆë”§ ì°¨ê° + ëŒ€ê¸°ì—´ ì¶”ê°€
2. ê´€ë¦¬ì í˜ì´ì§€ ìƒì„±
3. ëŒ€ê¸° ì¤‘ì¸ ì¸ì¶œ ëª©ë¡ í‘œì‹œ
4. ìš´ì˜ìê°€ TON Connectë¡œ ì¼ê´„ ì „ì†¡
5. ì²˜ë¦¬ ì™„ë£Œ í‘œì‹œ

**KV êµ¬ì¡°**:
```json
{
  "pending_withdrawals": [
    {
      "id": "withdraw_001",
      "user": "UQC...",
      "amount": 10,
      "requestedAt": "2025-11-02T12:00:00Z",
      "status": "pending"
    }
  ]
}
```

**ê´€ë¦¬ì í˜ì´ì§€**:
```tsx
function AdminWithdrawals() {
  const pending = usePendingWithdrawals();
  
  const handleBatchProcess = async () => {
    // TON Connectë¡œ ì¼ê´„ ì „ì†¡
    for (const withdrawal of pending) {
      await tonConnectUI.sendTransaction({
        messages: [{
          address: withdrawal.userJettonWallet,
          amount: toNano('0.2'),
          payload: buildJettonTransferPayload(...)
        }]
      });
      
      // ì²˜ë¦¬ ì™„ë£Œ í‘œì‹œ
      await markAsProcessed(withdrawal.id);
    }
  };
  
  return (
    <div>
      <h2>ëŒ€ê¸° ì¤‘ì¸ ì¸ì¶œ: {pending.length}ê±´</h2>
      <button onClick={handleBatchProcess}>ì¼ê´„ ì²˜ë¦¬</button>
    </div>
  );
}
```

---

### Option 4: Hybrid (ê¶Œì¥)

**Phase 1: ìˆ˜ë™ ì¸ì¶œ (ì¦‰ì‹œ)**
- í¬ë ˆë”§ ì°¨ê° ì‹œìŠ¤í…œ
- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ
- ë°°ì¹˜ ì²˜ë¦¬

**Phase 2: Node.js ì„œë²„ (3ê°œì›”)**
- ë³„ë„ ì„œë²„ êµ¬ì¶•
- ìë™ ì¸ì¶œ êµ¬í˜„
- ëª¨ë‹ˆí„°ë§

**Phase 3: ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ (6ê°œì›”)**
- ì™„ì „ íƒˆì¤‘ì•™í™”
- ì»¨íŠ¸ë™íŠ¸ ê°ì‚¬
- ë©”ì¸ë„· ë°°í¬

---

## ğŸ“Š ë°©ì•ˆ ë¹„êµ

| í•­ëª© | Option 1<br>(Node.js RPC) | Option 2<br>(ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸) | Option 3<br>(ìˆ˜ë™ ì¸ì¶œ) |
|------|-------------------------|----------------------------|---------------------|
| **êµ¬í˜„ ì‹œê°„** | 1ì£¼ | 1~3ê°œì›” | 1ì¼ |
| **ì¸í”„ë¼ ë¹„ìš©** | $20~50/ì›” | ~5 TON (ë°°í¬) | $0 |
| **ë„¤íŠ¸ì›Œí¬ Fee** | ê²Œì„ ë¶€ë‹´<br>0.2 TON/ê±´ | ì‚¬ìš©ì ë˜ëŠ” ê²Œì„<br>0.3 TON/ê±´ | ê²Œì„ ë¶€ë‹´<br>ë°°ì¹˜ë¡œ ì ˆê° |
| **ë³´ì•ˆ ìœ„í—˜** | ì¤‘ (ë‹ˆëª¨ë‹‰ ì €ì¥) | ë‚®ìŒ (íƒˆì¤‘ì•™í™”) | ë‚®ìŒ |
| **ì‚¬ìš©ì ê²½í—˜** | â­â­â­â­â­<br>ì¦‰ì‹œ ì²˜ë¦¬ | â­â­â­â­â­<br>ì¦‰ì‹œ ì²˜ë¦¬ | â­â­<br>12~24ì‹œê°„ ì§€ì—° |
| **í™•ì¥ì„±** | â­â­â­â­ | â­â­â­â­â­ | â­â­ |
| **ìœ ì§€ë³´ìˆ˜** | ì¤‘ (ì„œë²„ ê´€ë¦¬) | ë‚®ìŒ (ìë™ ì‹¤í–‰) | ë†’ìŒ (ìˆ˜ë™ ì‘ì—…) |

---

## ğŸ¯ ê¶Œì¥ ì‚¬í•­

### MVP ë‹¨ê³„ (í˜„ì¬)
**Option 3: ìˆ˜ë™ ì¸ì¶œ ì‹œìŠ¤í…œ**

**ì´ìœ **:
1. âœ… ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥ (1ì¼)
2. âœ… ë¹„ìš© ì—†ìŒ
3. âœ… ê²Œì„ ë‹ˆëª¨ë‹‰ ì•ˆì „
4. âœ… ì‚¬ìš©ì ìˆ˜ ì ì„ ë•Œ ì¶©ë¶„

**êµ¬í˜„ ê³„íš**:
- [ ] ì¸ì¶œ ìš”ì²­ ëŒ€ê¸°ì—´ (KV)
- [ ] ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ (React)
- [ ] TON Connect ì¼ê´„ ì „ì†¡
- [ ] ì²˜ë¦¬ ìƒíƒœ ì¶”ì 

### ì„±ì¥ ë‹¨ê³„ (3ê°œì›” í›„)
**Option 1: Node.js RPC ì„œë²„**

**ì¡°ê±´**:
- ì¼ì¼ ì¸ì¶œ > 10ê±´
- ì‚¬ìš©ì ë¶ˆë§Œ ì¦ê°€
- ì˜ˆì‚° í™•ë³´ ($50/ì›”)

### ë©”ì¸ë„· ë‹¨ê³„ (6ê°œì›” í›„)
**Option 2: ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸**

**ì¡°ê±´**:
- ì¼ì¼ ì¸ì¶œ > 100ê±´
- íˆ¬ì ìœ ì¹˜ ì™„ë£Œ
- íƒˆì¤‘ì•™í™” í•„ìš”

---

## ğŸ”§ ì¦‰ì‹œ ìˆ˜ì • í•„ìš”

### í˜„ì¬ Withdraw.tsx ìˆ˜ì •
```typescript
// âŒ í˜„ì¬: ì…ê¸ˆê³¼ ë™ì¼ (ì‚¬ìš©ìâ†’ê²Œì„)
const payloadBase64 = buildJettonTransferPayload(
  amountNano,
  gameWalletAddress,  // â† ê²Œì„ì—ê²Œ ë³´ë‚´ë¼! (ì…ê¸ˆ!)
  responseAddress
);

// âœ… ìˆ˜ì •: ëŒ€ê¸°ì—´ ì¶”ê°€ (ìˆ˜ë™ ì²˜ë¦¬)
// 1. í¬ë ˆë”§ ì°¨ê°
// 2. ëŒ€ê¸°ì—´ì— ì¶”ê°€
// 3. "24ì‹œê°„ ì´ë‚´ ì²˜ë¦¬ë©ë‹ˆë‹¤" ë©”ì‹œì§€
```

---

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„

**ê²°ì • í•„ìš”**:
1. ì–´ë–¤ Optionì„ ì„ íƒí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
2. MVPëŠ” ìˆ˜ë™ ì¸ì¶œë¡œ ì‹œì‘í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
3. Node.js ì„œë²„ êµ¬ì¶• ì˜ˆì‚°ì´ ìˆìœ¼ì‹ ê°€ìš”?

**ì œì•ˆ**:
- **ì¦‰ì‹œ**: Option 3 (ìˆ˜ë™ ì¸ì¶œ) êµ¬í˜„
- **ì´í›„**: Option 1 ë˜ëŠ” 2ë¡œ ì—…ê·¸ë ˆì´ë“œ

ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?
