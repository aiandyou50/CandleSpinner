# TON ì½”ì¸ ì„ ì§€ë¶ˆ ì¸ì¶œ ì‹œìŠ¤í…œ ë¶„ì„

**ì‘ì„±ì¼**: 2025-11-02  
**ì œì•ˆ**: ì¸ì¶œ ì‹œ ì‚¬ìš©ìê°€ 0.5 TONì„ ê²Œì„ ì§€ê°‘ìœ¼ë¡œ ë¨¼ì € ì†¡ê¸ˆ  
**ëª©ì **: ë„¤íŠ¸ì›Œí¬ Feeë¥¼ ì‚¬ìš©ìì—ê²Œ ì „ê°€

---

## ğŸ¯ ì œì•ˆ ìš”ì•½

### ê¸°ì¡´ ë°©ì‹ (ìˆ˜ë™ ì¸ì¶œ)
```
[ì‚¬ìš©ì] ì¸ì¶œ ë²„íŠ¼ í´ë¦­
    â†“
[ë°±ì—”ë“œ] í¬ë ˆë”§ ì°¨ê° + ëŒ€ê¸°ì—´ ì¶”ê°€
    â†“ (ë¹„ìš©: ê²Œì„ ë¶€ë‹´)
[ê´€ë¦¬ì] TON Connectë¡œ í† í° ì „ì†¡ (0.2 TON/ê±´)
```

### ì œì•ˆ ë°©ì‹ (TON ì„ ì§€ë¶ˆ)
```
[ì‚¬ìš©ì] ì¸ì¶œ ë²„íŠ¼ í´ë¦­
    â†“
[TON Connect] 0.5 TON â†’ ê²Œì„ ì§€ê°‘ ì†¡ê¸ˆ
    â†“ (ë¹„ìš©: ì‚¬ìš©ì ë¶€ë‹´)
[ë°±ì—”ë“œ] íŠ¸ëœì­ì…˜ í™•ì¸ â†’ í¬ë ˆë”§ ì°¨ê° + ëŒ€ê¸°ì—´ ì¶”ê°€
    â†“
[ê´€ë¦¬ì] 0.5 TONì„ ì‚¬ìš©í•´ í† í° ì „ì†¡
```

---

## âœ… ê¸°ìˆ ì  ê°€ëŠ¥ì„±

### 1. ë„¤ì´í‹°ë¸Œ TON ì½”ì¸ ì „ì†¡
```typescript
// Withdraw.tsx
import { useTonConnectUI } from '@tonconnect/ui-react';

async function handleWithdraw(amount: number) {
  const [tonConnectUI] = useTonConnectUI();
  
  // âœ… 1ë‹¨ê³„: ì‚¬ìš©ìê°€ 0.5 TONì„ ê²Œì„ ì§€ê°‘ìœ¼ë¡œ ì „ì†¡
  const transaction = {
    validUntil: Math.floor(Date.now() / 1000) + 600,
    messages: [
      {
        address: GAME_WALLET_ADDRESS,  // ê²Œì„ ì§€ê°‘ ì£¼ì†Œ
        amount: '500000000',  // 0.5 TON (nanoton ë‹¨ìœ„)
        payload: `withdraw_fee_${Date.now()}`  // ì‹ë³„ì
      }
    ]
  };
  
  try {
    // TON Connectë¡œ íŠ¸ëœì­ì…˜ ì„œëª… ë° ì „ì†¡
    const result = await tonConnectUI.sendTransaction(transaction);
    const txHash = result.boc;  // íŠ¸ëœì­ì…˜ í•´ì‹œ
    
    // âœ… 2ë‹¨ê³„: ë°±ì—”ë“œì— íŠ¸ëœì­ì…˜ í•´ì‹œ ì „ì†¡
    const response = await fetch('/api/withdraw-with-fee', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        walletAddress,
        amount,
        txHash,  // ë¸”ë¡ì²´ì¸ ê²€ì¦ìš©
        timestamp: Date.now()
      })
    });
    
    if (response.ok) {
      alert('ì¸ì¶œ ìš”ì²­ ì™„ë£Œ! (12~24ì‹œê°„ ì²˜ë¦¬)');
    }
  } catch (error) {
    console.error('TON ì „ì†¡ ì‹¤íŒ¨:', error);
    alert('TON ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
  }
}
```

**ê²°ë¡ **: âœ… **í”„ë¡ íŠ¸ì—”ë“œ êµ¬í˜„ ê°€ëŠ¥** (TON Connect)

---

### 2. ë°±ì—”ë“œ íŠ¸ëœì­ì…˜ ê²€ì¦

**í•µì‹¬ ì§ˆë¬¸**: ì‚¬ìš©ìê°€ ë³´ë‚¸ 0.5 TONì´ ì‹¤ì œë¡œ ê²Œì„ ì§€ê°‘ì— ë„ì°©í–ˆëŠ”ì§€ í™•ì¸?

#### ë°©ë²• 1: TON Center API (âœ… ê°€ëŠ¥)
```typescript
// src/index.ts
async function verifyTonTransaction(
  txHash: string,
  expectedAmount: string,
  senderAddress: string,
  env: Env
): Promise<boolean> {
  // TON Center APIë¡œ íŠ¸ëœì­ì…˜ ì¡°íšŒ
  const response = await fetch(
    `https://toncenter.com/api/v3/transactions?hash=${txHash}`,
    {
      headers: {
        'X-API-Key': env.TONCENTER_API_KEY || ''
      }
    }
  );
  
  const data = await response.json();
  
  if (!data.transactions || data.transactions.length === 0) {
    return false;  // íŠ¸ëœì­ì…˜ ì—†ìŒ
  }
  
  const tx = data.transactions[0];
  
  // âœ… ê²€ì¦ ì¡°ê±´
  return (
    tx.in_msg?.destination === env.GAME_WALLET_ADDRESS &&  // ìˆ˜ì‹ ì í™•ì¸
    tx.in_msg?.value === expectedAmount &&  // ê¸ˆì•¡ í™•ì¸ (0.5 TON)
    tx.in_msg?.source === senderAddress &&  // ë°œì‹ ì í™•ì¸
    tx.now > Date.now() / 1000 - 600  // 10ë¶„ ì´ë‚´ íŠ¸ëœì­ì…˜
  );
}

// API ì—”ë“œí¬ì¸íŠ¸
async function handleWithdrawWithFee(request: Request, env: Env) {
  const body = await request.json();
  const { walletAddress, amount, txHash } = body;
  
  // âœ… 1. íŠ¸ëœì­ì…˜ ê²€ì¦ (3ì´ˆ ì •ë„ ëŒ€ê¸° í›„ í™•ì¸)
  await new Promise(resolve => setTimeout(resolve, 3000));
  
  const isValid = await verifyTonTransaction(
    txHash,
    '500000000',  // 0.5 TON
    walletAddress,
    env
  );
  
  if (!isValid) {
    return new Response('TON ì „ì†¡ ë¯¸í™•ì¸', { status: 400 });
  }
  
  // âœ… 2. í¬ë ˆë”§ í™•ì¸ ë° ì°¨ê°
  const creditKey = `credit:${walletAddress}`;
  const credit = await env.CREDIT_KV.get(creditKey, 'json');
  
  if (credit.amount < amount) {
    // âš ï¸ í¬ë ˆë”§ ë¶€ì¡±ì¸ë° TONì€ ì´ë¯¸ ë³´ëƒ„!
    // â†’ í™˜ë¶ˆ ì²˜ë¦¬ í•„ìš” (ë³µì¡!)
    return new Response('í¬ë ˆë”§ ë¶€ì¡±', { status: 400 });
  }
  
  await env.CREDIT_KV.put(creditKey, JSON.stringify({
    amount: credit.amount - amount
  }));
  
  // âœ… 3. ëŒ€ê¸°ì—´ ì¶”ê°€
  const withdrawalId = `withdraw_${Date.now()}`;
  await env.CREDIT_KV.put(`withdrawal:${withdrawalId}`, JSON.stringify({
    walletAddress,
    amount,
    txHash,  // TON ì „ì†¡ ì¦ëª…
    feePaid: '0.5 TON',
    status: 'pending',
    createdAt: Date.now()
  }));
  
  return new Response(JSON.stringify({
    success: true,
    withdrawalId,
    message: 'ì¸ì¶œ ìš”ì²­ ì ‘ìˆ˜ (12~24ì‹œê°„ ì²˜ë¦¬)'
  }));
}
```

**ê²°ë¡ **: âœ… **ë°±ì—”ë“œ ê²€ì¦ ê°€ëŠ¥** (TON Center API)

---

## ğŸ“Š ì¥ë‹¨ì  ë¶„ì„

### âœ… ì¥ì 

1. **ë¹„ìš© ì ˆê°** (ê²Œì„ ì…ì¥)
   ```
   ê¸°ì¡´: ê²Œì„ì´ 0.2 TON/ê±´ ë¶€ë‹´
   ì œì•ˆ: ì‚¬ìš©ìê°€ 0.5 TON ë¶€ë‹´ â†’ ê²Œì„ ë¹„ìš© $0
   ```

2. **ìˆ˜ìµ ê°€ëŠ¥ì„±**
   ```
   ì‹¤ì œ ìˆ˜ìˆ˜ë£Œ: 0.2 TON
   ì‚¬ìš©ì ë¶€ë‹´: 0.5 TON
   ê²Œì„ ìˆ˜ìµ: 0.3 TON/ê±´ ($0.75)
   
   ì›” 100ê±´: 30 TON ($75)
   ```

3. **ì¦‰ì‹œ í™•ì¸ ê°€ëŠ¥**
   - ë¸”ë¡ì²´ì¸ íŠ¸ëœì­ì…˜ì€ ê³µê°œ
   - TON Center APIë¡œ 3~5ì´ˆ ë‚´ í™•ì¸

### âŒ ë‹¨ì 

1. **UX ì €í•˜** (ì¹˜ëª…ì )
   ```
   ì‚¬ìš©ì ì…ì¥:
   - ì¸ì¶œí•˜ëŠ”ë° ì™œ TONì„ ë³´ë‚´ì•¼ í•´?
   - 0.5 TON = $1.25 (ë†’ì€ ì‹¬ë¦¬ì  ì¥ë²½)
   - ì‹¤íŒ¨ ì‹œ í™˜ë¶ˆ? (ì‹ ë¢° ë¬¸ì œ)
   ```

2. **í™˜ë¶ˆ ë¡œì§ ë³µì¡**
   ```typescript
   // í¬ë ˆë”§ ë¶€ì¡±ì¸ë° TONì€ ì´ë¯¸ ë³´ë‚¸ ê²½ìš°
   if (credit.amount < amount) {
     // âš ï¸ í™˜ë¶ˆ ì²˜ë¦¬ í•„ìš”!
     // - ê´€ë¦¬ìê°€ ìˆ˜ë™ìœ¼ë¡œ í™˜ë¶ˆ?
     // - ìë™ í™˜ë¶ˆ? (ë˜ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ í•„ìš”)
     // - í™˜ë¶ˆ ìˆ˜ìˆ˜ë£ŒëŠ” ëˆ„ê°€?
   }
   ```

3. **íŠ¸ëœì­ì…˜ ì§€ì—°**
   ```
   ë¬¸ì œ:
   - TON ì „ì†¡: 5~10ì´ˆ
   - ë¸”ë¡ í™•ì •: 5~10ì´ˆ
   - ì´ ëŒ€ê¸°: 10~20ì´ˆ
   
   ì‚¬ìš©ìê°€ "ë¡œë”© ì¤‘..."ì„ 20ì´ˆ ë™ì•ˆ ë´ì•¼ í•¨
   ```

4. **ë™ì‹œì„± ë¬¸ì œ**
   ```typescript
   // ì‚¬ìš©ìê°€ ì¤‘ë³µ í´ë¦­í•˜ë©´?
   // â†’ 0.5 TONì„ 2ë²ˆ ë³´ë‚¼ ìˆ˜ ìˆìŒ!
   
   // í•´ê²°: í”„ë¡ íŠ¸ì—”ë“œ ë½ + ë°±ì—”ë“œ ì¤‘ë³µ ê²€ì‚¬
   const existingWithdrawal = await env.CREDIT_KV.get(
     `pending:${walletAddress}`
   );
   if (existingWithdrawal) {
     return new Response('ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì¸ ì¸ì¶œ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤', { 
       status: 429 
     });
   }
   ```

5. **ì•…ì˜ì  ì‚¬ìš©**
   ```
   ì‹œë‚˜ë¦¬ì˜¤:
   1. ì‚¬ìš©ìê°€ 0.5 TON ì „ì†¡
   2. í¬ë ˆë”§ ì°¨ê° + ëŒ€ê¸°ì—´ ì¶”ê°€
   3. ê´€ë¦¬ìê°€ í† í° ì „ì†¡ ì „ì—...
   4. ì‚¬ìš©ìê°€ "í™˜ë¶ˆí•´ì£¼ì„¸ìš”!" ìš”ì²­
   
   â†’ CS ë¶€ë‹´ ì¦ê°€
   ```

---

## ğŸ¯ ì‹¤ìš©ì„± í‰ê°€

### ì ìˆ˜: â­â­â˜†â˜†â˜† (2/5)

| í•­ëª© | í‰ê°€ | ì´ìœ  |
|------|------|------|
| **ê¸°ìˆ ì  ê°€ëŠ¥ì„±** | âœ… ê°€ëŠ¥ | TON Connect + TON Center API |
| **êµ¬í˜„ ë³µì¡ë„** | âš ï¸ ì¤‘ê°„ | íŠ¸ëœì­ì…˜ ê²€ì¦ ë¡œì§ í•„ìš” |
| **UX** | âŒ ë‚˜ì¨ | ì‚¬ìš©ìê°€ ëˆì„ ë¨¼ì € ë³´ë‚´ì•¼ í•¨ |
| **ì‹ ë¢°ë„** | âŒ ë‚®ìŒ | "ì™œ ìˆ˜ìˆ˜ë£Œë¥¼ ë¨¼ì € ë‚´ì•¼ í•´?" |
| **ë¹„ìš© ì ˆê°** | âœ… íš¨ê³¼ì  | ê²Œì„ ë¹„ìš© $0 |
| **ìˆ˜ìµì„±** | âœ… ê°€ëŠ¥ | 0.3 TON/ê±´ ìˆ˜ìµ |
| **CS ë¶€ë‹´** | âŒ ë†’ìŒ | í™˜ë¶ˆ ìš”ì²­, ì‹¤íŒ¨ ì²˜ë¦¬ |

---

## ğŸ’¡ ëŒ€ì•ˆ ì œì•ˆ

### Option A: ê³ ì • ìˆ˜ìˆ˜ë£Œ (ì¶”ì²œ â­â­â­â­â­)
```typescript
// í¬ë ˆë”§ì—ì„œ ìˆ˜ìˆ˜ë£Œ ì°¨ê°
const FEE_CSPIN = 10;  // 10 CSPIN = ìˆ˜ìˆ˜ë£Œ

if (credit.amount < amount + FEE_CSPIN) {
  return new Response('ì”ì•¡ ë¶€ì¡± (ìˆ˜ìˆ˜ë£Œ í¬í•¨)', { status: 400 });
}

// í¬ë ˆë”§ ì°¨ê°: ì¸ì¶œ ê¸ˆì•¡ + ìˆ˜ìˆ˜ë£Œ
await env.CREDIT_KV.put(creditKey, JSON.stringify({
  amount: credit.amount - amount - FEE_CSPIN
}));
```

**ì¥ì **:
- âœ… UX ì¢‹ìŒ (ì¶”ê°€ íŠ¸ëœì­ì…˜ ì—†ìŒ)
- âœ… ì¦‰ì‹œ ì²˜ë¦¬
- âœ… í™˜ë¶ˆ ë¬¸ì œ ì—†ìŒ
- âœ… ê²Œì„ ìˆ˜ìµ ë°œìƒ

**ë‹¨ì **:
- âŒ ì´ˆê¸° êµ¬í˜„ ë¹„ìš© ì—¬ì „íˆ ê²Œì„ ë¶€ë‹´

### Option B: ìµœì†Œ ì¸ì¶œ ê¸ˆì•¡ (ì¶”ì²œ â­â­â­â­â˜†)
```typescript
const MIN_WITHDRAW = 100;  // 100 CSPIN ì´ìƒë§Œ ì¸ì¶œ

if (amount < MIN_WITHDRAW) {
  return new Response('ìµœì†Œ ì¸ì¶œ ê¸ˆì•¡: 100 CSPIN', { status: 400 });
}
```

**íš¨ê³¼**:
- ì¸ì¶œ ê±´ìˆ˜ ê°ì†Œ â†’ ë¹„ìš© ì ˆê°
- ì›” 100ê±´ â†’ ì›” 20ê±´ (80% ê°ì†Œ)
- ì›” ë¹„ìš©: $150 â†’ $30

### Option C: ë°°ì¹˜ ì²˜ë¦¬ (ì¶”ì²œ â­â­â­â­â­)
```typescript
// í•˜ë£¨ 1íšŒ ë°°ì¹˜ ì²˜ë¦¬
// 10ê±´ì„ í•œ ë²ˆì— ì²˜ë¦¬ â†’ ìˆ˜ìˆ˜ë£Œ ì ˆê°

// 1ê±´ì”©: 10ê±´ Ã— 0.2 TON = 2 TON
// ë°°ì¹˜: 1ê±´ Ã— 0.2 TON = 0.2 TON (90% ì ˆê°!)
```

**í˜„ì¬ êµ¬í˜„ ìƒíƒœ**: âœ… ì´ë¯¸ êµ¬í˜„ë¨ (ìˆ˜ë™ ì¸ì¶œ)

---

## ğŸ¯ ìµœì¢… ê¶Œì¥

### ë‹¨ê¸° (í˜„ì¬ ~ 3ê°œì›”): í˜„ì¬ ì‹œìŠ¤í…œ ìœ ì§€
```
âœ… ìˆ˜ë™ ì¸ì¶œ (í•˜ë£¨ 1íšŒ ë°°ì¹˜)
âœ… ìµœì†Œ ì¸ì¶œ ê¸ˆì•¡: 50 CSPIN
âœ… ìˆ˜ìˆ˜ë£Œ: í¬ë ˆë”§ì—ì„œ 5 CSPIN ì°¨ê°

ë¹„ìš©: $0~$25/ì›”
UX: â˜…â˜…â˜…â˜…â˜†
```

### ì¤‘ê¸° (3~6ê°œì›”): ìë™í™” + ìˆ˜ìˆ˜ë£Œ
```
âœ… Node.js ìë™ ì¸ì¶œ
âœ… ìµœì†Œ ì¸ì¶œ ê¸ˆì•¡: 100 CSPIN
âœ… ìˆ˜ìˆ˜ë£Œ: í¬ë ˆë”§ì—ì„œ 10 CSPIN ì°¨ê°

ë¹„ìš©: $50/ì›” (ì„œë²„) + ë„¤íŠ¸ì›Œí¬ Fee
UX: â˜…â˜…â˜…â˜…â˜…
```

### TON ì„ ì§€ë¶ˆ ë°©ì‹: âš ï¸ ë¹„ì¶”ì²œ
```
ì´ìœ :
- UX ì €í•˜ (ì‚¬ìš©ìê°€ ëˆì„ ë¨¼ì € ë‚´ì•¼ í•¨)
- ì‹ ë¢°ë„ ë¬¸ì œ (í™˜ë¶ˆ ìš”ì²­ ì¦ê°€)
- CS ë¶€ë‹´ ì¦ê°€
- ê²½ìŸ ì„œë¹„ìŠ¤ ëŒ€ë¹„ ë¶ˆë¦¬

ì˜ˆì™¸:
- TON ìƒíƒœê³„ì—ì„œ ì¼ë°˜ì ì¸ ë°©ì‹ì¸ ê²½ìš°
- ì‚¬ìš©ìì—ê²Œ ì¶©ë¶„íˆ ì„¤ëª…ëœ ê²½ìš°
- í™˜ë¶ˆ ìë™í™”ê°€ ì™„ë²½í•œ ê²½ìš°
```

---

## ğŸ”§ TON ì„ ì§€ë¶ˆ êµ¬í˜„ (ì°¸ê³ ìš©)

ë§Œì•½ ì •ë§ë¡œ êµ¬í˜„í•œë‹¤ë©´:

### í”„ë¡ íŠ¸ì—”ë“œ
```typescript
// Withdraw.tsx
const [isProcessing, setIsProcessing] = useState(false);

async function handleWithdraw(amount: number) {
  if (isProcessing) return;  // ì¤‘ë³µ ë°©ì§€
  setIsProcessing(true);
  
  try {
    // 1. ì‚¬ìš©ì í™•ì¸
    const confirmed = window.confirm(
      `ì¸ì¶œ ìˆ˜ìˆ˜ë£Œ 0.5 TON($1.25)ì„ ë¨¼ì € ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.\n` +
      `ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
    );
    if (!confirmed) return;
    
    // 2. TON ì „ì†¡
    const result = await tonConnectUI.sendTransaction({
      validUntil: Math.floor(Date.now() / 1000) + 600,
      messages: [{
        address: GAME_WALLET_ADDRESS,
        amount: '500000000',  // 0.5 TON
        payload: btoa(`withdraw_fee_${walletAddress}_${Date.now()}`)
      }]
    });
    
    // 3. ë°±ì—”ë“œ ê²€ì¦ ìš”ì²­
    const response = await fetch('/api/withdraw-with-fee', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        walletAddress,
        amount,
        txHash: result.boc
      })
    });
    
    if (response.ok) {
      alert('ì¸ì¶œ ìš”ì²­ ì™„ë£Œ!');
    } else {
      const error = await response.json();
      alert(`ì˜¤ë¥˜: ${error.message}\ní™˜ë¶ˆì€ ê³ ê°ì„¼í„°ë¡œ ë¬¸ì˜í•˜ì„¸ìš”.`);
    }
  } catch (error) {
    console.error(error);
    alert('TON ì „ì†¡ ì‹¤íŒ¨. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
  } finally {
    setIsProcessing(false);
  }
}
```

### ë°±ì—”ë“œ
```typescript
// src/index.ts - /api/withdraw-with-fee
async function handleWithdrawWithFee(request: Request, env: Env) {
  const body = await request.json();
  const { walletAddress, amount, txHash } = body;
  
  // 1. ì¤‘ë³µ ìš”ì²­ ë°©ì§€
  const lockKey = `lock:withdraw:${walletAddress}`;
  const existingLock = await env.CREDIT_KV.get(lockKey);
  if (existingLock) {
    return new Response(JSON.stringify({
      error: 'ì´ë¯¸ ì²˜ë¦¬ ì¤‘ì¸ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤'
    }), { status: 429 });
  }
  
  // ë½ ì„¤ì • (10ë¶„)
  await env.CREDIT_KV.put(lockKey, 'processing', { expirationTtl: 600 });
  
  try {
    // 2. íŠ¸ëœì­ì…˜ ê²€ì¦ (5ì´ˆ ëŒ€ê¸°)
    await new Promise(resolve => setTimeout(resolve, 5000));
    
    const isValid = await verifyTonTransaction(
      txHash,
      '500000000',
      walletAddress,
      env
    );
    
    if (!isValid) {
      return new Response(JSON.stringify({
        error: 'TON ì „ì†¡ì´ í™•ì¸ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤'
      }), { status: 400 });
    }
    
    // 3. í¬ë ˆë”§ í™•ì¸
    const creditKey = `credit:${walletAddress}`;
    const credit = await env.CREDIT_KV.get(creditKey, 'json');
    
    if (credit.amount < amount) {
      // âš ï¸ í™˜ë¶ˆ ì²˜ë¦¬ í•„ìš”!
      await env.CREDIT_KV.put(`refund:${txHash}`, JSON.stringify({
        walletAddress,
        amount: '0.5 TON',
        reason: 'insufficient_credit',
        status: 'pending'
      }));
      
      return new Response(JSON.stringify({
        error: 'í¬ë ˆë”§ ë¶€ì¡±. í™˜ë¶ˆì´ 24ì‹œê°„ ë‚´ ì²˜ë¦¬ë©ë‹ˆë‹¤.'
      }), { status: 400 });
    }
    
    // 4. í¬ë ˆë”§ ì°¨ê°
    await env.CREDIT_KV.put(creditKey, JSON.stringify({
      amount: credit.amount - amount
    }));
    
    // 5. ëŒ€ê¸°ì—´ ì¶”ê°€
    const withdrawalId = `withdraw_${Date.now()}`;
    await env.CREDIT_KV.put(`withdrawal:${withdrawalId}`, JSON.stringify({
      walletAddress,
      amount,
      txHash,
      feePaid: '0.5 TON',
      status: 'pending',
      createdAt: Date.now()
    }));
    
    return new Response(JSON.stringify({
      success: true,
      withdrawalId,
      message: 'ì¸ì¶œ ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤ (12~24ì‹œê°„ ì²˜ë¦¬)'
    }));
  } finally {
    // ë½ í•´ì œ
    await env.CREDIT_KV.delete(lockKey);
  }
}
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸ (êµ¬í˜„ ì‹œ)

- [ ] TON Connect íŠ¸ëœì­ì…˜ ì „ì†¡ êµ¬í˜„
- [ ] TON Center API íŠ¸ëœì­ì…˜ ê²€ì¦
- [ ] ì¤‘ë³µ ìš”ì²­ ë°©ì§€ (ë½ ë©”ì»¤ë‹ˆì¦˜)
- [ ] í™˜ë¶ˆ ë¡œì§ êµ¬í˜„
- [ ] í™˜ë¶ˆ ëŒ€ì‹œë³´ë“œ (ê´€ë¦¬ì)
- [ ] UX ê°œì„  (ë¡œë”© í‘œì‹œ, ì•ˆë‚´ ë©”ì‹œì§€)
- [ ] ì—ëŸ¬ ì²˜ë¦¬ (íŠ¸ëœì­ì…˜ ì‹¤íŒ¨, ê²€ì¦ ì‹¤íŒ¨)
- [ ] í…ŒìŠ¤íŠ¸ (í…ŒìŠ¤íŠ¸ë„·)
- [ ] ì‚¬ìš©ì ê°€ì´ë“œ ì‘ì„±
- [ ] CS ëŒ€ì‘ ë§¤ë‰´ì–¼ ì‘ì„±

---

## ê²°ë¡ 

**ê¸°ìˆ ì ìœ¼ë¡œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ, ì‹¤ìš©ì ìœ¼ë¡œëŠ” ê¶Œì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.**

**ì¶”ì²œ**: í¬ë ˆë”§ ìˆ˜ìˆ˜ë£Œ + ìµœì†Œ ì¸ì¶œ ê¸ˆì•¡ + ë°°ì¹˜ ì²˜ë¦¬
